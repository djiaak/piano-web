Bridge.assembly("MidiSheetMusicBridge",function(){"use strict";Bridge.define("MidiSheetMusic.Accid",{$kind:"enum",statics:{fields:{None:0,Sharp:1,Flat:2,Natural:3}}});Bridge.define("MidiSheetMusic.MusicSymbol");Bridge.define("MidiSheetMusic.Image",{fields:{DomImage:null},props:{Width:{get:function(){return bridgeUtil.image.getWidth(this)}},Height:{get:function(){return bridgeUtil.image.getHeight(this)}}},ctors:{ctor:function(type,filename){this.$initialize();bridgeUtil.image.ctor(this,type,filename)}}});Bridge.define("MidiSheetMusic.Brush",{fields:{Color:null},ctors:{ctor:function(color){this.$initialize();this.Color=color}},methods:{Dispose:function(){}}});Bridge.define("MidiSheetMusic.Brushes",{statics:{props:{Black:{get:function(){return new MidiSheetMusic.Brush(MidiSheetMusic.Color.Black)}},White:{get:function(){return new MidiSheetMusic.Brush(MidiSheetMusic.Color.White)}},LightGray:{get:function(){return new MidiSheetMusic.Brush(MidiSheetMusic.Color.LightGray)}}}}});Bridge.define("MidiSheetMusic.Clef",{$kind:"enum",statics:{fields:{Treble:0,Bass:1}}});Bridge.define("MidiSheetMusic.ClefMeasures",{statics:{methods:{MainClef:function(notes){var $t,middleC=MidiSheetMusic.WhiteNote.MiddleC.Number(),total=0,m;$t=Bridge.getEnumerator(notes);try{while($t.moveNext())m=$t.Current,total=total+m.Number|0}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return notes.Count===0?MidiSheetMusic.Clef.Treble:(Bridge.Int.div(total,notes.Count)|0)>=middleC?MidiSheetMusic.Clef.Treble:MidiSheetMusic.Clef.Bass}}},fields:{clefs:null,measure:0},ctors:{ctor:function(notes,measurelen){var sumnotes,notecount,avgnote;this.$initialize();this.measure=measurelen;var mainclef=MidiSheetMusic.ClefMeasures.MainClef(notes),nextmeasure=measurelen,pos=0,clef=mainclef;for(this.clefs=new(System.Collections.Generic.List$1(MidiSheetMusic.Clef).ctor);pos<notes.Count;){for(sumnotes=0,notecount=0;pos<notes.Count&&notes.getItem(pos).StartTime<nextmeasure;)sumnotes=sumnotes+notes.getItem(pos).Number|0,notecount=notecount+1|0,pos=pos+1|0;notecount===0&&(notecount=1);avgnote=Bridge.Int.div(sumnotes,notecount)|0;avgnote===0||(clef=avgnote>=MidiSheetMusic.WhiteNote.BottomTreble.Number()?MidiSheetMusic.Clef.Treble:avgnote<=MidiSheetMusic.WhiteNote.TopBass.Number()?MidiSheetMusic.Clef.Bass:mainclef);this.clefs.add(clef);nextmeasure=nextmeasure+measurelen|0}this.clefs.add(clef)}},methods:{GetClef:function(starttime){return(Bridge.Int.div(starttime,this.measure)|0)>=this.clefs.Count?this.clefs.getItem(this.clefs.Count-1|0):this.clefs.getItem(Bridge.Int.div(starttime,this.measure)|0)}}});Bridge.define("MidiSheetMusic.Color",{statics:{props:{Black:{get:function(){return new MidiSheetMusic.Color}},White:{get:function(){return MidiSheetMusic.Color.FromArgb(255,255,255)}},LightGray:{get:function(){return MidiSheetMusic.Color.FromArgb(211,211,211)}}},methods:{FromArgb:function(red,green,blue){return MidiSheetMusic.Color.FromArgb$1(255,red,green,blue)},FromArgb$1:function(alpha,red,green,blue){var $t;return $t=new MidiSheetMusic.Color,$t.Alpha=alpha,$t.Red=red,$t.Green=green,$t.Blue=blue,$t}}},fields:{Red:0,Green:0,Blue:0,Alpha:0},props:{R:{get:function(){return this.Red}},G:{get:function(){return this.Green}},B:{get:function(){return this.Blue}}},ctors:{ctor:function(){this.$initialize();this.Alpha=255}},methods:{Equals:function(color){return this.Red===color.Red&&this.Green===color.Green&&this.Blue===color.Blue&&this.Alpha===color.Alpha}}});Bridge.define("MidiSheetMusic.Control",{fields:{Width:0,Height:0,BackColor:null},props:{Parent:{get:function(){return new MidiSheetMusic.Panel}}},methods:{Invalidate:function(){},CreateGraphics:function(name){return new MidiSheetMusic.Graphics(name)}}});Bridge.define("MidiSheetMusic.Encoding",{statics:{methods:{GetUtf8String:function(){return"not implemented!"},GetAsciiString:function(data,startIndex,len){for(var toReturn="",i=0;i<len&&i<data.length;i=i+1|0)toReturn=(toReturn||"")+String.fromCharCode(data[System.Array.index(i+startIndex|0,data)]);return toReturn},GetAsciiBytes:function(){return null}}}});Bridge.define("MidiSheetMusic.File");Bridge.define("MidiSheetMusic.FileMode",{$kind:"enum",statics:{fields:{Create:0}}});Bridge.define("MidiSheetMusic.Stream",{methods:{Write:function(){},Close:function(){}}});Bridge.define("MidiSheetMusic.Font",{fields:{Name:null,Size:0,Style:0},ctors:{ctor:function(name,size,style){this.$initialize();this.Name=name;this.Size=size;this.Style=style}},methods:{GetHeight:function(){return 0},Dispose:function(){}}});Bridge.define("MidiSheetMusic.FontStyle",{$kind:"enum",statics:{fields:{Regular:0,Bold:1}}});Bridge.define("MidiSheetMusic.Graphics",{fields:{Name:null,Context:null,SmoothingMode:0,VisibleClipBounds:null,PageScale:0},ctors:{ctor:function(name){this.$initialize();this.Name=name;bridgeUtil.graphics.initGraphics(this)}},methods:{TranslateTransform:function(x,y){bridgeUtil.graphics.translateTransform(this,x,y)},DrawImage:function(image,x,y,width,height){bridgeUtil.graphics.drawImage(this,image,x,y,width,height)},DrawString:function(text,font,brush,x,y){bridgeUtil.graphics.drawString(this,text,font,brush,x,y)},DrawLine:function(pen,xStart,yStart,xEnd,yEnd){bridgeUtil.graphics.drawLine(this,pen,xStart,yStart,xEnd,yEnd)},DrawBezier:function(pen,x1,y1,x2,y2,x3,y3,x4,y4){bridgeUtil.graphics.drawBezier(this,pen,x1,y1,x2,y2,x3,y3,x4,y4)},ScaleTransform:function(x,y){bridgeUtil.graphics.scaleTransform(this,x,y)},FillRectangle:function(brush,x,y,width,height){bridgeUtil.graphics.fillRectangle(this,brush,x,y,width,height)},ClearRectangle:function(x,y,width,height){bridgeUtil.graphics.clearRectangle(this,x,y,width,height)},FillEllipse:function(brush,x,y,width,height){bridgeUtil.graphics.fillEllipse(this,brush,x,y,width,height)},DrawEllipse:function(pen,x,y,width,height){bridgeUtil.graphics.drawEllipse(this,pen,x,y,width,height)},RotateTransform:function(angleDeg){bridgeUtil.graphics.rotateTransform(this,angleDeg)},Dispose:function(){}}});Bridge.define("MidiSheetMusic.IOException",{inherits:[System.Exception]});Bridge.define("MidiSheetMusic.KeySignature",{statics:{fields:{C:0,G:0,D:0,A:0,E:0,B:0,F:0,Bflat:0,Eflat:0,Aflat:0,Dflat:0,Gflat:0,sharpkeys:null,flatkeys:null},ctors:{init:function(){this.C=0;this.G=1;this.D=2;this.A=3;this.E=4;this.B=5;this.F=1;this.Bflat=2;this.Eflat=3;this.Aflat=4;this.Dflat=5;this.Gflat=6}},methods:{CreateAccidentalMaps:function(){var map,i;if(MidiSheetMusic.KeySignature.sharpkeys==null){for(MidiSheetMusic.KeySignature.sharpkeys=System.Array.init(8,null,System.Array.type(MidiSheetMusic.Accid)),MidiSheetMusic.KeySignature.flatkeys=System.Array.init(8,null,System.Array.type(MidiSheetMusic.Accid)),i=0;i<8;i=i+1|0)MidiSheetMusic.KeySignature.sharpkeys[System.Array.index(i,MidiSheetMusic.KeySignature.sharpkeys)]=System.Array.init(12,0,MidiSheetMusic.Accid),MidiSheetMusic.KeySignature.flatkeys[System.Array.index(i,MidiSheetMusic.KeySignature.flatkeys)]=System.Array.init(12,0,MidiSheetMusic.Accid);map=MidiSheetMusic.KeySignature.sharpkeys[System.Array.index(MidiSheetMusic.KeySignature.C,MidiSheetMusic.KeySignature.sharpkeys)];map[System.Array.index(MidiSheetMusic.NoteScale.A,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Asharp,map)]=MidiSheetMusic.Accid.Flat;map[System.Array.index(MidiSheetMusic.NoteScale.B,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.C,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Csharp,map)]=MidiSheetMusic.Accid.Sharp;map[System.Array.index(MidiSheetMusic.NoteScale.D,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Dsharp,map)]=MidiSheetMusic.Accid.Sharp;map[System.Array.index(MidiSheetMusic.NoteScale.E,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.F,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Fsharp,map)]=MidiSheetMusic.Accid.Sharp;map[System.Array.index(MidiSheetMusic.NoteScale.G,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Gsharp,map)]=MidiSheetMusic.Accid.Sharp;map=MidiSheetMusic.KeySignature.sharpkeys[System.Array.index(MidiSheetMusic.KeySignature.G,MidiSheetMusic.KeySignature.sharpkeys)];map[System.Array.index(MidiSheetMusic.NoteScale.A,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Asharp,map)]=MidiSheetMusic.Accid.Flat;map[System.Array.index(MidiSheetMusic.NoteScale.B,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.C,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Csharp,map)]=MidiSheetMusic.Accid.Sharp;map[System.Array.index(MidiSheetMusic.NoteScale.D,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Dsharp,map)]=MidiSheetMusic.Accid.Sharp;map[System.Array.index(MidiSheetMusic.NoteScale.E,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.F,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Fsharp,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.G,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Gsharp,map)]=MidiSheetMusic.Accid.Sharp;map=MidiSheetMusic.KeySignature.sharpkeys[System.Array.index(MidiSheetMusic.KeySignature.D,MidiSheetMusic.KeySignature.sharpkeys)];map[System.Array.index(MidiSheetMusic.NoteScale.A,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Asharp,map)]=MidiSheetMusic.Accid.Flat;map[System.Array.index(MidiSheetMusic.NoteScale.B,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.C,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Csharp,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.D,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Dsharp,map)]=MidiSheetMusic.Accid.Sharp;map[System.Array.index(MidiSheetMusic.NoteScale.E,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.F,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Fsharp,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.G,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Gsharp,map)]=MidiSheetMusic.Accid.Sharp;map=MidiSheetMusic.KeySignature.sharpkeys[System.Array.index(MidiSheetMusic.KeySignature.A,MidiSheetMusic.KeySignature.sharpkeys)];map[System.Array.index(MidiSheetMusic.NoteScale.A,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Asharp,map)]=MidiSheetMusic.Accid.Flat;map[System.Array.index(MidiSheetMusic.NoteScale.B,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.C,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Csharp,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.D,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Dsharp,map)]=MidiSheetMusic.Accid.Sharp;map[System.Array.index(MidiSheetMusic.NoteScale.E,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.F,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Fsharp,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.G,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Gsharp,map)]=MidiSheetMusic.Accid.None;map=MidiSheetMusic.KeySignature.sharpkeys[System.Array.index(MidiSheetMusic.KeySignature.E,MidiSheetMusic.KeySignature.sharpkeys)];map[System.Array.index(MidiSheetMusic.NoteScale.A,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Asharp,map)]=MidiSheetMusic.Accid.Flat;map[System.Array.index(MidiSheetMusic.NoteScale.B,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.C,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Csharp,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.D,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Dsharp,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.E,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.F,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Fsharp,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.G,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Gsharp,map)]=MidiSheetMusic.Accid.None;map=MidiSheetMusic.KeySignature.sharpkeys[System.Array.index(MidiSheetMusic.KeySignature.B,MidiSheetMusic.KeySignature.sharpkeys)];map[System.Array.index(MidiSheetMusic.NoteScale.A,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Asharp,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.B,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.C,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Csharp,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.D,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Dsharp,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.E,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.F,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Fsharp,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.G,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Gsharp,map)]=MidiSheetMusic.Accid.None;map=MidiSheetMusic.KeySignature.flatkeys[System.Array.index(MidiSheetMusic.KeySignature.C,MidiSheetMusic.KeySignature.flatkeys)];map[System.Array.index(MidiSheetMusic.NoteScale.A,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Asharp,map)]=MidiSheetMusic.Accid.Flat;map[System.Array.index(MidiSheetMusic.NoteScale.B,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.C,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Csharp,map)]=MidiSheetMusic.Accid.Sharp;map[System.Array.index(MidiSheetMusic.NoteScale.D,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Dsharp,map)]=MidiSheetMusic.Accid.Sharp;map[System.Array.index(MidiSheetMusic.NoteScale.E,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.F,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Fsharp,map)]=MidiSheetMusic.Accid.Sharp;map[System.Array.index(MidiSheetMusic.NoteScale.G,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Gsharp,map)]=MidiSheetMusic.Accid.Sharp;map=MidiSheetMusic.KeySignature.flatkeys[System.Array.index(MidiSheetMusic.KeySignature.F,MidiSheetMusic.KeySignature.flatkeys)];map[System.Array.index(MidiSheetMusic.NoteScale.A,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Bflat,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.B,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.C,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Csharp,map)]=MidiSheetMusic.Accid.Sharp;map[System.Array.index(MidiSheetMusic.NoteScale.D,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Eflat,map)]=MidiSheetMusic.Accid.Flat;map[System.Array.index(MidiSheetMusic.NoteScale.E,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.F,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Fsharp,map)]=MidiSheetMusic.Accid.Sharp;map[System.Array.index(MidiSheetMusic.NoteScale.G,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Aflat,map)]=MidiSheetMusic.Accid.Flat;map=MidiSheetMusic.KeySignature.flatkeys[System.Array.index(MidiSheetMusic.KeySignature.Bflat,MidiSheetMusic.KeySignature.flatkeys)];map[System.Array.index(MidiSheetMusic.NoteScale.A,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Bflat,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.B,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.C,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Csharp,map)]=MidiSheetMusic.Accid.Sharp;map[System.Array.index(MidiSheetMusic.NoteScale.D,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Eflat,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.E,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.F,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Fsharp,map)]=MidiSheetMusic.Accid.Sharp;map[System.Array.index(MidiSheetMusic.NoteScale.G,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Aflat,map)]=MidiSheetMusic.Accid.Flat;map=MidiSheetMusic.KeySignature.flatkeys[System.Array.index(MidiSheetMusic.KeySignature.Eflat,MidiSheetMusic.KeySignature.flatkeys)];map[System.Array.index(MidiSheetMusic.NoteScale.A,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Bflat,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.B,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.C,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Dflat,map)]=MidiSheetMusic.Accid.Flat;map[System.Array.index(MidiSheetMusic.NoteScale.D,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Eflat,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.E,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.F,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Fsharp,map)]=MidiSheetMusic.Accid.Sharp;map[System.Array.index(MidiSheetMusic.NoteScale.G,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Aflat,map)]=MidiSheetMusic.Accid.None;map=MidiSheetMusic.KeySignature.flatkeys[System.Array.index(MidiSheetMusic.KeySignature.Aflat,MidiSheetMusic.KeySignature.flatkeys)];map[System.Array.index(MidiSheetMusic.NoteScale.A,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Bflat,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.B,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.C,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Dflat,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.D,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Eflat,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.E,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.F,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Fsharp,map)]=MidiSheetMusic.Accid.Sharp;map[System.Array.index(MidiSheetMusic.NoteScale.G,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Aflat,map)]=MidiSheetMusic.Accid.None;map=MidiSheetMusic.KeySignature.flatkeys[System.Array.index(MidiSheetMusic.KeySignature.Dflat,MidiSheetMusic.KeySignature.flatkeys)];map[System.Array.index(MidiSheetMusic.NoteScale.A,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Bflat,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.B,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.C,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Dflat,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.D,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Eflat,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.E,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.F,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Gflat,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.G,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Aflat,map)]=MidiSheetMusic.Accid.None;map=MidiSheetMusic.KeySignature.flatkeys[System.Array.index(MidiSheetMusic.KeySignature.Gflat,MidiSheetMusic.KeySignature.flatkeys)];map[System.Array.index(MidiSheetMusic.NoteScale.A,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Bflat,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.B,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.C,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Dflat,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.D,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Eflat,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.E,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.F,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.Gflat,map)]=MidiSheetMusic.Accid.None;map[System.Array.index(MidiSheetMusic.NoteScale.G,map)]=MidiSheetMusic.Accid.Natural;map[System.Array.index(MidiSheetMusic.NoteScale.Aflat,map)]=MidiSheetMusic.Accid.None}},Guess:function(notes){var $t,$t1,notecount,i,notenumber,notescale,accid_count,n,accid_count1,n1;for(MidiSheetMusic.KeySignature.CreateAccidentalMaps(),notecount=System.Array.init(12,0,System.Int32),i=0;i<notes.Count;i=i+1|0)notenumber=notes.getItem(i),notescale=(notenumber+3|0)%12,notecount[System.Array.index(notescale,notecount)]=notecount[System.Array.index(notescale,notecount)]+1|0;for(var bestkey=0,is_best_sharp=!0,smallest_accid_count=notes.Count,key=0;key<6;key=key+1|0){for(accid_count=0,n=0;n<12;n=n+1|0)($t=MidiSheetMusic.KeySignature.sharpkeys[System.Array.index(key,MidiSheetMusic.KeySignature.sharpkeys)])[System.Array.index(n,$t)]!==MidiSheetMusic.Accid.None&&(accid_count=accid_count+notecount[System.Array.index(n,notecount)]|0);accid_count<smallest_accid_count&&(smallest_accid_count=accid_count,bestkey=key,is_best_sharp=!0)}for(key=0;key<7;key=key+1|0){for(accid_count1=0,n1=0;n1<12;n1=n1+1|0)($t1=MidiSheetMusic.KeySignature.flatkeys[System.Array.index(key,MidiSheetMusic.KeySignature.flatkeys)])[System.Array.index(n1,$t1)]!==MidiSheetMusic.Accid.None&&(accid_count1=accid_count1+notecount[System.Array.index(n1,notecount)]|0);accid_count1<smallest_accid_count&&(smallest_accid_count=accid_count1,bestkey=key,is_best_sharp=!1)}return is_best_sharp?new MidiSheetMusic.KeySignature.$ctor1(bestkey,0):new MidiSheetMusic.KeySignature.$ctor1(0,bestkey)},KeyToString:function(notescale){switch(notescale){case MidiSheetMusic.NoteScale.A:return"A major, F# minor";case MidiSheetMusic.NoteScale.Bflat:return"B-flat major, G minor";case MidiSheetMusic.NoteScale.B:return"B major, A-flat minor";case MidiSheetMusic.NoteScale.C:return"C major, A minor";case MidiSheetMusic.NoteScale.Dflat:return"D-flat major, B-flat minor";case MidiSheetMusic.NoteScale.D:return"D major, B minor";case MidiSheetMusic.NoteScale.Eflat:return"E-flat major, C minor";case MidiSheetMusic.NoteScale.E:return"E major, C# minor";case MidiSheetMusic.NoteScale.F:return"F major, D minor";case MidiSheetMusic.NoteScale.Gflat:return"G-flat major, E-flat minor";case MidiSheetMusic.NoteScale.G:return"G major, E minor";case MidiSheetMusic.NoteScale.Aflat:return"A-flat major, F minor";default:return""}}}},fields:{num_flats:0,num_sharps:0,treble:null,bass:null,keymap:null,prevmeasure:0},ctors:{$ctor1:function(num_sharps,num_flats){if(this.$initialize(),!(num_sharps===0||num_flats===0))throw new System.ArgumentException("Bad KeySigature args");this.num_sharps=num_sharps;this.num_flats=num_flats;MidiSheetMusic.KeySignature.CreateAccidentalMaps();this.keymap=System.Array.init(160,0,MidiSheetMusic.Accid);this.ResetKeyMap();this.CreateSymbols()},ctor:function(notescale){this.$initialize();this.num_sharps=this.num_flats=0;switch(notescale){case MidiSheetMusic.NoteScale.A:this.num_sharps=3;break;case MidiSheetMusic.NoteScale.Bflat:this.num_flats=2;break;case MidiSheetMusic.NoteScale.B:this.num_sharps=5;break;case MidiSheetMusic.NoteScale.Dflat:this.num_flats=5;break;case MidiSheetMusic.NoteScale.D:this.num_sharps=2;break;case MidiSheetMusic.NoteScale.Eflat:this.num_flats=3;break;case MidiSheetMusic.NoteScale.E:this.num_sharps=4;break;case MidiSheetMusic.NoteScale.F:this.num_flats=1;break;case MidiSheetMusic.NoteScale.Gflat:this.num_flats=6;break;case MidiSheetMusic.NoteScale.G:this.num_sharps=1;break;case MidiSheetMusic.NoteScale.Aflat:this.num_flats=4}MidiSheetMusic.KeySignature.CreateAccidentalMaps();this.keymap=System.Array.init(160,0,MidiSheetMusic.Accid);this.ResetKeyMap();this.CreateSymbols()}},methods:{ResetKeyMap:function(){for(var key=this.num_flats>0?MidiSheetMusic.KeySignature.flatkeys[System.Array.index(this.num_flats,MidiSheetMusic.KeySignature.flatkeys)]:MidiSheetMusic.KeySignature.sharpkeys[System.Array.index(this.num_sharps,MidiSheetMusic.KeySignature.sharpkeys)],notenumber=0;notenumber<this.keymap.length;notenumber=notenumber+1|0)this.keymap[System.Array.index(notenumber,this.keymap)]=key[System.Array.index(MidiSheetMusic.NoteScale.FromNumber(notenumber),key)]},CreateSymbols:function(){var count=Math.max(this.num_sharps,this.num_flats),treblenotes,bassnotes,a,i;if(this.treble=System.Array.init(count,null,MidiSheetMusic.AccidSymbol),this.bass=System.Array.init(count,null,MidiSheetMusic.AccidSymbol),count!==0)for(treblenotes=null,bassnotes=null,this.num_sharps>0?(treblenotes=System.Array.init([new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.F,5),new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.C,5),new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.G,5),new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.D,5),new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.A,6),new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.E,5)],MidiSheetMusic.WhiteNote),bassnotes=System.Array.init([new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.F,3),new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.C,3),new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.G,3),new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.D,3),new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.A,4),new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.E,3)],MidiSheetMusic.WhiteNote)):this.num_flats>0&&(treblenotes=System.Array.init([new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.B,5),new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.E,5),new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.A,5),new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.D,5),new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.G,4),new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.C,5)],MidiSheetMusic.WhiteNote),bassnotes=System.Array.init([new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.B,3),new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.E,3),new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.A,3),new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.D,3),new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.G,2),new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.C,3)],MidiSheetMusic.WhiteNote)),a=MidiSheetMusic.Accid.None,a=this.num_sharps>0?MidiSheetMusic.Accid.Sharp:MidiSheetMusic.Accid.Flat,i=0;i<count;i=i+1|0)this.treble[System.Array.index(i,this.treble)]=new MidiSheetMusic.AccidSymbol(a,treblenotes[System.Array.index(i,treblenotes)],MidiSheetMusic.Clef.Treble),this.bass[System.Array.index(i,this.bass)]=new MidiSheetMusic.AccidSymbol(a,bassnotes[System.Array.index(i,bassnotes)],MidiSheetMusic.Clef.Bass)},GetSymbols:function(clef){return clef===MidiSheetMusic.Clef.Treble?this.treble:this.bass},GetAccidental:function(notenumber,measure){var result,nextkey,prevkey;return measure!==this.prevmeasure&&(this.ResetKeyMap(),this.prevmeasure=measure),result=this.keymap[System.Array.index(notenumber,this.keymap)],result===MidiSheetMusic.Accid.Sharp?(this.keymap[System.Array.index(notenumber,this.keymap)]=MidiSheetMusic.Accid.None,this.keymap[System.Array.index(notenumber-1|0,this.keymap)]=MidiSheetMusic.Accid.Natural):result===MidiSheetMusic.Accid.Flat?(this.keymap[System.Array.index(notenumber,this.keymap)]=MidiSheetMusic.Accid.None,this.keymap[System.Array.index(notenumber+1|0,this.keymap)]=MidiSheetMusic.Accid.Natural):result===MidiSheetMusic.Accid.Natural&&(this.keymap[System.Array.index(notenumber,this.keymap)]=MidiSheetMusic.Accid.None,nextkey=MidiSheetMusic.NoteScale.FromNumber(notenumber+1|0),prevkey=MidiSheetMusic.NoteScale.FromNumber(notenumber-1|0),this.keymap[System.Array.index(notenumber-1|0,this.keymap)]===MidiSheetMusic.Accid.None&&this.keymap[System.Array.index(notenumber+1|0,this.keymap)]===MidiSheetMusic.Accid.None&&MidiSheetMusic.NoteScale.IsBlackKey(nextkey)&&MidiSheetMusic.NoteScale.IsBlackKey(prevkey)?this.num_flats===0?this.keymap[System.Array.index(notenumber+1|0,this.keymap)]=MidiSheetMusic.Accid.Sharp:this.keymap[System.Array.index(notenumber-1|0,this.keymap)]=MidiSheetMusic.Accid.Flat:this.keymap[System.Array.index(notenumber-1|0,this.keymap)]===MidiSheetMusic.Accid.None&&MidiSheetMusic.NoteScale.IsBlackKey(prevkey)?this.keymap[System.Array.index(notenumber-1|0,this.keymap)]=MidiSheetMusic.Accid.Flat:this.keymap[System.Array.index(notenumber+1|0,this.keymap)]===MidiSheetMusic.Accid.None&&MidiSheetMusic.NoteScale.IsBlackKey(nextkey)&&(this.keymap[System.Array.index(notenumber+1|0,this.keymap)]=MidiSheetMusic.Accid.Sharp)),result},GetWhiteNote:function(notenumber){var notescale=MidiSheetMusic.NoteScale.FromNumber(notenumber),octave=(Bridge.Int.div(notenumber+3|0,12)|0)-1|0,letter=0,whole_sharps=System.Array.init([MidiSheetMusic.WhiteNote.A,MidiSheetMusic.WhiteNote.A,MidiSheetMusic.WhiteNote.B,MidiSheetMusic.WhiteNote.C,MidiSheetMusic.WhiteNote.C,MidiSheetMusic.WhiteNote.D,MidiSheetMusic.WhiteNote.D,MidiSheetMusic.WhiteNote.E,MidiSheetMusic.WhiteNote.F,MidiSheetMusic.WhiteNote.F,MidiSheetMusic.WhiteNote.G,MidiSheetMusic.WhiteNote.G],System.Int32),whole_flats=System.Array.init([MidiSheetMusic.WhiteNote.A,MidiSheetMusic.WhiteNote.B,MidiSheetMusic.WhiteNote.B,MidiSheetMusic.WhiteNote.C,MidiSheetMusic.WhiteNote.D,MidiSheetMusic.WhiteNote.D,MidiSheetMusic.WhiteNote.E,MidiSheetMusic.WhiteNote.E,MidiSheetMusic.WhiteNote.F,MidiSheetMusic.WhiteNote.G,MidiSheetMusic.WhiteNote.G,MidiSheetMusic.WhiteNote.A],System.Int32),accid=this.keymap[System.Array.index(notenumber,this.keymap)];return accid===MidiSheetMusic.Accid.Flat?letter=whole_flats[System.Array.index(notescale,whole_flats)]:accid===MidiSheetMusic.Accid.Sharp?letter=whole_sharps[System.Array.index(notescale,whole_sharps)]:accid===MidiSheetMusic.Accid.Natural?letter=whole_sharps[System.Array.index(notescale,whole_sharps)]:accid===MidiSheetMusic.Accid.None&&(letter=whole_sharps[System.Array.index(notescale,whole_sharps)],MidiSheetMusic.NoteScale.IsBlackKey(notescale)&&(this.keymap[System.Array.index(notenumber-1|0,this.keymap)]===MidiSheetMusic.Accid.Natural&&this.keymap[System.Array.index(notenumber+1|0,this.keymap)]===MidiSheetMusic.Accid.Natural?letter=this.num_flats>0?whole_flats[System.Array.index(notescale,whole_flats)]:whole_sharps[System.Array.index(notescale,whole_sharps)]:this.keymap[System.Array.index(notenumber-1|0,this.keymap)]===MidiSheetMusic.Accid.Natural?letter=whole_sharps[System.Array.index(notescale,whole_sharps)]:this.keymap[System.Array.index(notenumber+1|0,this.keymap)]===MidiSheetMusic.Accid.Natural&&(letter=whole_flats[System.Array.index(notescale,whole_flats)]))),this.num_flats===MidiSheetMusic.KeySignature.Gflat&&notescale===MidiSheetMusic.NoteScale.B&&(letter=MidiSheetMusic.WhiteNote.C),this.num_flats===MidiSheetMusic.KeySignature.Gflat&&notescale===MidiSheetMusic.NoteScale.Bflat&&(letter=MidiSheetMusic.WhiteNote.B),this.num_flats>0&&notescale===MidiSheetMusic.NoteScale.Aflat&&(octave=octave+1|0),new MidiSheetMusic.WhiteNote(letter,octave)},Equals:function(k){return k.num_sharps===this.num_sharps&&k.num_flats===this.num_flats?!0:!1},Notescale:function(){var flatmajor=System.Array.init([MidiSheetMusic.NoteScale.C,MidiSheetMusic.NoteScale.F,MidiSheetMusic.NoteScale.Bflat,MidiSheetMusic.NoteScale.Eflat,MidiSheetMusic.NoteScale.Aflat,MidiSheetMusic.NoteScale.Dflat,MidiSheetMusic.NoteScale.Gflat,MidiSheetMusic.NoteScale.B],System.Int32),sharpmajor=System.Array.init([MidiSheetMusic.NoteScale.C,MidiSheetMusic.NoteScale.G,MidiSheetMusic.NoteScale.D,MidiSheetMusic.NoteScale.A,MidiSheetMusic.NoteScale.E,MidiSheetMusic.NoteScale.B,MidiSheetMusic.NoteScale.Fsharp,MidiSheetMusic.NoteScale.Csharp,MidiSheetMusic.NoteScale.Gsharp,MidiSheetMusic.NoteScale.Dsharp],System.Int32);return this.num_flats>0?flatmajor[System.Array.index(this.num_flats,flatmajor)]:sharpmajor[System.Array.index(this.num_sharps,sharpmajor)]},toString:function(){return MidiSheetMusic.KeySignature.KeyToString(this.Notescale())}}});Bridge.define("MidiSheetMusic.LineCap",{$kind:"enum",statics:{fields:{Flat:0}}});Bridge.define("MidiSheetMusic.LyricSymbol",{fields:{starttime:0,text:null,x:0},props:{StartTime:{get:function(){return this.starttime},set:function(value){this.starttime=value}},Text:{get:function(){return this.text},set:function(value){this.text=value}},X:{get:function(){return this.x},set:function(value){this.x=value}},MinWidth:{get:function(){return this.minWidth()}}},ctors:{ctor:function(starttime,text){this.$initialize();this.starttime=starttime;this.text=text}},methods:{minWidth:function(){var widthPerChar=MidiSheetMusic.SheetMusic.LetterFont.GetHeight()*2/3,width=this.text.length*widthPerChar;return System.String.indexOf(this.text,"i")>=0&&(width-=widthPerChar/2),System.String.indexOf(this.text,"j")>=0&&(width-=widthPerChar/2),System.String.indexOf(this.text,"l")>=0&&(width-=widthPerChar/2),Bridge.Int.clip32(width)},toString:function(){return System.String.format("Lyric start={0} x={1} text={2}",Bridge.box(this.starttime,System.Int32),Bridge.box(this.x,System.Int32),this.text)}}});Bridge.define("MidiSheetMusic.MidiEvent",{inherits:function(){return[System.Collections.Generic.IComparer$1(MidiSheetMusic.MidiEvent)]},fields:{DeltaTime:0,StartTime:0,HasEventflag:!1,EventFlag:0,Channel:0,Notenumber:0,Velocity:0,Instrument:0,KeyPressure:0,ChanPressure:0,ControlNum:0,ControlValue:0,PitchBend:0,Numerator:0,Denominator:0,Tempo:0,Metaevent:0,Metalength:0,Value:null},alias:["compare",["System$Collections$Generic$IComparer$1$MidiSheetMusic$MidiEvent$compare","System$Collections$Generic$IComparer$1$compare"]],ctors:{ctor:function(){this.$initialize()}},methods:{Clone:function(){var mevent=new MidiSheetMusic.MidiEvent;return mevent.DeltaTime=this.DeltaTime,mevent.StartTime=this.StartTime,mevent.HasEventflag=this.HasEventflag,mevent.EventFlag=this.EventFlag,mevent.Channel=this.Channel,mevent.Notenumber=this.Notenumber,mevent.Velocity=this.Velocity,mevent.Instrument=this.Instrument,mevent.KeyPressure=this.KeyPressure,mevent.ChanPressure=this.ChanPressure,mevent.ControlNum=this.ControlNum,mevent.ControlValue=this.ControlValue,mevent.PitchBend=this.PitchBend,mevent.Numerator=this.Numerator,mevent.Denominator=this.Denominator,mevent.Tempo=this.Tempo,mevent.Metaevent=this.Metaevent,mevent.Metalength=this.Metalength,mevent.Value=this.Value,mevent},compare:function(x,y){return x.StartTime===y.StartTime?x.EventFlag===y.EventFlag?x.Notenumber-y.Notenumber|0:x.EventFlag-y.EventFlag|0:x.StartTime-y.StartTime|0}}});Bridge.define("MidiSheetMusic.MidiFile",{statics:{fields:{EventNoteOff:0,EventNoteOn:0,EventKeyPressure:0,EventControlChange:0,EventProgramChange:0,EventChannelPressure:0,EventPitchBend:0,SysexEvent1:0,SysexEvent2:0,MetaEvent:0,MetaEventSequence:0,MetaEventText:0,MetaEventCopyright:0,MetaEventSequenceName:0,MetaEventInstrument:0,MetaEventLyric:0,MetaEventMarker:0,MetaEventEndOfTrack:0,MetaEventTempo:0,MetaEventSMPTEOffset:0,MetaEventTimeSignature:0,MetaEventKeySignature:0,Instruments:null},ctors:{init:function(){this.EventNoteOff=128;this.EventNoteOn=144;this.EventKeyPressure=160;this.EventControlChange=176;this.EventProgramChange=192;this.EventChannelPressure=208;this.EventPitchBend=224;this.SysexEvent1=240;this.SysexEvent2=247;this.MetaEvent=255;this.MetaEventSequence=0;this.MetaEventText=1;this.MetaEventCopyright=2;this.MetaEventSequenceName=3;this.MetaEventInstrument=4;this.MetaEventLyric=5;this.MetaEventMarker=6;this.MetaEventEndOfTrack=47;this.MetaEventTempo=81;this.MetaEventSMPTEOffset=84;this.MetaEventTimeSignature=88;this.MetaEventKeySignature=89;this.Instruments=System.Array.init(["Acoustic Grand Piano","Bright Acoustic Piano","Electric Grand Piano","Honky-tonk Piano","Electric Piano 1","Electric Piano 2","Harpsichord","Clavi","Celesta","Glockenspiel","Music Box","Vibraphone","Marimba","Xylophone","Tubular Bells","Dulcimer","Drawbar Organ","Percussive Organ","Rock Organ","Church Organ","Reed Organ","Accordion","Harmonica","Tango Accordion","Acoustic Guitar (nylon)","Acoustic Guitar (steel)","Electric Guitar (jazz)","Electric Guitar (clean)","Electric Guitar (muted)","Overdriven Guitar","Distortion Guitar","Guitar harmonics","Acoustic Bass","Electric Bass (finger)","Electric Bass (pick)","Fretless Bass","Slap Bass 1","Slap Bass 2","Synth Bass 1","Synth Bass 2","Violin","Viola","Cello","Contrabass","Tremolo Strings","Pizzicato Strings","Orchestral Harp","Timpani","String Ensemble 1","String Ensemble 2","SynthStrings 1","SynthStrings 2","Choir Aahs","Voice Oohs","Synth Voice","Orchestra Hit","Trumpet","Trombone","Tuba","Muted Trumpet","French Horn","Brass Section","SynthBrass 1","SynthBrass 2","Soprano Sax","Alto Sax","Tenor Sax","Baritone Sax","Oboe","English Horn","Bassoon","Clarinet","Piccolo","Flute","Recorder","Pan Flute","Blown Bottle","Shakuhachi","Whistle","Ocarina","Lead 1 (square)","Lead 2 (sawtooth)","Lead 3 (calliope)","Lead 4 (chiff)","Lead 5 (charang)","Lead 6 (voice)","Lead 7 (fifths)","Lead 8 (bass + lead)","Pad 1 (new age)","Pad 2 (warm)","Pad 3 (polysynth)","Pad 4 (choir)","Pad 5 (bowed)","Pad 6 (metallic)","Pad 7 (halo)","Pad 8 (sweep)","FX 1 (rain)","FX 2 (soundtrack)","FX 3 (crystal)","FX 4 (atmosphere)","FX 5 (brightness)","FX 6 (goblins)","FX 7 (echoes)","FX 8 (sci-fi)","Sitar","Banjo","Shamisen","Koto","Kalimba","Bag pipe","Fiddle","Shanai","Tinkle Bell","Agogo","Steel Drums","Woodblock","Taiko Drum","Melodic Tom","Synth Drum","Reverse Cymbal","Guitar Fret Noise","Breath Noise","Seashore","Bird Tweet","Telephone Ring","Helicopter","Applause","Gunshot","Percussion"],System.String)}},methods:{HasMultipleChannels:function(track){var $t,channel=track.Notes.getItem(0).Channel,note;$t=Bridge.getEnumerator(track.Notes);try{while($t.moveNext())if(note=$t.Current,note.Channel!==channel)return!0}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return!1},VarlenToBytes:function(num,buf,offset){var b1=num>>21&127,b2=num>>14&127,b3=num>>7&127,b4=num&127;return b1>0?(buf[System.Array.index(offset,buf)]=(b1|128)&255,buf[System.Array.index(offset+1|0,buf)]=(b2|128)&255,buf[System.Array.index(offset+2|0,buf)]=(b3|128)&255,buf[System.Array.index(offset+3|0,buf)]=b4,4):b2>0?(buf[System.Array.index(offset,buf)]=(b2|128)&255,buf[System.Array.index(offset+1|0,buf)]=(b3|128)&255,buf[System.Array.index(offset+2|0,buf)]=b4,3):b3>0?(buf[System.Array.index(offset,buf)]=(b3|128)&255,buf[System.Array.index(offset+1|0,buf)]=b4,2):(buf[System.Array.index(offset,buf)]=b4,1)},IntToBytes:function(value,data,offset){data[System.Array.index(offset,data)]=value>>24&255;data[System.Array.index(offset+1|0,data)]=value>>16&255;data[System.Array.index(offset+2|0,data)]=value>>8&255;data[System.Array.index(offset+3|0,data)]=value&255},GetTrackLength:function(events){var $t,len=0,buf=System.Array.init(1024,0,System.Byte),mevent;$t=Bridge.getEnumerator(events);try{while($t.moveNext()){mevent=$t.Current;len=len+MidiSheetMusic.MidiFile.VarlenToBytes(mevent.DeltaTime,buf,0)|0;len=len+1|0;switch(mevent.EventFlag){case MidiSheetMusic.MidiFile.EventNoteOn:len=len+2|0;break;case MidiSheetMusic.MidiFile.EventNoteOff:len=len+2|0;break;case MidiSheetMusic.MidiFile.EventKeyPressure:len=len+2|0;break;case MidiSheetMusic.MidiFile.EventControlChange:len=len+2|0;break;case MidiSheetMusic.MidiFile.EventProgramChange:len=len+1|0;break;case MidiSheetMusic.MidiFile.EventChannelPressure:len=len+1|0;break;case MidiSheetMusic.MidiFile.EventPitchBend:len=len+2|0;break;case MidiSheetMusic.MidiFile.SysexEvent1:case MidiSheetMusic.MidiFile.SysexEvent2:len=len+MidiSheetMusic.MidiFile.VarlenToBytes(mevent.Metalength,buf,0)|0;len=len+mevent.Metalength|0;break;case MidiSheetMusic.MidiFile.MetaEvent:len=len+1|0;len=len+MidiSheetMusic.MidiFile.VarlenToBytes(mevent.Metalength,buf,0)|0;len=len+mevent.Metalength|0}}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return len},WriteEvents:function(file,events,trackmode,quarter){var $t,$t1,buf,list,len,mevent,varlen,offset,offset1,offset2,e;try{buf=System.Array.init(65536,0,System.Byte);file.Write(System.Text.Encoding.ASCII.GetBytes$2("MThd"),0,4);MidiSheetMusic.MidiFile.IntToBytes(6,buf,0);file.Write(buf,0,4);buf[System.Array.index(0,buf)]=trackmode>>8&255;buf[System.Array.index(1,buf)]=trackmode&255;file.Write(buf,0,2);buf[System.Array.index(0,buf)]=0;buf[System.Array.index(1,buf)]=events.length&255;file.Write(buf,0,2);buf[System.Array.index(0,buf)]=quarter>>8&255;buf[System.Array.index(1,buf)]=quarter&255;file.Write(buf,0,2);$t=Bridge.getEnumerator(events);try{while($t.moveNext()){list=$t.Current;file.Write(System.Text.Encoding.ASCII.GetBytes$2("MTrk"),0,4);len=MidiSheetMusic.MidiFile.GetTrackLength(list);MidiSheetMusic.MidiFile.IntToBytes(len,buf,0);file.Write(buf,0,4);$t1=Bridge.getEnumerator(list);try{while($t1.moveNext())mevent=$t1.Current,varlen=MidiSheetMusic.MidiFile.VarlenToBytes(mevent.DeltaTime,buf,0),file.Write(buf,0,varlen),buf[System.Array.index(0,buf)]=mevent.EventFlag===MidiSheetMusic.MidiFile.SysexEvent1||mevent.EventFlag===MidiSheetMusic.MidiFile.SysexEvent2||mevent.EventFlag===MidiSheetMusic.MidiFile.MetaEvent?mevent.EventFlag:(mevent.EventFlag+mevent.Channel|0)&255,file.Write(buf,0,1),mevent.EventFlag===MidiSheetMusic.MidiFile.EventNoteOn?(buf[System.Array.index(0,buf)]=mevent.Notenumber,buf[System.Array.index(1,buf)]=mevent.Velocity,file.Write(buf,0,2)):mevent.EventFlag===MidiSheetMusic.MidiFile.EventNoteOff?(buf[System.Array.index(0,buf)]=mevent.Notenumber,buf[System.Array.index(1,buf)]=mevent.Velocity,file.Write(buf,0,2)):mevent.EventFlag===MidiSheetMusic.MidiFile.EventKeyPressure?(buf[System.Array.index(0,buf)]=mevent.Notenumber,buf[System.Array.index(1,buf)]=mevent.KeyPressure,file.Write(buf,0,2)):mevent.EventFlag===MidiSheetMusic.MidiFile.EventControlChange?(buf[System.Array.index(0,buf)]=mevent.ControlNum,buf[System.Array.index(1,buf)]=mevent.ControlValue,file.Write(buf,0,2)):mevent.EventFlag===MidiSheetMusic.MidiFile.EventProgramChange?(buf[System.Array.index(0,buf)]=mevent.Instrument,file.Write(buf,0,1)):mevent.EventFlag===MidiSheetMusic.MidiFile.EventChannelPressure?(buf[System.Array.index(0,buf)]=mevent.ChanPressure,file.Write(buf,0,1)):mevent.EventFlag===MidiSheetMusic.MidiFile.EventPitchBend?(buf[System.Array.index(0,buf)]=mevent.PitchBend>>8&255,buf[System.Array.index(1,buf)]=mevent.PitchBend&255,file.Write(buf,0,2)):mevent.EventFlag===MidiSheetMusic.MidiFile.SysexEvent1?(offset=MidiSheetMusic.MidiFile.VarlenToBytes(mevent.Metalength,buf,0),System.Array.copy(mevent.Value,0,buf,offset,mevent.Value.length),file.Write(buf,0,offset+mevent.Value.length|0)):mevent.EventFlag===MidiSheetMusic.MidiFile.SysexEvent2?(offset1=MidiSheetMusic.MidiFile.VarlenToBytes(mevent.Metalength,buf,0),System.Array.copy(mevent.Value,0,buf,offset1,mevent.Value.length),file.Write(buf,0,offset1+mevent.Value.length|0)):mevent.EventFlag===MidiSheetMusic.MidiFile.MetaEvent&&mevent.Metaevent===MidiSheetMusic.MidiFile.MetaEventTempo?(buf[System.Array.index(0,buf)]=mevent.Metaevent,buf[System.Array.index(1,buf)]=3,buf[System.Array.index(2,buf)]=mevent.Tempo>>16&255,buf[System.Array.index(3,buf)]=mevent.Tempo>>8&255,buf[System.Array.index(4,buf)]=mevent.Tempo&255,file.Write(buf,0,5)):mevent.EventFlag===MidiSheetMusic.MidiFile.MetaEvent&&(buf[System.Array.index(0,buf)]=mevent.Metaevent,offset2=MidiSheetMusic.MidiFile.VarlenToBytes(mevent.Metalength,buf,1)+1|0,System.Array.copy(mevent.Value,0,buf,offset2,mevent.Value.length),file.Write(buf,0,offset2+mevent.Value.length|0))}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$dispose()}}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return file.Close(),!0}catch($e1){if($e1=System.Exception.create($e1),Bridge.is($e1,MidiSheetMusic.IOException))return e=$e1,!1;throw $e1;}},CloneMidiEvents:function(origlist){for(var origevents,newevents,mevent,$t,newlist=System.Array.init(origlist.length,null,System.Collections.Generic.List$1(MidiSheetMusic.MidiEvent)),tracknum=0;tracknum<origlist.length;tracknum=tracknum+1|0){origevents=origlist[System.Array.index(tracknum,origlist)];newevents=new(System.Collections.Generic.List$1(MidiSheetMusic.MidiEvent).$ctor2)(origevents.Count);newlist[System.Array.index(tracknum,newlist)]=newevents;$t=Bridge.getEnumerator(origevents);try{while($t.moveNext())mevent=$t.Current,newevents.add(mevent.Clone())}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}}return newlist},CreateTempoEvent:function(tempo){var mevent=new MidiSheetMusic.MidiEvent;return mevent.DeltaTime=0,mevent.StartTime=0,mevent.HasEventflag=!0,mevent.EventFlag=MidiSheetMusic.MidiFile.MetaEvent,mevent.Metaevent=MidiSheetMusic.MidiFile.MetaEventTempo,mevent.Metalength=3,mevent.Tempo=tempo,mevent},UpdateControlChange:function(newevents,changeEvent){var $t,mevent;$t=Bridge.getEnumerator(newevents);try{while($t.moveNext())if(mevent=$t.Current,mevent.EventFlag===changeEvent.EventFlag&&mevent.Channel===changeEvent.Channel&&mevent.ControlNum===changeEvent.ControlNum){mevent.ControlValue=changeEvent.ControlValue;return}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}newevents.add(changeEvent)},StartAtPauseTime:function(list,pauseTime){for(var events,newevents,foundEventAfterPause,mevent,$t,newlist=System.Array.init(list.length,null,System.Collections.Generic.List$1(MidiSheetMusic.MidiEvent)),tracknum=0;tracknum<list.length;tracknum=tracknum+1|0){events=list[System.Array.index(tracknum,list)];newevents=new(System.Collections.Generic.List$1(MidiSheetMusic.MidiEvent).$ctor2)(events.Count);newlist[System.Array.index(tracknum,newlist)]=newevents;foundEventAfterPause=!1;$t=Bridge.getEnumerator(events);try{while($t.moveNext())mevent=$t.Current,mevent.StartTime<pauseTime?mevent.EventFlag===MidiSheetMusic.MidiFile.EventNoteOn||mevent.EventFlag===MidiSheetMusic.MidiFile.EventNoteOff||(mevent.EventFlag===MidiSheetMusic.MidiFile.EventControlChange?(mevent.DeltaTime=0,MidiSheetMusic.MidiFile.UpdateControlChange(newevents,mevent)):(mevent.DeltaTime=0,newevents.add(mevent))):foundEventAfterPause?newevents.add(mevent):(mevent.DeltaTime=mevent.StartTime-pauseTime|0,newevents.add(mevent),foundEventAfterPause=!0)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}}return newlist},ShiftTime:function(tracks,amount){var $t,$t1,track,note;$t=Bridge.getEnumerator(tracks);try{while($t.moveNext()){track=$t.Current;$t1=Bridge.getEnumerator(track.Notes);try{while($t1.moveNext())note=$t1.Current,note.StartTime=note.StartTime+amount|0}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$dispose()}}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}},Transpose:function(tracks,amount){var $t,$t1,track,note;$t=Bridge.getEnumerator(tracks);try{while($t.moveNext()){track=$t.Current;$t1=Bridge.getEnumerator(track.Notes);try{while($t1.moveNext())note=$t1.Current,note.Number=note.Number+amount|0,note.Number<0&&(note.Number=0)}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$dispose()}}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}},FindHighLowNotes:function(notes,measurelen,startindex,starttime,endtime,high,low){var i=startindex;for((starttime+measurelen|0)<endtime&&(endtime=starttime+measurelen|0);i<notes.Count&&notes.getItem(i).StartTime<endtime;){if(notes.getItem(i).EndTime<starttime){i=i+1|0;continue}if((notes.getItem(i).StartTime+measurelen|0)<starttime){i=i+1|0;continue}high.v<notes.getItem(i).Number&&(high.v=notes.getItem(i).Number);low.v>notes.getItem(i).Number&&(low.v=notes.getItem(i).Number);i=i+1|0}},FindExactHighLowNotes:function(notes,startindex,starttime,high,low){for(var i=startindex;notes.getItem(i).StartTime<starttime;)i=i+1|0;while(i<notes.Count&&notes.getItem(i).StartTime===starttime)high.v<notes.getItem(i).Number&&(high.v=notes.getItem(i).Number),low.v>notes.getItem(i).Number&&(low.v=notes.getItem(i).Number),i=i+1|0},SplitTrack:function(track,measurelen){var $t,notes=track.Notes,count=notes.Count,top=new MidiSheetMusic.MidiTrack.$ctor1(1),bottom=new MidiSheetMusic.MidiTrack.$ctor1(2),result=new(System.Collections.Generic.List$1(MidiSheetMusic.MidiTrack).$ctor2)(2);if(result.add(top),result.add(bottom),count===0)return result;var prevhigh=76,prevlow=45,startindex=0;$t=Bridge.getEnumerator(notes);try{while($t.moveNext()){var note=$t.Current,high={},low={},highExact={},lowExact={},number=note.Number;for(high.v=low.v=highExact.v=lowExact.v=number;notes.getItem(startindex).EndTime<note.StartTime;)startindex=startindex+1|0;MidiSheetMusic.MidiFile.FindHighLowNotes(notes,measurelen,startindex,note.StartTime,note.EndTime,high,low);MidiSheetMusic.MidiFile.FindExactHighLowNotes(notes,startindex,note.StartTime,highExact,lowExact);(highExact.v-number|0)>12||(number-lowExact.v|0)>12?(highExact.v-number|0)<=(number-lowExact.v|0)?top.AddNote(note):bottom.AddNote(note):(high.v-number|0)>12||(number-low.v|0)>12?(high.v-number|0)<=(number-low.v|0)?top.AddNote(note):bottom.AddNote(note):(highExact.v-lowExact.v|0)>12?(highExact.v-number|0)<=(number-lowExact.v|0)?top.AddNote(note):bottom.AddNote(note):(high.v-low.v|0)>12?(high.v-number|0)<=(number-low.v|0)?top.AddNote(note):bottom.AddNote(note):(prevhigh-number|0)<=(number-prevlow|0)?top.AddNote(note):bottom.AddNote(note);(high.v-low.v|0)>12&&(prevhigh=high.v,prevlow=low.v)}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return top.Notes.sort$1(track.Notes.getItem(0)),bottom.Notes.sort$1(track.Notes.getItem(0)),result},CombineToSingleTrack:function(tracks){var $t,result=new MidiSheetMusic.MidiTrack.$ctor1(1),track,note,noteindex,notecount,tracknum,prevnote,lowestnote,lowestTrack,tracknum1,track1,note1;if(tracks.Count===0)return result;if(tracks.Count===1){track=tracks.getItem(0);$t=Bridge.getEnumerator(track.Notes);try{while($t.moveNext())note=$t.Current,result.AddNote(note)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return result}for(noteindex=System.Array.init(64,0,System.Int32),notecount=System.Array.init(64,0,System.Int32),tracknum=0;tracknum<tracks.Count;tracknum=tracknum+1|0)noteindex[System.Array.index(tracknum,noteindex)]=0,notecount[System.Array.index(tracknum,notecount)]=tracks.getItem(tracknum).Notes.Count;for(prevnote=null;;){for(lowestnote=null,lowestTrack=-1,tracknum1=0;tracknum1<tracks.Count;tracknum1=tracknum1+1|0)(track1=tracks.getItem(tracknum1),noteindex[System.Array.index(tracknum1,noteindex)]>=notecount[System.Array.index(tracknum1,notecount)])||(note1=track1.Notes.getItem(noteindex[System.Array.index(tracknum1,noteindex)]),lowestnote==null?(lowestnote=note1,lowestTrack=tracknum1):note1.StartTime<lowestnote.StartTime?(lowestnote=note1,lowestTrack=tracknum1):note1.StartTime===lowestnote.StartTime&&note1.Number<lowestnote.Number&&(lowestnote=note1,lowestTrack=tracknum1));if(lowestnote==null)break;noteindex[System.Array.index(lowestTrack,noteindex)]=noteindex[System.Array.index(lowestTrack,noteindex)]+1|0;prevnote!=null&&prevnote.StartTime===lowestnote.StartTime&&prevnote.Number===lowestnote.Number?lowestnote.Duration>prevnote.Duration&&(prevnote.Duration=lowestnote.Duration):(result.AddNote(lowestnote),prevnote=lowestnote)}return result},CombineToTwoTracks:function(tracks,measurelen){var $t,single=MidiSheetMusic.MidiFile.CombineToSingleTrack(tracks),result=MidiSheetMusic.MidiFile.SplitTrack(single,measurelen),lyrics=new(System.Collections.Generic.List$1(MidiSheetMusic.MidiEvent).ctor),track;$t=Bridge.getEnumerator(tracks);try{while($t.moveNext())track=$t.Current,track.Lyrics!=null&&lyrics.addRange(track.Lyrics)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return lyrics.Count>0&&(lyrics.sort$1(lyrics.getItem(0)),result.getItem(0).Lyrics=lyrics),result},CheckStartTimes:function(tracks){var $t,$t1,track,prevtime,note;$t=Bridge.getEnumerator(tracks);try{while($t.moveNext()){track=$t.Current;prevtime=-1;$t1=Bridge.getEnumerator(track.Notes);try{while($t1.moveNext()){if(note=$t1.Current,note.StartTime<prevtime)throw new System.ArgumentException("start times not in increasing order");prevtime=note.StartTime}}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$dispose()}}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}},RoundStartTimes:function(tracks,millisec,time){var $t,$t1,$t2,$t3,starttimes=new(System.Collections.Generic.List$1(System.Int32).ctor),track,note,interval,i,track1,i1,note1;$t=Bridge.getEnumerator(tracks);try{while($t.moveNext()){track=$t.Current;$t1=Bridge.getEnumerator(track.Notes);try{while($t1.moveNext())note=$t1.Current,starttimes.add(note.StartTime)}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$dispose()}}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}for(starttimes.sort(),interval=Bridge.Int.div(Bridge.Int.mul(Bridge.Int.mul(time.Quarter,millisec),1e3),time.Tempo)|0,i=0;i<(starttimes.Count-1|0);i=i+1|0)(starttimes.getItem(i+1|0)-starttimes.getItem(i)|0)<=interval&&starttimes.setItem(i+1|0,starttimes.getItem(i));MidiSheetMusic.MidiFile.CheckStartTimes(tracks);$t2=Bridge.getEnumerator(tracks);try{while($t2.moveNext()){track1=$t2.Current;i1=0;$t3=Bridge.getEnumerator(track1.Notes);try{while($t3.moveNext()){for(note1=$t3.Current;i1<starttimes.Count&&(note1.StartTime-interval|0)>starttimes.getItem(i1);)i1=i1+1|0;note1.StartTime>starttimes.getItem(i1)&&(note1.StartTime-starttimes.getItem(i1)|0)<=interval&&(note1.StartTime=starttimes.getItem(i1))}}finally{Bridge.is($t3,System.IDisposable)&&$t3.System$IDisposable$dispose()}track1.Notes.sort$1(track1.Notes.getItem(0))}}finally{Bridge.is($t2,System.IDisposable)&&$t2.System$IDisposable$dispose()}},RoundDurations:function(tracks,quarternote){var $t,track,prevNote,i,note1,note2,j,maxduration,dur;$t=Bridge.getEnumerator(tracks);try{while($t.moveNext())for(track=$t.Current,prevNote=null,i=0;i<(track.Notes.Count-1|0);i=i+1|0){for(note1=track.Notes.getItem(i),prevNote==null&&(prevNote=note1),note2=note1,j=i+1|0;j<track.Notes.Count;j=j+1|0)if(note2=track.Notes.getItem(j),note1.StartTime<note2.StartTime)break;maxduration=note2.StartTime-note1.StartTime|0;dur=0;quarternote<=maxduration?dur=quarternote:(Bridge.Int.div(quarternote,2)|0)<=maxduration?dur=Bridge.Int.div(quarternote,2)|0:(Bridge.Int.div(quarternote,3)|0)<=maxduration?dur=Bridge.Int.div(quarternote,3)|0:(Bridge.Int.div(quarternote,4)|0)<=maxduration&&(dur=Bridge.Int.div(quarternote,4)|0);dur<note1.Duration&&(dur=note1.Duration);(prevNote.StartTime+prevNote.Duration|0)===note1.StartTime&&prevNote.Duration===note1.Duration&&(dur=note1.Duration);note1.Duration=dur;track.Notes.getItem(i+1|0).StartTime!==note1.StartTime&&(prevNote=note1)}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}},SplitChannels:function(origtrack,events){var $t,$t1,$t2,$t3,$t4,channelInstruments=System.Array.init(16,0,System.Int32),mevent,result,note,foundchannel,track,track1,lyricEvent,track2;$t=Bridge.getEnumerator(events);try{while($t.moveNext())mevent=$t.Current,mevent.EventFlag===MidiSheetMusic.MidiFile.EventProgramChange&&(channelInstruments[System.Array.index(mevent.Channel,channelInstruments)]=mevent.Instrument)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}channelInstruments[System.Array.index(9,channelInstruments)]=128;result=new(System.Collections.Generic.List$1(MidiSheetMusic.MidiTrack).ctor);$t1=Bridge.getEnumerator(origtrack.Notes);try{while($t1.moveNext()){note=$t1.Current;foundchannel=!1;$t2=Bridge.getEnumerator(result);try{while($t2.moveNext())track=$t2.Current,note.Channel===track.Notes.getItem(0).Channel&&(foundchannel=!0,track.AddNote(note))}finally{Bridge.is($t2,System.IDisposable)&&$t2.System$IDisposable$dispose()}foundchannel||(track1=new MidiSheetMusic.MidiTrack.$ctor1(result.Count+1|0),track1.AddNote(note),track1.Instrument=channelInstruments[System.Array.index(note.Channel,channelInstruments)],result.add(track1))}}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$dispose()}if(origtrack.Lyrics!=null){$t3=Bridge.getEnumerator(origtrack.Lyrics);try{while($t3.moveNext()){lyricEvent=$t3.Current;$t4=Bridge.getEnumerator(result);try{while($t4.moveNext())track2=$t4.Current,lyricEvent.Channel===track2.Notes.getItem(0).Channel&&track2.AddLyric(lyricEvent)}finally{Bridge.is($t4,System.IDisposable)&&$t4.System$IDisposable$dispose()}}}finally{Bridge.is($t3,System.IDisposable)&&$t3.System$IDisposable$dispose()}}return result}}},fields:{filename:null,events:null,tracks:null,trackmode:0,timesig:null,quarternote:0,totalpulses:0,trackPerChannel:!1},props:{Tracks:{get:function(){return this.tracks}},Time:{get:function(){return this.timesig}},FileName:{get:function(){return this.filename}},TotalPulses:{get:function(){return this.totalpulses}}},ctors:{ctor:function(data,title){this.$initialize();var file=new MidiSheetMusic.MidiFileReader(data);title==null&&(title="");this.parse(file,title)}},methods:{EventName:function(ev){return ev>=MidiSheetMusic.MidiFile.EventNoteOff&&ev<144?"NoteOff":ev>=MidiSheetMusic.MidiFile.EventNoteOn&&ev<160?"NoteOn":ev>=MidiSheetMusic.MidiFile.EventKeyPressure&&ev<176?"KeyPressure":ev>=MidiSheetMusic.MidiFile.EventControlChange&&ev<192?"ControlChange":ev>=MidiSheetMusic.MidiFile.EventProgramChange&&ev<208?"ProgramChange":ev>=MidiSheetMusic.MidiFile.EventChannelPressure&&ev<224?"ChannelPressure":ev>=MidiSheetMusic.MidiFile.EventPitchBend&&ev<240?"PitchBend":ev===MidiSheetMusic.MidiFile.MetaEvent?"MetaEvent":ev===MidiSheetMusic.MidiFile.SysexEvent1||ev===MidiSheetMusic.MidiFile.SysexEvent2?"SysexEvent":"Unknown"},MetaName:function(ev){return ev===MidiSheetMusic.MidiFile.MetaEventSequence?"MetaEventSequence":ev===MidiSheetMusic.MidiFile.MetaEventText?"MetaEventText":ev===MidiSheetMusic.MidiFile.MetaEventCopyright?"MetaEventCopyright":ev===MidiSheetMusic.MidiFile.MetaEventSequenceName?"MetaEventSequenceName":ev===MidiSheetMusic.MidiFile.MetaEventInstrument?"MetaEventInstrument":ev===MidiSheetMusic.MidiFile.MetaEventLyric?"MetaEventLyric":ev===MidiSheetMusic.MidiFile.MetaEventMarker?"MetaEventMarker":ev===MidiSheetMusic.MidiFile.MetaEventEndOfTrack?"MetaEventEndOfTrack":ev===MidiSheetMusic.MidiFile.MetaEventTempo?"MetaEventTempo":ev===MidiSheetMusic.MidiFile.MetaEventSMPTEOffset?"MetaEventSMPTEOffset":ev===MidiSheetMusic.MidiFile.MetaEventTimeSignature?"MetaEventTimeSignature":ev===MidiSheetMusic.MidiFile.MetaEventKeySignature?"MetaEventKeySignature":"Unknown"},parse:function(file,filename){var $t,$t1,$t2,id,len,num_tracks,tracknum,track,track1,last,list,mevent;if(this.filename=filename,this.tracks=new(System.Collections.Generic.List$1(MidiSheetMusic.MidiTrack).ctor),this.trackPerChannel=!1,id=file.ReadAscii(4),!Bridge.referenceEquals(id,"MThd"))throw new MidiSheetMusic.MidiFileException("Doesn't start with MThd",0);if(len=file.ReadInt(),len!==6)throw new MidiSheetMusic.MidiFileException("Bad MThd header",4);for(this.trackmode=file.ReadShort(),num_tracks=file.ReadShort(),this.quarternote=file.ReadShort(),this.events=System.Array.init(num_tracks,null,System.Collections.Generic.List$1(MidiSheetMusic.MidiEvent)),tracknum=0;tracknum<num_tracks;tracknum=tracknum+1|0)this.events[System.Array.index(tracknum,this.events)]=this.ReadTrack(file),track=new MidiSheetMusic.MidiTrack.ctor(this.events[System.Array.index(tracknum,this.events)],tracknum),(track.Notes.Count>0||track.Lyrics!=null)&&this.tracks.add(track);$t=Bridge.getEnumerator(this.tracks);try{while($t.moveNext())track1=$t.Current,last=track1.Notes.getItem(track1.Notes.Count-1|0),this.totalpulses<(last.StartTime+last.Duration|0)&&(this.totalpulses=last.StartTime+last.Duration|0)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}this.tracks.Count===1&&MidiSheetMusic.MidiFile.HasMultipleChannels(this.tracks.getItem(0))&&(this.tracks=MidiSheetMusic.MidiFile.SplitChannels(this.tracks.getItem(0),this.events[System.Array.index(this.tracks.getItem(0).Number,this.events)]),this.trackPerChannel=!0);MidiSheetMusic.MidiFile.CheckStartTimes(this.tracks);var tempo=0,numer=0,denom=0;$t1=Bridge.getEnumerator(this.events);try{while($t1.moveNext()){list=$t1.Current;$t2=Bridge.getEnumerator(list);try{while($t2.moveNext())mevent=$t2.Current,mevent.Metaevent===MidiSheetMusic.MidiFile.MetaEventTempo&&tempo===0&&(tempo=mevent.Tempo),mevent.Metaevent===MidiSheetMusic.MidiFile.MetaEventTimeSignature&&numer===0&&(numer=mevent.Numerator,denom=mevent.Denominator)}finally{Bridge.is($t2,System.IDisposable)&&$t2.System$IDisposable$dispose()}}}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$dispose()}tempo===0&&(tempo=5e5);numer===0&&(numer=4,denom=4);this.timesig=new MidiSheetMusic.TimeSignature(numer,denom,this.quarternote,tempo)},ReadTrack:function(file){var result=new(System.Collections.Generic.List$1(MidiSheetMusic.MidiEvent).$ctor2)(20),starttime=0,id=file.ReadAscii(4),startoffset,deltatime,peekevent,e,mevent;if(!Bridge.referenceEquals(id,"MTrk"))throw new MidiSheetMusic.MidiFileException("Bad MTrk header",file.GetOffset()-4|0);for(var tracklen=file.ReadInt(),trackend=tracklen+file.GetOffset()|0,eventflag=0;file.GetOffset()<trackend;){try{startoffset=file.GetOffset();deltatime=file.ReadVarlen();starttime=starttime+deltatime|0;peekevent=file.Peek()}catch($e1){if($e1=System.Exception.create($e1),Bridge.is($e1,MidiSheetMusic.MidiFileException))return e=$e1,result;throw $e1;}if(mevent=new MidiSheetMusic.MidiEvent,result.add(mevent),mevent.DeltaTime=deltatime,mevent.StartTime=starttime,peekevent>=MidiSheetMusic.MidiFile.EventNoteOff&&(mevent.HasEventflag=!0,eventflag=file.ReadByte()),eventflag>=MidiSheetMusic.MidiFile.EventNoteOn&&eventflag<160)mevent.EventFlag=MidiSheetMusic.MidiFile.EventNoteOn,mevent.Channel=(eventflag-MidiSheetMusic.MidiFile.EventNoteOn|0)&255,mevent.Notenumber=file.ReadByte(),mevent.Velocity=file.ReadByte();else if(eventflag>=MidiSheetMusic.MidiFile.EventNoteOff&&eventflag<144)mevent.EventFlag=MidiSheetMusic.MidiFile.EventNoteOff,mevent.Channel=(eventflag-MidiSheetMusic.MidiFile.EventNoteOff|0)&255,mevent.Notenumber=file.ReadByte(),mevent.Velocity=file.ReadByte();else if(eventflag>=MidiSheetMusic.MidiFile.EventKeyPressure&&eventflag<176)mevent.EventFlag=MidiSheetMusic.MidiFile.EventKeyPressure,mevent.Channel=(eventflag-MidiSheetMusic.MidiFile.EventKeyPressure|0)&255,mevent.Notenumber=file.ReadByte(),mevent.KeyPressure=file.ReadByte();else if(eventflag>=MidiSheetMusic.MidiFile.EventControlChange&&eventflag<192)mevent.EventFlag=MidiSheetMusic.MidiFile.EventControlChange,mevent.Channel=(eventflag-MidiSheetMusic.MidiFile.EventControlChange|0)&255,mevent.ControlNum=file.ReadByte(),mevent.ControlValue=file.ReadByte();else if(eventflag>=MidiSheetMusic.MidiFile.EventProgramChange&&eventflag<208)mevent.EventFlag=MidiSheetMusic.MidiFile.EventProgramChange,mevent.Channel=(eventflag-MidiSheetMusic.MidiFile.EventProgramChange|0)&255,mevent.Instrument=file.ReadByte();else if(eventflag>=MidiSheetMusic.MidiFile.EventChannelPressure&&eventflag<224)mevent.EventFlag=MidiSheetMusic.MidiFile.EventChannelPressure,mevent.Channel=(eventflag-MidiSheetMusic.MidiFile.EventChannelPressure|0)&255,mevent.ChanPressure=file.ReadByte();else if(eventflag>=MidiSheetMusic.MidiFile.EventPitchBend&&eventflag<240)mevent.EventFlag=MidiSheetMusic.MidiFile.EventPitchBend,mevent.Channel=(eventflag-MidiSheetMusic.MidiFile.EventPitchBend|0)&255,mevent.PitchBend=file.ReadShort();else if(eventflag===MidiSheetMusic.MidiFile.SysexEvent1)mevent.EventFlag=MidiSheetMusic.MidiFile.SysexEvent1,mevent.Metalength=file.ReadVarlen(),mevent.Value=file.ReadBytes(mevent.Metalength);else if(eventflag===MidiSheetMusic.MidiFile.SysexEvent2)mevent.EventFlag=MidiSheetMusic.MidiFile.SysexEvent2,mevent.Metalength=file.ReadVarlen(),mevent.Value=file.ReadBytes(mevent.Metalength);else if(eventflag===MidiSheetMusic.MidiFile.MetaEvent)if(mevent.EventFlag=MidiSheetMusic.MidiFile.MetaEvent,mevent.Metaevent=file.ReadByte(),mevent.Metalength=file.ReadVarlen(),mevent.Value=file.ReadBytes(mevent.Metalength),mevent.Metaevent===MidiSheetMusic.MidiFile.MetaEventTimeSignature)mevent.Metalength<2?(mevent.Numerator=0,mevent.Denominator=4):mevent.Metalength>=2&&mevent.Metalength<4?(mevent.Numerator=mevent.Value[System.Array.index(0,mevent.Value)],mevent.Denominator=Bridge.Int.clipu8(Math.pow(2,mevent.Value[System.Array.index(1,mevent.Value)]))):(mevent.Numerator=mevent.Value[System.Array.index(0,mevent.Value)],mevent.Denominator=Bridge.Int.clipu8(Math.pow(2,mevent.Value[System.Array.index(1,mevent.Value)])));else if(mevent.Metaevent===MidiSheetMusic.MidiFile.MetaEventTempo){if(mevent.Metalength!==3)throw new MidiSheetMusic.MidiFileException("Meta Event Tempo len == "+mevent.Metalength+" != 3",file.GetOffset());mevent.Tempo=mevent.Value[System.Array.index(0,mevent.Value)]<<16|mevent.Value[System.Array.index(1,mevent.Value)]<<8|mevent.Value[System.Array.index(2,mevent.Value)]}else mevent.Metaevent===MidiSheetMusic.MidiFile.MetaEventEndOfTrack;else throw new MidiSheetMusic.MidiFileException("Unknown event "+mevent.EventFlag,file.GetOffset()-1|0);}return result},ChangeSound:function(destfile,options){return this.Write$1(destfile,options)},Write$1:function(destfile,options){var stream,result,e;try{return stream=new MidiSheetMusic.FileStream(destfile,MidiSheetMusic.FileMode.Create),result=this.Write(stream,options),stream.Close(),result}catch($e1){if($e1=System.Exception.create($e1),Bridge.is($e1,MidiSheetMusic.IOException))return e=$e1,!1;throw $e1;}},Write:function(stream,options){var newevents=this.events;return options!=null&&(newevents=this.ApplyOptionsToEvents(options)),MidiSheetMusic.MidiFile.WriteEvents(stream,newevents,this.trackmode,this.quarternote)},ApplyOptionsToEvents:function(options){var $t,i,tracknum,track,realtrack,newevents,tracknum1,mevent,tracknum2,mevent1,num,count,tracknum3,result,tracknum4;if(this.trackPerChannel)return this.ApplyOptionsPerChannel(options);var num_tracks=this.events.length,instruments=System.Array.init(num_tracks,0,System.Int32),keeptracks=System.Array.init(num_tracks,!1,System.Boolean);for(i=0;i<num_tracks;i=i+1|0)instruments[System.Array.index(i,instruments)]=0,keeptracks[System.Array.index(i,keeptracks)]=!0;for(tracknum=0;tracknum<this.tracks.Count;tracknum=tracknum+1|0)track=this.tracks.getItem(tracknum),realtrack=track.Number,instruments[System.Array.index(realtrack,instruments)]=options.instruments[System.Array.index(tracknum,options.instruments)],options.mute[System.Array.index(tracknum,options.mute)]===!0&&(keeptracks[System.Array.index(realtrack,keeptracks)]=!1);for(newevents=MidiSheetMusic.MidiFile.CloneMidiEvents(this.events),tracknum1=0;tracknum1<newevents.length;tracknum1=tracknum1+1|0)mevent=MidiSheetMusic.MidiFile.CreateTempoEvent(options.tempo),newevents[System.Array.index(tracknum1,newevents)].insert(0,mevent);for(tracknum2=0;tracknum2<newevents.length;tracknum2=tracknum2+1|0){$t=Bridge.getEnumerator(newevents[System.Array.index(tracknum2,newevents)]);try{while($t.moveNext())mevent1=$t.Current,num=mevent1.Notenumber+options.transpose|0,num<0&&(num=0),num>127&&(num=127),mevent1.Notenumber=num&255,options.useDefaultInstruments||(mevent1.Instrument=instruments[System.Array.index(tracknum2,instruments)]&255),mevent1.Tempo=options.tempo}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}}for(options.pauseTime!==0&&(newevents=MidiSheetMusic.MidiFile.StartAtPauseTime(newevents,options.pauseTime)),count=0,tracknum3=0;tracknum3<keeptracks.length;tracknum3=tracknum3+1|0)keeptracks[System.Array.index(tracknum3,keeptracks)]&&(count=count+1|0);for(result=System.Array.init(count,null,System.Collections.Generic.List$1(MidiSheetMusic.MidiEvent)),i=0,tracknum4=0;tracknum4<keeptracks.length;tracknum4=tracknum4+1|0)keeptracks[System.Array.index(tracknum4,keeptracks)]&&(result[System.Array.index(i,result)]=newevents[System.Array.index(tracknum4,newevents)],i=i+1|0);return result},ApplyOptionsPerChannel:function(options){for(var tracknum,track,channel,newevents,tracknum1,mevent,tracknum2,mevent1,num,$t,instruments=System.Array.init(16,0,System.Int32),keepchannel=System.Array.init(16,!1,System.Boolean),i=0;i<16;i=i+1|0)instruments[System.Array.index(i,instruments)]=0,keepchannel[System.Array.index(i,keepchannel)]=!0;for(tracknum=0;tracknum<this.tracks.Count;tracknum=tracknum+1|0)track=this.tracks.getItem(tracknum),channel=track.Notes.getItem(0).Channel,instruments[System.Array.index(channel,instruments)]=options.instruments[System.Array.index(tracknum,options.instruments)],options.mute[System.Array.index(tracknum,options.mute)]===!0&&(keepchannel[System.Array.index(channel,keepchannel)]=!1);for(newevents=MidiSheetMusic.MidiFile.CloneMidiEvents(this.events),tracknum1=0;tracknum1<newevents.length;tracknum1=tracknum1+1|0)mevent=MidiSheetMusic.MidiFile.CreateTempoEvent(options.tempo),newevents[System.Array.index(tracknum1,newevents)].insert(0,mevent);for(tracknum2=0;tracknum2<newevents.length;tracknum2=tracknum2+1|0){$t=Bridge.getEnumerator(newevents[System.Array.index(tracknum2,newevents)]);try{while($t.moveNext())mevent1=$t.Current,num=mevent1.Notenumber+options.transpose|0,num<0&&(num=0),num>127&&(num=127),mevent1.Notenumber=num&255,keepchannel[System.Array.index(mevent1.Channel,keepchannel)]||(mevent1.Velocity=0),options.useDefaultInstruments||(mevent1.Instrument=instruments[System.Array.index(mevent1.Channel,instruments)]&255),mevent1.Tempo=options.tempo}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}}return options.pauseTime!==0&&(newevents=MidiSheetMusic.MidiFile.StartAtPauseTime(newevents,options.pauseTime)),newevents},ChangeMidiNotes:function(options){for(var time,newtracks=new(System.Collections.Generic.List$1(MidiSheetMusic.MidiTrack).ctor),track=0;track<this.tracks.Count;track=track+1|0)options.tracks[System.Array.index(track,options.tracks)]&&newtracks.add(this.tracks.getItem(track).Clone());return time=this.timesig,options.time!=null&&(time=options.time),MidiSheetMusic.MidiFile.RoundStartTimes(newtracks,options.combineInterval,this.timesig),MidiSheetMusic.MidiFile.RoundDurations(newtracks,time.Quarter),options.twoStaffs&&(newtracks=MidiSheetMusic.MidiFile.CombineToTwoTracks(newtracks,this.timesig.Measure)),options.shifttime!==0&&MidiSheetMusic.MidiFile.ShiftTime(newtracks,options.shifttime),options.transpose!==0&&MidiSheetMusic.MidiFile.Transpose(newtracks,options.transpose),newtracks},GuessMeasureLength:function(){var $t,$t1,$t2,result=new(System.Collections.Generic.List$1(System.Int32).ctor),pulses_per_second=Bridge.Int.clip32(1e6/this.timesig.Tempo*this.timesig.Quarter),minmeasure=Bridge.Int.div(pulses_per_second,2)|0,maxmeasure=Bridge.Int.mul(pulses_per_second,4),firstnote=Bridge.Int.mul(this.timesig.Measure,5),track,interval,track1,prevtime,note,time_from_firstnote;$t=Bridge.getEnumerator(this.tracks);try{while($t.moveNext())track=$t.Current,firstnote>track.Notes.getItem(0).StartTime&&(firstnote=track.Notes.getItem(0).StartTime)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}interval=Bridge.Int.div(Bridge.Int.mul(this.timesig.Quarter,6e4),this.timesig.Tempo)|0;$t1=Bridge.getEnumerator(this.tracks);try{while($t1.moveNext()){track1=$t1.Current;prevtime=0;$t2=Bridge.getEnumerator(track1.Notes);try{while($t2.moveNext())if((note=$t2.Current,!((note.StartTime-prevtime|0)<=interval))&&(prevtime=note.StartTime,time_from_firstnote=note.StartTime-firstnote|0,time_from_firstnote=Bridge.Int.mul(Bridge.Int.div(time_from_firstnote,4)|0,4),!(time_from_firstnote<minmeasure))){if(time_from_firstnote>maxmeasure)break;result.contains(time_from_firstnote)||result.add(time_from_firstnote)}}finally{Bridge.is($t2,System.IDisposable)&&$t2.System$IDisposable$dispose()}}}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$dispose()}return result.sort(),result},EndTime:function(){var $t,lastStart=0,track,last;$t=Bridge.getEnumerator(this.tracks);try{while($t.moveNext())(track=$t.Current,track.Notes.Count!==0)&&(last=track.Notes.getItem(track.Notes.Count-1|0).StartTime,lastStart=Math.max(last,lastStart))}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return lastStart},HasLyrics:function(){var $t,track;$t=Bridge.getEnumerator(this.tracks);try{while($t.moveNext())if(track=$t.Current,track.Lyrics!=null)return!0}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return!1},toString:function(){var $t,result="Midi File tracks="+this.tracks.Count+" quarter="+this.quarternote+"\n",track;result=(result||"")+((this.Time.toString()||"")+"\n"||"");$t=Bridge.getEnumerator(this.tracks);try{while($t.moveNext())track=$t.Current,result=(result||"")+(track.toString()||"")}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return result}}});Bridge.define("MidiSheetMusic.MidiFileException",{inherits:[System.Exception],ctors:{ctor:function(s,offset){this.$initialize();System.Exception.ctor.call(this,(s||"")+" at offset "+offset)}}});Bridge.define("MidiSheetMusic.MidiFileReader",{fields:{data:null,parse_offset:0},ctors:{ctor:function(bytes){this.$initialize();this.data=bytes;this.parse_offset=0}},methods:{checkRead:function(amount){if((this.parse_offset+amount|0)>this.data.length)throw new MidiSheetMusic.MidiFileException("File is truncated",this.parse_offset);},Peek:function(){return this.checkRead(1),this.data[System.Array.index(this.parse_offset,this.data)]},ReadByte:function(){this.checkRead(1);var x=this.data[System.Array.index(this.parse_offset,this.data)];return this.parse_offset=this.parse_offset+1|0,x},ReadBytes:function(amount){var result,i;for(this.checkRead(amount),result=System.Array.init(amount,0,System.Byte),i=0;i<amount;i=i+1|0)result[System.Array.index(i,result)]=this.data[System.Array.index(i+this.parse_offset|0,this.data)];return this.parse_offset=this.parse_offset+amount|0,result},ReadShort:function(){this.checkRead(2);var x=(this.data[System.Array.index(this.parse_offset,this.data)]<<8|this.data[System.Array.index(this.parse_offset+1|0,this.data)])&65535;return this.parse_offset=this.parse_offset+2|0,x},ReadInt:function(){this.checkRead(4);var x=this.data[System.Array.index(this.parse_offset,this.data)]<<24|this.data[System.Array.index(this.parse_offset+1|0,this.data)]<<16|this.data[System.Array.index(this.parse_offset+2|0,this.data)]<<8|this.data[System.Array.index(this.parse_offset+3|0,this.data)];return this.parse_offset=this.parse_offset+4|0,x},ReadAscii:function(len){this.checkRead(len);var s=System.Text.Encoding.ASCII.GetString$1(this.data,this.parse_offset,len);return this.parse_offset=this.parse_offset+len|0,s},ReadVarlen:function(){var result=0,b,i;for(b=this.ReadByte(),result=(b&127)>>>0,i=0;i<3;i=i+1|0)if((b&128)!=0)b=this.ReadByte(),result=System.Int64.clipu32(System.Int64(result<<7>>>0).add(System.Int64(b&127)));else break;return result|0},Skip:function(amount){this.checkRead(amount);this.parse_offset=this.parse_offset+amount|0},GetOffset:function(){return this.parse_offset},GetData:function(){return this.data}}});Bridge.define("MidiSheetMusic.MidiNote",{inherits:function(){return[System.Collections.Generic.IComparer$1(MidiSheetMusic.MidiNote)]},fields:{starttime:0,channel:0,notenumber:0,duration:0,velocity:0},props:{StartTime:{get:function(){return this.starttime},set:function(value){this.starttime=value}},EndTime:{get:function(){return this.starttime+this.duration|0}},Channel:{get:function(){return this.channel},set:function(value){this.channel=value}},Number:{get:function(){return this.notenumber},set:function(value){this.notenumber=value}},Duration:{get:function(){return this.duration},set:function(value){this.duration=value}},Velocity:{get:function(){return this.velocity},set:function(value){this.velocity=value}}},alias:["compare",["System$Collections$Generic$IComparer$1$MidiSheetMusic$MidiNote$compare","System$Collections$Generic$IComparer$1$compare"]],ctors:{ctor:function(starttime,channel,notenumber,duration,velocity){this.$initialize();this.starttime=starttime;this.channel=channel;this.notenumber=notenumber;this.duration=duration;this.velocity=velocity}},methods:{NoteOff:function(endtime){this.duration=endtime-this.starttime|0},compare:function(x,y){return x.StartTime===y.StartTime?x.Number-y.Number|0:x.StartTime-y.StartTime|0},Clone:function(){return new MidiSheetMusic.MidiNote(this.starttime,this.channel,this.notenumber,this.duration,this.velocity)},toString:function(){var scale=System.Array.init(["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],System.String);return System.String.format("MidiNote channel={0} number={1} {2} start={3} duration={4}",Bridge.box(this.channel,System.Int32),Bridge.box(this.notenumber,System.Int32),scale[System.Array.index((this.notenumber+3|0)%12,scale)],Bridge.box(this.starttime,System.Int32),Bridge.box(this.duration,System.Int32))}}});Bridge.define("MidiSheetMusic.MidiOptions",{statics:{fields:{NoteNameNone:0,NoteNameLetter:0,NoteNameFixedDoReMi:0,NoteNameMovableDoReMi:0,NoteNameFixedNumber:0,NoteNameMovableNumber:0},ctors:{init:function(){this.NoteNameNone=0;this.NoteNameLetter=1;this.NoteNameFixedDoReMi=2;this.NoteNameMovableDoReMi=3;this.NoteNameFixedNumber=4;this.NoteNameMovableNumber=5}},methods:{Join$1:function(values){for(var result=new System.Text.StringBuilder,i=0;i<values.length;i=i+1|0)i>0&&result.append(","),result.append(System.Boolean.toString(values[System.Array.index(i,values)]));return result.toString()},Join$2:function(values){for(var result=new System.Text.StringBuilder,i=0;i<values.length;i=i+1|0)i>0&&result.append(","),result.append(values[System.Array.index(i,values)].toString());return result.toString()},Join:function(values){for(var result=new System.Text.StringBuilder,i=0;i<values.length;i=i+1|0)i>0&&result.append(","),result.append(MidiSheetMusic.MidiOptions.ColorToString(values[System.Array.index(i,values)]));return result.toString()},ColorToString:function(c){return""+c.R+" "+c.G+" "+c.B}}},fields:{filename:null,title:null,tracks:null,scrollVert:!1,largeNoteSize:!1,twoStaffs:!1,showNoteLetters:0,showLyrics:!1,showMeasures:!1,shifttime:0,transpose:0,key:0,time:null,combineInterval:0,colors:null,shadeColor:null,shade2Color:null,mute:null,tempo:0,pauseTime:0,instruments:null,useDefaultInstruments:!1,playMeasuresInLoop:!1,playMeasuresInLoopStart:0,playMeasuresInLoopEnd:0},ctors:{ctor:function(){this.$initialize()},$ctor1:function(midifile){var numtracks,i;for(this.$initialize(),this.filename=midifile.FileName,this.title=MidiSheetMusic.Path.GetFileName(midifile.FileName),numtracks=midifile.Tracks.Count,this.tracks=System.Array.init(numtracks,!1,System.Boolean),this.mute=System.Array.init(numtracks,!1,System.Boolean),this.instruments=System.Array.init(numtracks,0,System.Int32),i=0;i<this.tracks.length;i=i+1|0)this.tracks[System.Array.index(i,this.tracks)]=!0,this.mute[System.Array.index(i,this.mute)]=!1,this.instruments[System.Array.index(i,this.instruments)]=midifile.Tracks.getItem(i).Instrument,Bridge.referenceEquals(midifile.Tracks.getItem(i).InstrumentName,"Percussion")&&(this.tracks[System.Array.index(i,this.tracks)]=!1,this.mute[System.Array.index(i,this.mute)]=!0);this.useDefaultInstruments=!0;this.scrollVert=!0;this.largeNoteSize=!1;this.twoStaffs=this.tracks.length===1?!0:!1;this.showNoteLetters=MidiSheetMusic.MidiOptions.NoteNameNone;this.showLyrics=!0;this.showMeasures=!1;this.shifttime=0;this.transpose=0;this.key=-1;this.time=midifile.Time;this.colors=null;this.shadeColor=MidiSheetMusic.Color.FromArgb$1(100,53,123,255);this.shade2Color=MidiSheetMusic.Color.FromArgb(80,100,250);this.combineInterval=40;this.tempo=midifile.Time.Tempo;this.pauseTime=0;this.playMeasuresInLoop=!1;this.playMeasuresInLoopStart=0;this.playMeasuresInLoopEnd=Bridge.Int.div(midifile.EndTime(),midifile.Time.Measure)|0}},methods:{Merge:function(saved){var i,i1,i2;if(saved.tracks!=null&&saved.tracks.length===this.tracks.length)for(i=0;i<this.tracks.length;i=i+1|0)this.tracks[System.Array.index(i,this.tracks)]=saved.tracks[System.Array.index(i,saved.tracks)];if(saved.mute!=null&&saved.mute.length===this.mute.length)for(i1=0;i1<this.mute.length;i1=i1+1|0)this.mute[System.Array.index(i1,this.mute)]=saved.mute[System.Array.index(i1,saved.mute)];if(saved.instruments!=null&&saved.instruments.length===this.instruments.length)for(i2=0;i2<this.instruments.length;i2=i2+1|0)this.instruments[System.Array.index(i2,this.instruments)]=saved.instruments[System.Array.index(i2,saved.instruments)];saved.time!=null&&(this.time=new MidiSheetMusic.TimeSignature(saved.time.Numerator,saved.time.Denominator,saved.time.Quarter,saved.time.Tempo));this.useDefaultInstruments=saved.useDefaultInstruments;this.scrollVert=saved.scrollVert;this.largeNoteSize=saved.largeNoteSize;this.showLyrics=saved.showLyrics;this.twoStaffs=saved.twoStaffs;this.showNoteLetters=saved.showNoteLetters;this.transpose=saved.transpose;this.key=saved.key;this.combineInterval=saved.combineInterval;Bridge.referenceEquals(saved.shadeColor,MidiSheetMusic.Color.White)||(this.shadeColor=saved.shadeColor);Bridge.referenceEquals(saved.shade2Color,MidiSheetMusic.Color.White)||(this.shade2Color=saved.shade2Color);saved.colors!=null&&(this.colors=saved.colors);this.showMeasures=saved.showMeasures;this.playMeasuresInLoop=saved.playMeasuresInLoop;this.playMeasuresInLoopStart=saved.playMeasuresInLoopStart;this.playMeasuresInLoopEnd=saved.playMeasuresInLoopEnd}}});Bridge.define("MidiSheetMusic.MidiTrack",{fields:{tracknum:0,notes:null,instrument:0,lyrics:null},props:{Number:{get:function(){return this.tracknum}},Notes:{get:function(){return this.notes}},Instrument:{get:function(){return this.instrument},set:function(value){this.instrument=value}},InstrumentName:{get:function(){return this.instrument>=0&&this.instrument<=128?MidiSheetMusic.MidiFile.Instruments[System.Array.index(this.instrument,MidiSheetMusic.MidiFile.Instruments)]:""}},Lyrics:{get:function(){return this.lyrics},set:function(value){this.lyrics=value}}},ctors:{$ctor1:function(tracknum){this.$initialize();this.tracknum=tracknum;this.notes=new(System.Collections.Generic.List$1(MidiSheetMusic.MidiNote).$ctor2)(20);this.instrument=0},ctor:function(events,tracknum){var $t,mevent,note,lyriccount;this.$initialize();this.tracknum=tracknum;this.notes=new(System.Collections.Generic.List$1(MidiSheetMusic.MidiNote).$ctor2)(events.Count);this.instrument=0;$t=Bridge.getEnumerator(events);try{while($t.moveNext())mevent=$t.Current,mevent.EventFlag===MidiSheetMusic.MidiFile.EventNoteOn&&mevent.Velocity>0?(note=new MidiSheetMusic.MidiNote(mevent.StartTime,mevent.Channel,mevent.Notenumber,0,mevent.Velocity),this.AddNote(note)):mevent.EventFlag===MidiSheetMusic.MidiFile.EventNoteOn&&mevent.Velocity===0?this.NoteOff(mevent.Channel,mevent.Notenumber,mevent.StartTime):mevent.EventFlag===MidiSheetMusic.MidiFile.EventNoteOff?this.NoteOff(mevent.Channel,mevent.Notenumber,mevent.StartTime):mevent.EventFlag===MidiSheetMusic.MidiFile.EventProgramChange?this.instrument=mevent.Instrument:mevent.Metaevent===MidiSheetMusic.MidiFile.MetaEventLyric&&this.AddLyric(mevent)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}this.notes.Count>0&&this.notes.getItem(0).Channel===9&&(this.instrument=128);lyriccount=0;this.lyrics!=null&&(lyriccount=this.lyrics.Count)}},methods:{AddNote:function(m){this.notes.add(m)},NoteOff:function(channel,notenumber,endtime){for(var note,i=this.notes.Count-1|0;i>=0;i=i-1|0)if(note=this.notes.getItem(i),note.Channel===channel&&note.Number===notenumber&&note.Duration===0){note.NoteOff(endtime);return}},AddLyric:function(mevent){this.lyrics==null&&(this.lyrics=new(System.Collections.Generic.List$1(MidiSheetMusic.MidiEvent).ctor));this.lyrics.add(mevent)},Clone:function(){var $t,$t1,track=new MidiSheetMusic.MidiTrack.$ctor1(this.Number),note,ev;track.instrument=this.instrument;$t=Bridge.getEnumerator(this.notes);try{while($t.moveNext())note=$t.Current,track.notes.add(note.Clone())}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}if(this.lyrics!=null){track.lyrics=new(System.Collections.Generic.List$1(MidiSheetMusic.MidiEvent).ctor);$t1=Bridge.getEnumerator(this.lyrics);try{while($t1.moveNext())ev=$t1.Current,track.lyrics.add(ev)}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$dispose()}}return track},toString:function(){var $t,result="Track number="+this.tracknum+" instrument="+this.instrument+"\n",n;$t=Bridge.getEnumerator(this.notes);try{while($t.moveNext())n=$t.Current,result=System.String.concat(result,n)+"\n"}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return(result||"")+"End Track\n"}}});Bridge.define("MidiSheetMusic.NoteData",{fields:{number:0,whitenote:null,duration:0,leftside:!1,accid:0}});Bridge.define("MidiSheetMusic.NoteDuration",{$kind:"enum",statics:{fields:{ThirtySecond:0,Sixteenth:1,Triplet:2,Eighth:3,DottedEighth:4,Quarter:5,DottedQuarter:6,Half:7,DottedHalf:8,Whole:9}}});Bridge.define("MidiSheetMusic.NoteScale",{statics:{fields:{A:0,Asharp:0,Bflat:0,B:0,C:0,Csharp:0,Dflat:0,D:0,Dsharp:0,Eflat:0,E:0,F:0,Fsharp:0,Gflat:0,G:0,Gsharp:0,Aflat:0},ctors:{init:function(){this.A=0;this.Asharp=1;this.Bflat=1;this.B=2;this.C=3;this.Csharp=4;this.Dflat=4;this.D=5;this.Dsharp=6;this.Eflat=6;this.E=7;this.F=8;this.Fsharp=9;this.Gflat=9;this.G=10;this.Gsharp=11;this.Aflat=11}},methods:{ToNumber:function(notescale,octave){return(9+notescale|0)+Bridge.Int.mul(octave,12)|0},FromNumber:function(number){return(number+3|0)%12},IsBlackKey:function(notescale){return notescale===MidiSheetMusic.NoteScale.Asharp||notescale===MidiSheetMusic.NoteScale.Csharp||notescale===MidiSheetMusic.NoteScale.Dsharp||notescale===MidiSheetMusic.NoteScale.Fsharp||notescale===MidiSheetMusic.NoteScale.Gsharp?!0:!1}}}});Bridge.define("MidiSheetMusic.PaintEventArgs",{fields:{ClipRectangle:null},methods:{Graphics:function(){return new MidiSheetMusic.Graphics("main")}}});Bridge.define("MidiSheetMusic.Panel",{fields:{autoScrollPosition:null,Width:0,Height:0},props:{AutoScrollPosition:{get:function(){return this.autoScrollPosition},set:function(value){this.autoScrollPosition=value}}},ctors:{init:function(){this.autoScrollPosition=new MidiSheetMusic.Point(0,0)}}});Bridge.define("MidiSheetMusic.Path",{statics:{methods:{GetFileName:function(){return null}}}});Bridge.define("MidiSheetMusic.Pen",{fields:{Color:null,Width:0,EndCap:0},ctors:{ctor:function(color,width){this.$initialize();this.Color=color;this.Width=width}}});Bridge.define("MidiSheetMusic.Point",{fields:{X:0,Y:0},ctors:{ctor:function(x,y){this.$initialize();this.X=x;this.Y=y}}});Bridge.define("MidiSheetMusic.Rectangle",{fields:{X:0,Y:0,Width:0,Height:0},ctors:{ctor:function(x,y,width,height){this.$initialize();this.X=x;this.Y=y;this.Width=width;this.Height=height}}});Bridge.define("MidiSheetMusic.SmoothingMode",{$kind:"enum",statics:{fields:{None:0,AntiAlias:1}}});Bridge.define("MidiSheetMusic.Staff",{statics:{methods:{InsideClipping:function(clip,xpos,s){return xpos<=((clip.X+clip.Width|0)+50|0)&&((xpos+s.Width|0)+50|0)>=clip.X}}},fields:{symbols:null,lyrics:null,ytop:0,clefsym:null,keys:null,showMeasures:!1,keysigWidth:0,width:0,height:0,tracknum:0,totaltracks:0,starttime:0,endtime:0,measureLength:0},props:{Width:{get:function(){return this.width}},Height:{get:function(){return this.height}},Track:{get:function(){return this.tracknum}},StartTime:{get:function(){return this.starttime}},EndTime:{get:function(){return this.endtime},set:function(value){this.endtime=value}}},ctors:{ctor:function(symbols,key,options,tracknum,totaltracks){this.$initialize();this.keysigWidth=MidiSheetMusic.SheetMusic.KeySignatureWidth(key);this.tracknum=tracknum;this.totaltracks=totaltracks;this.showMeasures=options.showMeasures&&tracknum===0;this.measureLength=options.time.Measure;var clef=this.FindClef(symbols);this.clefsym=new MidiSheetMusic.ClefSymbol(clef,0,!1);this.keys=key.GetSymbols(clef);this.symbols=symbols;this.CalculateWidth(options.scrollVert);this.CalculateHeight();this.CalculateStartEndTime();this.FullJustify()}},methods:{FindClef:function(list){var $t,m,c;$t=Bridge.getEnumerator(list);try{while($t.moveNext())if(m=$t.Current,Bridge.is(m,MidiSheetMusic.ChordSymbol))return c=Bridge.cast(m,MidiSheetMusic.ChordSymbol),c.Clef}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return MidiSheetMusic.Clef.Treble},CalculateHeight:function(){var $t,above=0,below=0,s;$t=Bridge.getEnumerator(this.symbols);try{while($t.moveNext())s=$t.Current,above=Math.max(above,s.AboveStaff),below=Math.max(below,s.BelowStaff)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}above=Math.max(above,this.clefsym.AboveStaff);below=Math.max(below,this.clefsym.BelowStaff);this.showMeasures&&(above=Math.max(above,Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,3)));this.ytop=above+MidiSheetMusic.SheetMusic.NoteHeight|0;this.height=(Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,5)+this.ytop|0)+below|0;this.lyrics!=null&&(this.height=this.height+12|0);this.tracknum===(this.totaltracks-1|0)&&(this.height=this.height+Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,3)|0)},CalculateWidth:function(scrollVert){var $t,s;if(scrollVert){this.width=MidiSheetMusic.SheetMusic.PageWidth;return}this.width=this.keysigWidth;$t=Bridge.getEnumerator(this.symbols);try{while($t.moveNext())s=$t.Current,this.width=this.width+s.Width|0}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}},CalculateStartEndTime:function(){var $t,m,c;if(this.starttime=this.endtime=0,this.symbols.Count!==0){this.starttime=this.symbols.getItem(0).StartTime;$t=Bridge.getEnumerator(this.symbols);try{while($t.moveNext())m=$t.Current,this.endtime<m.StartTime&&(this.endtime=m.StartTime),Bridge.is(m,MidiSheetMusic.ChordSymbol)&&(c=Bridge.cast(m,MidiSheetMusic.ChordSymbol),this.endtime<c.EndTime&&(this.endtime=c.EndTime))}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}}},FullJustify:function(){var start,extrawidth,start1;if(this.width===MidiSheetMusic.SheetMusic.PageWidth){for(var totalwidth=this.keysigWidth,totalsymbols=0,i=0;i<this.symbols.Count;)for(start=this.symbols.getItem(i).StartTime,totalsymbols=totalsymbols+1|0,totalwidth=totalwidth+this.symbols.getItem(i).Width|0,i=i+1|0;i<this.symbols.Count&&this.symbols.getItem(i).StartTime===start;)totalwidth=totalwidth+this.symbols.getItem(i).Width|0,i=i+1|0;for(extrawidth=Bridge.Int.div((MidiSheetMusic.SheetMusic.PageWidth-totalwidth|0)-1|0,totalsymbols)|0,extrawidth>Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,2)&&(extrawidth=Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,2)),i=0;i<this.symbols.Count;)for(start1=this.symbols.getItem(i).StartTime,this.symbols.getItem(i).Width=this.symbols.getItem(i).Width+extrawidth|0,i=i+1|0;i<this.symbols.Count&&this.symbols.getItem(i).StartTime===start1;)i=i+1|0}},AddLyrics:function(tracklyrics){var $t,xpos,symbolindex,lyric;if(tracklyrics!=null){this.lyrics=new(System.Collections.Generic.List$1(MidiSheetMusic.LyricSymbol).ctor);xpos=0;symbolindex=0;$t=Bridge.getEnumerator(tracklyrics);try{while($t.moveNext())if(lyric=$t.Current,!(lyric.StartTime<this.starttime)){if(lyric.StartTime>this.endtime)break;while(symbolindex<this.symbols.Count&&this.symbols.getItem(symbolindex).StartTime<lyric.StartTime)xpos=xpos+this.symbols.getItem(symbolindex).Width|0,symbolindex=symbolindex+1|0;lyric.X=xpos;symbolindex<this.symbols.Count&&Bridge.is(this.symbols.getItem(symbolindex),MidiSheetMusic.BarSymbol)&&(lyric.X=lyric.X+MidiSheetMusic.SheetMusic.NoteWidth|0);this.lyrics.add(lyric)}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}this.lyrics.Count===0&&(this.lyrics=null)}},DrawLyrics:function(g){var $t,xpos=this.keysigWidth,ypos=this.height-12|0,lyric;$t=Bridge.getEnumerator(this.lyrics);try{while($t.moveNext())lyric=$t.Current,g.DrawString(lyric.Text,MidiSheetMusic.SheetMusic.LetterFont,MidiSheetMusic.Brushes.Black,xpos+lyric.X|0,ypos)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}},DrawMeasureNumbers:function(g){var $t,xpos=this.keysigWidth,ypos=this.ytop-Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,3)|0,s,measure;$t=Bridge.getEnumerator(this.symbols);try{while($t.moveNext())s=$t.Current,Bridge.is(s,MidiSheetMusic.BarSymbol)&&(measure=1+(Bridge.Int.div(s.StartTime,this.measureLength)|0)|0,g.DrawString(""+measure,MidiSheetMusic.SheetMusic.LetterFont,MidiSheetMusic.Brushes.Black,xpos+(Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteWidth,2)|0)|0,ypos)),xpos=xpos+s.Width|0}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}},DrawHorizLines:function(g,pen){var line=1,y=this.ytop-MidiSheetMusic.SheetMusic.LineWidth|0;for(pen.Width=1,line=1;line<=5;line=line+1|0)g.DrawLine(pen,MidiSheetMusic.SheetMusic.LeftMargin,y,this.width-1|0,y),y=y+(MidiSheetMusic.SheetMusic.LineWidth+MidiSheetMusic.SheetMusic.LineSpace|0)|0;pen.Color=MidiSheetMusic.Color.Black},DrawEndLines:function(g,pen){pen.Width=1;var ystart,yend;ystart=this.tracknum===0?this.ytop-MidiSheetMusic.SheetMusic.LineWidth|0:0;yend=this.tracknum===(this.totaltracks-1|0)?this.ytop+Bridge.Int.mul(4,MidiSheetMusic.SheetMusic.NoteHeight)|0:this.height;g.DrawLine(pen,MidiSheetMusic.SheetMusic.LeftMargin,ystart,MidiSheetMusic.SheetMusic.LeftMargin,yend);g.DrawLine(pen,this.width-1|0,ystart,this.width-1|0,yend)},Draw:function(g,clip,pen,selectionStartPulse,selectionEndPulse,deselectedBrush){var $t,$t1,xpos,a,s;this.ShadeSelectionBackground(g,clip,selectionStartPulse,selectionEndPulse,deselectedBrush);xpos=9;g.TranslateTransform(xpos,0);this.clefsym.Draw(g,pen,this.ytop);g.TranslateTransform(-xpos|0,0);xpos=xpos+this.clefsym.Width|0;$t=Bridge.getEnumerator(this.keys);try{while($t.moveNext())a=$t.Current,g.TranslateTransform(xpos,0),a.Draw(g,pen,this.ytop),g.TranslateTransform(-xpos|0,0),xpos=xpos+a.Width|0}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}$t1=Bridge.getEnumerator(this.symbols);try{while($t1.moveNext())s=$t1.Current,MidiSheetMusic.Staff.InsideClipping(clip,xpos,s)&&(g.TranslateTransform(xpos,0),s.Draw(g,pen,this.ytop),g.TranslateTransform(-xpos|0,0)),xpos=xpos+s.Width|0}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$dispose()}this.DrawHorizLines(g,pen);this.DrawEndLines(g,pen);this.showMeasures&&this.DrawMeasureNumbers(g,pen);this.lyrics!=null&&this.DrawLyrics(g,pen)},ShadeSelectionBackground:function(g,clip,selectionStartPulse,selectionEndPulse,deselectedBrush){var $t,xpos,lastStateFill,s;if(selectionEndPulse!==0){xpos=this.keysigWidth;lastStateFill=!1;$t=Bridge.getEnumerator(this.symbols);try{while($t.moveNext())s=$t.Current,MidiSheetMusic.Staff.InsideClipping(clip,xpos,s)&&(s.StartTime<selectionStartPulse||s.StartTime>selectionEndPulse)?(g.TranslateTransform(xpos-2|0,-2),g.FillRectangle(deselectedBrush,0,0,s.Width+4|0,this.Height+4|0),g.TranslateTransform(-(xpos-2|0)|0,2),lastStateFill=!0):lastStateFill=!1,xpos=xpos+s.Width|0}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}lastStateFill&&(g.TranslateTransform(xpos-2|0,-2),g.FillRectangle(deselectedBrush,0,0,this.width-xpos|0,this.Height+4|0),g.TranslateTransform(-(xpos-2|0)|0,2))}},ShadeNotes:function(g,shadeBrush,pen,currentPulseTime,prevPulseTime,x_shade){var i,start,end;if((this.starttime>prevPulseTime||this.endtime<prevPulseTime)&&(this.starttime>currentPulseTime||this.endtime<currentPulseTime))return!1;var xpos=this.keysigWidth,curr=null,shadedNoteFound=!1;for(i=0;i<this.symbols.Count;i=i+1|0){if(curr=this.symbols.getItem(i),Bridge.is(curr,MidiSheetMusic.BarSymbol)){xpos=xpos+curr.Width|0;continue}if(start=curr.StartTime,end=0,end=(i+2|0)<this.symbols.Count&&Bridge.is(this.symbols.getItem(i+1|0),MidiSheetMusic.BarSymbol)?this.symbols.getItem(i+2|0).StartTime:(i+1|0)<this.symbols.Count?this.symbols.getItem(i+1|0).StartTime:this.endtime,start>prevPulseTime&&start>currentPulseTime)return x_shade.v===0&&(x_shade.v=xpos),shadedNoteFound;if(start<=currentPulseTime&&currentPulseTime<end&&start<=prevPulseTime&&prevPulseTime<end)return x_shade.v=xpos,shadedNoteFound;start<=prevPulseTime&&prevPulseTime<end&&(g.TranslateTransform(xpos-2|0,-2),g.ClearRectangle(0,0,curr.Width+4|0,this.Height+4|0),g.TranslateTransform(-(xpos-2|0)|0,2));start<=currentPulseTime&&currentPulseTime<end&&(x_shade.v=xpos,g.TranslateTransform(xpos,0),g.FillRectangle(shadeBrush,0,0,curr.Width,this.Height),g.TranslateTransform(-xpos|0,0),shadedNoteFound=!0);xpos=xpos+curr.Width|0}return shadedNoteFound},PulseTimeForPoint:function(point){var $t,xpos=this.keysigWidth,pulseTime=this.starttime,sym;$t=Bridge.getEnumerator(this.symbols);try{while($t.moveNext()){if(sym=$t.Current,pulseTime=sym.StartTime,point.X<=(xpos+sym.Width|0))return pulseTime;xpos=xpos+sym.Width|0}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return pulseTime},toString:function(){var $t,$t1,$t2,result="Staff clef="+(this.clefsym.toString()||"")+"\n",a,s,m;result=(result||"")+"  Keys:\n";$t=Bridge.getEnumerator(this.keys);try{while($t.moveNext())a=$t.Current,result=(result||"")+("    "+(a.toString()||"")+"\n"||"")}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}result=(result||"")+"  Symbols:\n";$t1=Bridge.getEnumerator(this.keys);try{while($t1.moveNext())s=Bridge.cast($t1.Current,MidiSheetMusic.MusicSymbol),result=(result||"")+("    "+(s.toString()||"")+"\n"||"")}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$dispose()}$t2=Bridge.getEnumerator(this.symbols);try{while($t2.moveNext())m=$t2.Current,result=(result||"")+("    "+(m.toString()||"")+"\n"||"")}finally{Bridge.is($t2,System.IDisposable)&&$t2.System$IDisposable$dispose()}return(result||"")+"End Staff\n"}}});Bridge.define("MidiSheetMusic.Stem",{statics:{fields:{Up:0,Down:0,LeftSide:0,RightSide:0},ctors:{init:function(){this.Up=1;this.Down=2;this.LeftSide=1;this.RightSide=2}}},fields:{duration:0,direction:0,top:null,bottom:null,end:null,notesoverlap:!1,side:0,pair:null,width_to_pair:0,receiver_in_pair:!1},props:{Direction:{get:function(){return this.direction},set:function(value){this.ChangeDirection(value)}},Duration:{get:function(){return this.duration}},Top:{get:function(){return this.top}},Bottom:{get:function(){return this.bottom}},End:{get:function(){return this.end},set:function(value){this.end=value}},Receiver:{get:function(){return this.receiver_in_pair},set:function(value){this.receiver_in_pair=value}},isBeam:{get:function(){return this.receiver_in_pair||this.pair!=null}}},ctors:{ctor:function(bottom,top,duration,direction,overlap){this.$initialize();this.top=top;this.bottom=bottom;this.duration=duration;this.direction=direction;this.notesoverlap=overlap;this.side=direction===MidiSheetMusic.Stem.Up||this.notesoverlap?MidiSheetMusic.Stem.RightSide:MidiSheetMusic.Stem.LeftSide;this.end=this.CalculateEnd();this.pair=null;this.width_to_pair=0;this.receiver_in_pair=!1}},methods:{CalculateEnd:function(){var w,w1;return this.direction===MidiSheetMusic.Stem.Up?(w=this.top,w=w.Add(6),this.duration===MidiSheetMusic.NoteDuration.Sixteenth?w=w.Add(2):this.duration===MidiSheetMusic.NoteDuration.ThirtySecond&&(w=w.Add(4)),w):this.direction===MidiSheetMusic.Stem.Down?(w1=this.bottom,w1=w1.Add(-6),this.duration===MidiSheetMusic.NoteDuration.Sixteenth?w1=w1.Add(-2):this.duration===MidiSheetMusic.NoteDuration.ThirtySecond&&(w1=w1.Add(-4)),w1):null},ChangeDirection:function(newdirection){this.direction=newdirection;this.side=this.direction===MidiSheetMusic.Stem.Up||this.notesoverlap?MidiSheetMusic.Stem.RightSide:MidiSheetMusic.Stem.LeftSide;this.end=this.CalculateEnd()},SetPair:function(pair,width_to_pair){this.pair=pair;this.width_to_pair=width_to_pair},Draw:function(g,pen,ytop,topstaff){this.duration!==MidiSheetMusic.NoteDuration.Whole&&((this.DrawVerticalLine(g,pen,ytop,topstaff),this.duration===MidiSheetMusic.NoteDuration.Quarter||this.duration===MidiSheetMusic.NoteDuration.DottedQuarter||this.duration===MidiSheetMusic.NoteDuration.Half||this.duration===MidiSheetMusic.NoteDuration.DottedHalf||this.receiver_in_pair)||(this.pair!=null?this.DrawHorizBarStem(g,pen,ytop,topstaff):this.DrawCurvyStem(g,pen,ytop,topstaff)))},DrawVerticalLine:function(g,pen,ytop,topstaff){var xstart,y1,ystem,y11,ystem1;xstart=this.side===MidiSheetMusic.Stem.LeftSide?(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)+1|0:(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)+MidiSheetMusic.SheetMusic.NoteWidth|0;this.direction===MidiSheetMusic.Stem.Up?(y1=(ytop+(Bridge.Int.div(Bridge.Int.mul(topstaff.Dist(this.bottom),MidiSheetMusic.SheetMusic.NoteHeight),2)|0)|0)+(Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteHeight,4)|0)|0,ystem=ytop+(Bridge.Int.div(Bridge.Int.mul(topstaff.Dist(this.end),MidiSheetMusic.SheetMusic.NoteHeight),2)|0)|0,g.DrawLine(pen,xstart,y1,xstart,ystem)):this.direction===MidiSheetMusic.Stem.Down&&(y11=(ytop+(Bridge.Int.div(Bridge.Int.mul(topstaff.Dist(this.top),MidiSheetMusic.SheetMusic.NoteHeight),2)|0)|0)+MidiSheetMusic.SheetMusic.NoteHeight|0,y11=this.side===MidiSheetMusic.Stem.LeftSide?y11-(Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteHeight,4)|0)|0:y11-(Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteHeight,2)|0)|0,ystem1=(ytop+(Bridge.Int.div(Bridge.Int.mul(topstaff.Dist(this.end),MidiSheetMusic.SheetMusic.NoteHeight),2)|0)|0)+MidiSheetMusic.SheetMusic.NoteHeight|0,g.DrawLine(pen,xstart,y11,xstart,ystem1))},DrawCurvyStem:function(g,pen,ytop,topstaff){var xstart,ystem,ystem1;pen.Width=2;xstart=0;xstart=this.side===MidiSheetMusic.Stem.LeftSide?(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)+1|0:(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)+MidiSheetMusic.SheetMusic.NoteWidth|0;this.direction===MidiSheetMusic.Stem.Up?(ystem=ytop+(Bridge.Int.div(Bridge.Int.mul(topstaff.Dist(this.end),MidiSheetMusic.SheetMusic.NoteHeight),2)|0)|0,(this.duration===MidiSheetMusic.NoteDuration.Eighth||this.duration===MidiSheetMusic.NoteDuration.DottedEighth||this.duration===MidiSheetMusic.NoteDuration.Triplet||this.duration===MidiSheetMusic.NoteDuration.Sixteenth||this.duration===MidiSheetMusic.NoteDuration.ThirtySecond)&&g.DrawBezier(pen,xstart,ystem,xstart,ystem+(Bridge.Int.div(Bridge.Int.mul(3,MidiSheetMusic.SheetMusic.LineSpace),2)|0)|0,xstart+Bridge.Int.mul(MidiSheetMusic.SheetMusic.LineSpace,2)|0,ystem+Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,2)|0,xstart+(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,2)|0)|0,ystem+Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,3)|0),ystem=ystem+MidiSheetMusic.SheetMusic.NoteHeight|0,(this.duration===MidiSheetMusic.NoteDuration.Sixteenth||this.duration===MidiSheetMusic.NoteDuration.ThirtySecond)&&g.DrawBezier(pen,xstart,ystem,xstart,ystem+(Bridge.Int.div(Bridge.Int.mul(3,MidiSheetMusic.SheetMusic.LineSpace),2)|0)|0,xstart+Bridge.Int.mul(MidiSheetMusic.SheetMusic.LineSpace,2)|0,ystem+Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,2)|0,xstart+(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,2)|0)|0,ystem+Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,3)|0),ystem=ystem+MidiSheetMusic.SheetMusic.NoteHeight|0,this.duration===MidiSheetMusic.NoteDuration.ThirtySecond&&g.DrawBezier(pen,xstart,ystem,xstart,ystem+(Bridge.Int.div(Bridge.Int.mul(3,MidiSheetMusic.SheetMusic.LineSpace),2)|0)|0,xstart+Bridge.Int.mul(MidiSheetMusic.SheetMusic.LineSpace,2)|0,ystem+Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,2)|0,xstart+(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,2)|0)|0,ystem+Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,3)|0)):this.direction===MidiSheetMusic.Stem.Down&&(ystem1=(ytop+(Bridge.Int.div(Bridge.Int.mul(topstaff.Dist(this.end),MidiSheetMusic.SheetMusic.NoteHeight),2)|0)|0)+MidiSheetMusic.SheetMusic.NoteHeight|0,(this.duration===MidiSheetMusic.NoteDuration.Eighth||this.duration===MidiSheetMusic.NoteDuration.DottedEighth||this.duration===MidiSheetMusic.NoteDuration.Triplet||this.duration===MidiSheetMusic.NoteDuration.Sixteenth||this.duration===MidiSheetMusic.NoteDuration.ThirtySecond)&&g.DrawBezier(pen,xstart,ystem1,xstart,ystem1-MidiSheetMusic.SheetMusic.LineSpace|0,xstart+Bridge.Int.mul(MidiSheetMusic.SheetMusic.LineSpace,2)|0,ystem1-Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,2)|0,xstart+MidiSheetMusic.SheetMusic.LineSpace|0,(ystem1-Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,2)|0)-(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,2)|0)|0),ystem1=ystem1-MidiSheetMusic.SheetMusic.NoteHeight|0,(this.duration===MidiSheetMusic.NoteDuration.Sixteenth||this.duration===MidiSheetMusic.NoteDuration.ThirtySecond)&&g.DrawBezier(pen,xstart,ystem1,xstart,ystem1-MidiSheetMusic.SheetMusic.LineSpace|0,xstart+Bridge.Int.mul(MidiSheetMusic.SheetMusic.LineSpace,2)|0,ystem1-Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,2)|0,xstart+MidiSheetMusic.SheetMusic.LineSpace|0,(ystem1-Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,2)|0)-(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,2)|0)|0),ystem1=ystem1-MidiSheetMusic.SheetMusic.NoteHeight|0,this.duration===MidiSheetMusic.NoteDuration.ThirtySecond&&g.DrawBezier(pen,xstart,ystem1,xstart,ystem1-MidiSheetMusic.SheetMusic.LineSpace|0,xstart+Bridge.Int.mul(MidiSheetMusic.SheetMusic.LineSpace,2)|0,ystem1-Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,2)|0,xstart+MidiSheetMusic.SheetMusic.LineSpace|0,(ystem1-Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,2)|0)-(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,2)|0)|0));pen.Width=1},DrawHorizBarStem:function(g,pen,ytop,topstaff){var xstart,xstart2;if(pen.Width=Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteHeight,2)|0,xstart=0,xstart2=0,this.side===MidiSheetMusic.Stem.LeftSide?xstart=(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)+1|0:this.side===MidiSheetMusic.Stem.RightSide&&(xstart=(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)+MidiSheetMusic.SheetMusic.NoteWidth|0),this.pair.side===MidiSheetMusic.Stem.LeftSide?xstart2=(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)+1|0:this.pair.side===MidiSheetMusic.Stem.RightSide&&(xstart2=(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)+MidiSheetMusic.SheetMusic.NoteWidth|0),this.direction===MidiSheetMusic.Stem.Up){var xend=this.width_to_pair+xstart2|0,ystart=ytop+(Bridge.Int.div(Bridge.Int.mul(topstaff.Dist(this.end),MidiSheetMusic.SheetMusic.NoteHeight),2)|0)|0,yend=ytop+(Bridge.Int.div(Bridge.Int.mul(topstaff.Dist(this.pair.end),MidiSheetMusic.SheetMusic.NoteHeight),2)|0)|0;if((this.duration===MidiSheetMusic.NoteDuration.Eighth||this.duration===MidiSheetMusic.NoteDuration.DottedEighth||this.duration===MidiSheetMusic.NoteDuration.Triplet||this.duration===MidiSheetMusic.NoteDuration.Sixteenth||this.duration===MidiSheetMusic.NoteDuration.ThirtySecond)&&g.DrawLine(pen,xstart,ystart,xend,yend),ystart=ystart+MidiSheetMusic.SheetMusic.NoteHeight|0,yend=yend+MidiSheetMusic.SheetMusic.NoteHeight|0,this.duration===MidiSheetMusic.NoteDuration.DottedEighth){var x=xend-MidiSheetMusic.SheetMusic.NoteHeight|0,slope=(yend-ystart|0)*1/(xend-xstart|0),y=Bridge.Int.clip32(slope*(x-xend|0)+yend);g.DrawLine(pen,x,y,xend,yend)}(this.duration===MidiSheetMusic.NoteDuration.Sixteenth||this.duration===MidiSheetMusic.NoteDuration.ThirtySecond)&&g.DrawLine(pen,xstart,ystart,xend,yend);ystart=ystart+MidiSheetMusic.SheetMusic.NoteHeight|0;yend=yend+MidiSheetMusic.SheetMusic.NoteHeight|0;this.duration===MidiSheetMusic.NoteDuration.ThirtySecond&&g.DrawLine(pen,xstart,ystart,xend,yend)}else{var xend1=this.width_to_pair+xstart2|0,ystart1=(ytop+(Bridge.Int.div(Bridge.Int.mul(topstaff.Dist(this.end),MidiSheetMusic.SheetMusic.NoteHeight),2)|0)|0)+MidiSheetMusic.SheetMusic.NoteHeight|0,yend1=(ytop+(Bridge.Int.div(Bridge.Int.mul(topstaff.Dist(this.pair.end),MidiSheetMusic.SheetMusic.NoteHeight),2)|0)|0)+MidiSheetMusic.SheetMusic.NoteHeight|0;if((this.duration===MidiSheetMusic.NoteDuration.Eighth||this.duration===MidiSheetMusic.NoteDuration.DottedEighth||this.duration===MidiSheetMusic.NoteDuration.Triplet||this.duration===MidiSheetMusic.NoteDuration.Sixteenth||this.duration===MidiSheetMusic.NoteDuration.ThirtySecond)&&g.DrawLine(pen,xstart,ystart1,xend1,yend1),ystart1=ystart1-MidiSheetMusic.SheetMusic.NoteHeight|0,yend1=yend1-MidiSheetMusic.SheetMusic.NoteHeight|0,this.duration===MidiSheetMusic.NoteDuration.DottedEighth){var x1=xend1-MidiSheetMusic.SheetMusic.NoteHeight|0,slope1=(yend1-ystart1|0)*1/(xend1-xstart|0),y1=Bridge.Int.clip32(slope1*(x1-xend1|0)+yend1);g.DrawLine(pen,x1,y1,xend1,yend1)}(this.duration===MidiSheetMusic.NoteDuration.Sixteenth||this.duration===MidiSheetMusic.NoteDuration.ThirtySecond)&&g.DrawLine(pen,xstart,ystart1,xend1,yend1);ystart1=ystart1-MidiSheetMusic.SheetMusic.NoteHeight|0;yend1=yend1-MidiSheetMusic.SheetMusic.NoteHeight|0;this.duration===MidiSheetMusic.NoteDuration.ThirtySecond&&g.DrawLine(pen,xstart,ystart1,xend1,yend1)}pen.Width=1},toString:function(){return System.String.format("Stem duration={0} direction={1} top={2} bottom={3} end={4} overlap={5} side={6} width_to_pair={7} receiver_in_pair={8}",Bridge.box(this.duration,MidiSheetMusic.NoteDuration,System.Enum.toStringFn(MidiSheetMusic.NoteDuration)),Bridge.box(this.direction,System.Int32),this.top.toString(),this.bottom.toString(),this.end.toString(),Bridge.box(this.notesoverlap,System.Boolean,System.Boolean.toString),Bridge.box(this.side,System.Int32),Bridge.box(this.width_to_pair,System.Int32),Bridge.box(this.receiver_in_pair,System.Boolean,System.Boolean.toString))}}});Bridge.define("MidiSheetMusic.StemDir",{$kind:"enum",statics:{fields:{Up:0,Down:1}}});Bridge.define("MidiSheetMusic.SymbolWidths",{statics:{methods:{GetTrackWidths:function(symbols){var $t,widths=new(System.Collections.Generic.Dictionary$2(System.Int32,System.Int32));$t=Bridge.getEnumerator(symbols);try{while($t.moveNext()){var m=$t.Current,start=m.StartTime,w=m.MinWidth;if(Bridge.is(m,MidiSheetMusic.BarSymbol))continue;else widths.containsKey(start)?widths.set(start,widths.get(start)+w|0):widths.set(start,w)}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return widths}}},fields:{widths:null,maxwidths:null,starttimes:null},props:{StartTimes:{get:function(){return this.starttimes}}},ctors:{ctor:function(tracks,tracklyrics){var $t,$t1,$t2,$t3,track,dict,time,lyrics;for(this.$initialize(),this.widths=System.Array.init(tracks.length,null,System.Collections.Generic.Dictionary$2(System.Int32,System.Int32)),track=0;track<tracks.length;track=track+1|0)this.widths[System.Array.index(track,this.widths)]=MidiSheetMusic.SymbolWidths.GetTrackWidths(tracks[System.Array.index(track,tracks)]);this.maxwidths=new(System.Collections.Generic.Dictionary$2(System.Int32,System.Int32));$t=Bridge.getEnumerator(this.widths);try{while($t.moveNext()){dict=$t.Current;$t1=Bridge.getEnumerator(dict.getKeys(),System.Int32);try{while($t1.moveNext())time=$t1.Current,(!this.maxwidths.containsKey(time)||this.maxwidths.get(time)<dict.get(time))&&this.maxwidths.set(time,dict.get(time))}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$dispose()}}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}if(tracklyrics!=null){$t2=Bridge.getEnumerator(tracklyrics);try{while($t2.moveNext())if(lyrics=$t2.Current,lyrics!=null){$t3=Bridge.getEnumerator(lyrics);try{while($t3.moveNext()){var lyric=$t3.Current,width=lyric.MinWidth,time1=lyric.StartTime;(!this.maxwidths.containsKey(time1)||this.maxwidths.get(time1)<width)&&this.maxwidths.set(time1,width)}}finally{Bridge.is($t3,System.IDisposable)&&$t3.System$IDisposable$dispose()}}}finally{Bridge.is($t2,System.IDisposable)&&$t2.System$IDisposable$dispose()}}this.starttimes=System.Array.init(System.Array.getCount(this.maxwidths.getKeys(),System.Int32),0,System.Int32);System.Array.copyTo(this.maxwidths.getKeys(),this.starttimes,0,System.Int32);System.Array.sort(this.starttimes)}},methods:{GetExtraWidth:function(track,start){return this.widths[System.Array.index(track,this.widths)].containsKey(start)?this.maxwidths.get(start)-this.widths[System.Array.index(track,this.widths)].get(start)|0:this.maxwidths.get(start)}}});Bridge.define("MidiSheetMusic.TimeSignature",{statics:{methods:{GetStemDuration:function(dur){return dur===MidiSheetMusic.NoteDuration.DottedHalf?MidiSheetMusic.NoteDuration.Half:dur===MidiSheetMusic.NoteDuration.DottedQuarter?MidiSheetMusic.NoteDuration.Quarter:dur===MidiSheetMusic.NoteDuration.DottedEighth?MidiSheetMusic.NoteDuration.Eighth:dur}}},fields:{numerator:0,denominator:0,quarternote:0,measure:0,tempo:0},props:{Numerator:{get:function(){return this.numerator}},Denominator:{get:function(){return this.denominator}},Quarter:{get:function(){return this.quarternote}},Measure:{get:function(){return this.measure}},Tempo:{get:function(){return this.tempo}}},ctors:{ctor:function(numerator,denominator,quarternote,tempo){if(this.$initialize(),numerator<=0||denominator<=0||quarternote<=0)throw new MidiSheetMusic.MidiFileException("Invalid time signature",0);numerator===5&&(numerator=4);this.numerator=numerator;this.denominator=denominator;this.quarternote=quarternote;this.tempo=tempo;var beat;beat=denominator<4?Bridge.Int.mul(quarternote,2):Bridge.Int.div(quarternote,Bridge.Int.div(denominator,4)|0)|0;this.measure=Bridge.Int.mul(numerator,beat)}},methods:{GetMeasure:function(time){return Bridge.Int.div(time,this.measure)|0},GetNoteDuration:function(duration){var whole=Bridge.Int.mul(this.quarternote,4);return duration>=(Bridge.Int.div(Bridge.Int.mul(28,whole),32)|0)?MidiSheetMusic.NoteDuration.Whole:duration>=(Bridge.Int.div(Bridge.Int.mul(20,whole),32)|0)?MidiSheetMusic.NoteDuration.DottedHalf:duration>=(Bridge.Int.div(Bridge.Int.mul(14,whole),32)|0)?MidiSheetMusic.NoteDuration.Half:duration>=(Bridge.Int.div(Bridge.Int.mul(10,whole),32)|0)?MidiSheetMusic.NoteDuration.DottedQuarter:duration>=(Bridge.Int.div(Bridge.Int.mul(7,whole),32)|0)?MidiSheetMusic.NoteDuration.Quarter:duration>=(Bridge.Int.div(Bridge.Int.mul(5,whole),32)|0)?MidiSheetMusic.NoteDuration.DottedEighth:duration>=(Bridge.Int.div(Bridge.Int.mul(6,whole),64)|0)?MidiSheetMusic.NoteDuration.Eighth:duration>=(Bridge.Int.div(Bridge.Int.mul(5,whole),64)|0)?MidiSheetMusic.NoteDuration.Triplet:duration>=(Bridge.Int.div(Bridge.Int.mul(3,whole),64)|0)?MidiSheetMusic.NoteDuration.Sixteenth:MidiSheetMusic.NoteDuration.ThirtySecond},DurationToTime:function(dur){var eighth=Bridge.Int.div(this.quarternote,2)|0,sixteenth=Bridge.Int.div(eighth,2)|0;switch(dur){case MidiSheetMusic.NoteDuration.Whole:return Bridge.Int.mul(this.quarternote,4);case MidiSheetMusic.NoteDuration.DottedHalf:return Bridge.Int.mul(this.quarternote,3);case MidiSheetMusic.NoteDuration.Half:return Bridge.Int.mul(this.quarternote,2);case MidiSheetMusic.NoteDuration.DottedQuarter:return Bridge.Int.mul(3,eighth);case MidiSheetMusic.NoteDuration.Quarter:return this.quarternote;case MidiSheetMusic.NoteDuration.DottedEighth:return Bridge.Int.mul(3,sixteenth);case MidiSheetMusic.NoteDuration.Eighth:return eighth;case MidiSheetMusic.NoteDuration.Triplet:return Bridge.Int.div(this.quarternote,3)|0;case MidiSheetMusic.NoteDuration.Sixteenth:return sixteenth;case MidiSheetMusic.NoteDuration.ThirtySecond:return Bridge.Int.div(sixteenth,2)|0;default:return 0}},toString:function(){return System.String.format("TimeSignature={0}/{1} quarter={2} tempo={3}",Bridge.box(this.numerator,System.Int32),Bridge.box(this.denominator,System.Int32),Bridge.box(this.quarternote,System.Int32),Bridge.box(this.tempo,System.Int32))}}});Bridge.define("MidiSheetMusic.WhiteNote",{inherits:function(){return[System.Collections.Generic.IComparer$1(MidiSheetMusic.WhiteNote)]},statics:{fields:{A:0,B:0,C:0,D:0,E:0,F:0,G:0,TopTreble:null,BottomTreble:null,TopBass:null,BottomBass:null,MiddleC:null},ctors:{init:function(){this.A=0;this.B=1;this.C=2;this.D=3;this.E=4;this.F=5;this.G=6;this.TopTreble=new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.E,5);this.BottomTreble=new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.F,4);this.TopBass=new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.G,3);this.BottomBass=new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.A,3);this.MiddleC=new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.C,4)}},methods:{Max:function(x,y){return x.Dist(y)>0?x:y},Min:function(x,y){return x.Dist(y)<0?x:y},Top:function(clef){return clef===MidiSheetMusic.Clef.Treble?MidiSheetMusic.WhiteNote.TopTreble:MidiSheetMusic.WhiteNote.TopBass},Bottom:function(clef){return clef===MidiSheetMusic.Clef.Treble?MidiSheetMusic.WhiteNote.BottomTreble:MidiSheetMusic.WhiteNote.BottomBass}}},fields:{letter:0,octave:0},props:{Letter:{get:function(){return this.letter}},Octave:{get:function(){return this.octave}}},alias:["compare",["System$Collections$Generic$IComparer$1$MidiSheetMusic$WhiteNote$compare","System$Collections$Generic$IComparer$1$compare"]],ctors:{ctor:function(letter,octave){if(this.$initialize(),!(letter>=0&&letter<=6))throw new System.ArgumentException("Letter "+letter+" is incorrect");this.letter=letter;this.octave=octave}},methods:{Dist:function(w){return Bridge.Int.mul(this.octave-w.octave|0,7)+(this.letter-w.letter|0)|0},Add:function(amount){var num=Bridge.Int.mul(this.octave,7)+this.letter|0;return num=num+amount|0,num<0&&(num=0),new MidiSheetMusic.WhiteNote(num%7,Bridge.Int.div(num,7)|0)},Number:function(){var offset=0;switch(this.letter){case MidiSheetMusic.WhiteNote.A:offset=MidiSheetMusic.NoteScale.A;break;case MidiSheetMusic.WhiteNote.B:offset=MidiSheetMusic.NoteScale.B;break;case MidiSheetMusic.WhiteNote.C:offset=MidiSheetMusic.NoteScale.C;break;case MidiSheetMusic.WhiteNote.D:offset=MidiSheetMusic.NoteScale.D;break;case MidiSheetMusic.WhiteNote.E:offset=MidiSheetMusic.NoteScale.E;break;case MidiSheetMusic.WhiteNote.F:offset=MidiSheetMusic.NoteScale.F;break;case MidiSheetMusic.WhiteNote.G:offset=MidiSheetMusic.NoteScale.G;break;default:offset=0}return MidiSheetMusic.NoteScale.ToNumber(offset,this.octave)},compare:function(x,y){return x.Dist(y)},toString:function(){var s=System.Array.init(["A","B","C","D","E","F","G"],System.String);return(s[System.Array.index(this.letter,s)]||"")+this.octave}}});Bridge.define("MidiSheetMusic.AccidSymbol",{inherits:[MidiSheetMusic.MusicSymbol],fields:{accid:0,whitenote:null,clef:0,width:0},props:{Note:{get:function(){return this.whitenote}},StartTime:{get:function(){return-1}},MinWidth:{get:function(){return Bridge.Int.div(Bridge.Int.mul(3,MidiSheetMusic.SheetMusic.NoteHeight),2)|0}},Width:{get:function(){return this.width},set:function(value){this.width=value}},AboveStaff:{get:function(){return this.GetAboveStaff()}},BelowStaff:{get:function(){return this.GetBelowStaff()}}},ctors:{ctor:function(accid,note,clef){this.$initialize();MidiSheetMusic.MusicSymbol.ctor.call(this);this.accid=accid;this.whitenote=note;this.clef=clef;this.width=this.MinWidth}},methods:{GetAboveStaff:function(){var dist=Bridge.Int.div(Bridge.Int.mul(MidiSheetMusic.WhiteNote.Top(this.clef).Dist(this.whitenote),MidiSheetMusic.SheetMusic.NoteHeight),2)|0;return this.accid===MidiSheetMusic.Accid.Sharp||this.accid===MidiSheetMusic.Accid.Natural?dist=dist-MidiSheetMusic.SheetMusic.NoteHeight|0:this.accid===MidiSheetMusic.Accid.Flat&&(dist=dist-(Bridge.Int.div(Bridge.Int.mul(3,MidiSheetMusic.SheetMusic.NoteHeight),2)|0)|0),dist<0?-dist|0:0},GetBelowStaff:function(){var dist=(Bridge.Int.div(Bridge.Int.mul(MidiSheetMusic.WhiteNote.Bottom(this.clef).Dist(this.whitenote),MidiSheetMusic.SheetMusic.NoteHeight),2)|0)+MidiSheetMusic.SheetMusic.NoteHeight|0;return(this.accid===MidiSheetMusic.Accid.Sharp||this.accid===MidiSheetMusic.Accid.Natural)&&(dist=dist+MidiSheetMusic.SheetMusic.NoteHeight|0),dist>0?dist:0},Draw:function(g,pen,ytop){g.TranslateTransform(this.Width-this.MinWidth|0,0);var ynote=ytop+(Bridge.Int.div(Bridge.Int.mul(MidiSheetMusic.WhiteNote.Top(this.clef).Dist(this.whitenote),MidiSheetMusic.SheetMusic.NoteHeight),2)|0)|0;this.accid===MidiSheetMusic.Accid.Sharp?this.DrawSharp(g,pen,ynote):this.accid===MidiSheetMusic.Accid.Flat?this.DrawFlat(g,pen,ynote):this.accid===MidiSheetMusic.Accid.Natural&&this.DrawNatural(g,pen,ynote);g.TranslateTransform(-(this.Width-this.MinWidth|0)|0,0)},DrawSharp:function(g,pen,ynote){var ystart=ynote-MidiSheetMusic.SheetMusic.NoteHeight|0,yend=ynote+Bridge.Int.mul(2,MidiSheetMusic.SheetMusic.NoteHeight)|0,x=Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteHeight,2)|0,xstart,xend;pen.Width=1;g.DrawLine(pen,x,ystart+2|0,x,yend);x=x+(Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteHeight,2)|0)|0;g.DrawLine(pen,x,ystart,x,yend-2|0);xstart=(Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteHeight,2)|0)-(Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteHeight,4)|0)|0;xend=MidiSheetMusic.SheetMusic.NoteHeight+(Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteHeight,4)|0)|0;ystart=ynote+MidiSheetMusic.SheetMusic.LineWidth|0;yend=(ystart-MidiSheetMusic.SheetMusic.LineWidth|0)-(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)|0;pen.Width=Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,2)|0;g.DrawLine(pen,xstart,ystart,xend,yend);ystart=ystart+MidiSheetMusic.SheetMusic.LineSpace|0;yend=yend+MidiSheetMusic.SheetMusic.LineSpace|0;g.DrawLine(pen,xstart,ystart,xend,yend);pen.Width=1},DrawFlat:function(g,pen,ynote){var x=Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0;pen.Width=1;g.DrawLine(pen,x,(ynote-MidiSheetMusic.SheetMusic.NoteHeight|0)-(Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteHeight,2)|0)|0,x,ynote+MidiSheetMusic.SheetMusic.NoteHeight|0);g.DrawBezier(pen,x,ynote+(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)|0,x+(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,2)|0)|0,ynote-(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,2)|0)|0,x+MidiSheetMusic.SheetMusic.LineSpace|0,ynote+(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,3)|0)|0,x,((ynote+MidiSheetMusic.SheetMusic.LineSpace|0)+MidiSheetMusic.SheetMusic.LineWidth|0)+1|0);g.DrawBezier(pen,x,ynote+(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)|0,x+(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,2)|0)|0,ynote-(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,2)|0)|0,(x+MidiSheetMusic.SheetMusic.LineSpace|0)+(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)|0,(ynote+(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,3)|0)|0)-(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)|0,x,((ynote+MidiSheetMusic.SheetMusic.LineSpace|0)+MidiSheetMusic.SheetMusic.LineWidth|0)+1|0);g.DrawBezier(pen,x,ynote+(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)|0,x+(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,2)|0)|0,ynote-(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,2)|0)|0,(x+MidiSheetMusic.SheetMusic.LineSpace|0)+(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,2)|0)|0,(ynote+(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,3)|0)|0)-(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,2)|0)|0,x,((ynote+MidiSheetMusic.SheetMusic.LineSpace|0)+MidiSheetMusic.SheetMusic.LineWidth|0)+1|0)},DrawNatural:function(g,pen,ynote){var ystart=(ynote-MidiSheetMusic.SheetMusic.LineSpace|0)-MidiSheetMusic.SheetMusic.LineWidth|0,yend=(ynote+MidiSheetMusic.SheetMusic.LineSpace|0)+MidiSheetMusic.SheetMusic.LineWidth|0,x=Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,2)|0,xstart,xend;pen.Width=1;g.DrawLine(pen,x,ystart,x,yend);x=x+(MidiSheetMusic.SheetMusic.LineSpace-(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)|0)|0;ystart=ynote-(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)|0;yend=((ynote+Bridge.Int.mul(2,MidiSheetMusic.SheetMusic.LineSpace)|0)+MidiSheetMusic.SheetMusic.LineWidth|0)-(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)|0;g.DrawLine(pen,x,ystart,x,yend);xstart=Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,2)|0;xend=(xstart+MidiSheetMusic.SheetMusic.LineSpace|0)-(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)|0;ystart=ynote+MidiSheetMusic.SheetMusic.LineWidth|0;yend=(ystart-MidiSheetMusic.SheetMusic.LineWidth|0)-(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)|0;pen.Width=Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,2)|0;g.DrawLine(pen,xstart,ystart,xend,yend);ystart=ystart+MidiSheetMusic.SheetMusic.LineSpace|0;yend=yend+MidiSheetMusic.SheetMusic.LineSpace|0;g.DrawLine(pen,xstart,ystart,xend,yend);pen.Width=1},toString:function(){return System.String.format("AccidSymbol accid={0} whitenote={1} clef={2} width={3}",Bridge.box(this.accid,MidiSheetMusic.Accid,System.Enum.toStringFn(MidiSheetMusic.Accid)),this.whitenote,Bridge.box(this.clef,MidiSheetMusic.Clef,System.Enum.toStringFn(MidiSheetMusic.Clef)),Bridge.box(this.width,System.Int32))}}});Bridge.define("MidiSheetMusic.BarSymbol",{inherits:[MidiSheetMusic.MusicSymbol],fields:{starttime:0,width:0},props:{StartTime:{get:function(){return this.starttime}},MinWidth:{get:function(){return Bridge.Int.mul(2,MidiSheetMusic.SheetMusic.LineSpace)}},Width:{get:function(){return this.width},set:function(value){this.width=value}},AboveStaff:{get:function(){return 0}},BelowStaff:{get:function(){return 0}}},ctors:{ctor:function(starttime){this.$initialize();MidiSheetMusic.MusicSymbol.ctor.call(this);this.starttime=starttime;this.width=this.MinWidth}},methods:{Draw:function(g,pen,ytop){var y=ytop,yend=(y+Bridge.Int.mul(MidiSheetMusic.SheetMusic.LineSpace,4)|0)+4|0;pen.Width=1;g.DrawLine(pen,Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteWidth,2)|0,y,Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteWidth,2)|0,yend)},toString:function(){return System.String.format("BarSymbol starttime={0} width={1}",Bridge.box(this.starttime,System.Int32),Bridge.box(this.width,System.Int32))}}});Bridge.define("MidiSheetMusic.Bitmap",{inherits:[MidiSheetMusic.Image],ctors:{ctor:function(type,filename){this.$initialize();MidiSheetMusic.Image.ctor.call(this,type,filename)}}});Bridge.define("MidiSheetMusic.BlankSymbol",{inherits:[MidiSheetMusic.MusicSymbol],fields:{starttime:0,width:0},props:{StartTime:{get:function(){return this.starttime}},MinWidth:{get:function(){return 0}},Width:{get:function(){return this.width},set:function(value){this.width=value}},AboveStaff:{get:function(){return 0}},BelowStaff:{get:function(){return 0}}},ctors:{ctor:function(starttime,width){this.$initialize();MidiSheetMusic.MusicSymbol.ctor.call(this);this.starttime=starttime;this.width=width}},methods:{Draw:function(){},toString:function(){return System.String.format("BlankSymbol starttime={0} width={1}",Bridge.box(this.starttime,System.Int32),Bridge.box(this.width,System.Int32))}}});Bridge.define("MidiSheetMusic.ChordSymbol",{inherits:[MidiSheetMusic.MusicSymbol],statics:{methods:{CreateNoteData:function(midinotes,key,time){for(var midi,len=midinotes.Count,notedata=System.Array.init(len,null,MidiSheetMusic.NoteData),i=0;i<len;i=i+1|0)midi=midinotes.getItem(i),notedata[System.Array.index(i,notedata)]=new MidiSheetMusic.NoteData,notedata[System.Array.index(i,notedata)].number=midi.Number,notedata[System.Array.index(i,notedata)].leftside=!0,notedata[System.Array.index(i,notedata)].whitenote=key.GetWhiteNote(midi.Number),notedata[System.Array.index(i,notedata)].duration=time.GetNoteDuration(midi.EndTime-midi.StartTime|0),notedata[System.Array.index(i,notedata)].accid=key.GetAccidental(midi.Number,Bridge.Int.div(midi.StartTime,time.Measure)|0),notedata[System.Array.index(i,notedata)].leftside=i>0&&notedata[System.Array.index(i,notedata)].whitenote.Dist(notedata[System.Array.index(i-1|0,notedata)].whitenote)===1?notedata[System.Array.index(i-1|0,notedata)].leftside?!1:!0:!0;return notedata},CreateAccidSymbols:function(notedata,clef){var $t,$t1,count=0,n,symbols,i,n1;$t=Bridge.getEnumerator(notedata);try{while($t.moveNext())n=$t.Current,n.accid!==MidiSheetMusic.Accid.None&&(count=count+1|0)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}symbols=System.Array.init(count,null,MidiSheetMusic.AccidSymbol);i=0;$t1=Bridge.getEnumerator(notedata);try{while($t1.moveNext())n1=$t1.Current,n1.accid!==MidiSheetMusic.Accid.None&&(symbols[System.Array.index(i,symbols)]=new MidiSheetMusic.AccidSymbol(n1.accid,n1.whitenote,clef),i=i+1|0)}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$dispose()}return symbols},StemDirection:function(bottom,top,clef){var middle,dist;return middle=clef===MidiSheetMusic.Clef.Treble?new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.B,5):new MidiSheetMusic.WhiteNote(MidiSheetMusic.WhiteNote.D,3),dist=middle.Dist(bottom)+middle.Dist(top)|0,dist>=0?MidiSheetMusic.Stem.Up:MidiSheetMusic.Stem.Down},NotesOverlap:function(notedata,start,end){for(var i=start;i<end;i=i+1|0)if(!notedata[System.Array.index(i,notedata)].leftside)return!0;return!1},CanCreateBeam:function(chords,time,startQuarter){var $t,$t1,numChords=chords.length,firstStem=chords[System.Array.index(0,chords)].Stem,lastStem=chords[System.Array.index(chords.length-1|0,chords)].Stem,correctTime,beat,correctTime1,beat1,valid,beat2,beat3,chord,hasTwoStems,direction,chord1,note1,note2;if(firstStem==null||lastStem==null)return!1;var measure=Bridge.Int.div(chords[System.Array.index(0,chords)].StartTime,time.Measure)|0,dur=firstStem.Duration,dur2=lastStem.Duration,dotted8_to_16=!1;if(chords.length===2&&dur===MidiSheetMusic.NoteDuration.DottedEighth&&dur2===MidiSheetMusic.NoteDuration.Sixteenth&&(dotted8_to_16=!0),dur===MidiSheetMusic.NoteDuration.Whole||dur===MidiSheetMusic.NoteDuration.Half||dur===MidiSheetMusic.NoteDuration.DottedHalf||dur===MidiSheetMusic.NoteDuration.Quarter||dur===MidiSheetMusic.NoteDuration.DottedQuarter||dur===MidiSheetMusic.NoteDuration.DottedEighth&&!dotted8_to_16)return!1;if(numChords===6){if(dur!==MidiSheetMusic.NoteDuration.Eighth||(correctTime=time.Numerator===3&&time.Denominator===4||time.Numerator===6&&time.Denominator===8||time.Numerator===6&&time.Denominator===4,!correctTime)||time.Numerator===6&&time.Denominator===4&&(beat=Bridge.Int.mul(time.Quarter,3),chords[System.Array.index(0,chords)].StartTime%beat>(Bridge.Int.div(time.Quarter,6)|0)))return!1}else if(numChords===4){if(time.Numerator===3&&time.Denominator===8||(correctTime1=time.Numerator===2||time.Numerator===4||time.Numerator===8,!correctTime1&&dur!==MidiSheetMusic.NoteDuration.Sixteenth)||(beat1=time.Quarter,dur===MidiSheetMusic.NoteDuration.Eighth?beat1=Bridge.Int.mul(time.Quarter,2):dur===MidiSheetMusic.NoteDuration.ThirtySecond&&(beat1=Bridge.Int.div(time.Quarter,2)|0),chords[System.Array.index(0,chords)].StartTime%beat1>(Bridge.Int.div(time.Quarter,6)|0)))return!1}else if(numChords===3){if((valid=dur===MidiSheetMusic.NoteDuration.Triplet||dur===MidiSheetMusic.NoteDuration.Eighth&&time.Numerator===12&&time.Denominator===8,!valid)||(beat2=time.Quarter,time.Numerator===12&&time.Denominator===8&&(beat2=Bridge.Int.mul(Bridge.Int.div(time.Quarter,2)|0,3)),chords[System.Array.index(0,chords)].StartTime%beat2>(Bridge.Int.div(time.Quarter,6)|0)))return!1}else if(numChords===2&&startQuarter&&(beat3=time.Quarter,chords[System.Array.index(0,chords)].StartTime%beat3>(Bridge.Int.div(time.Quarter,6)|0)))return!1;$t=Bridge.getEnumerator(chords);try{while($t.moveNext())if((chord=$t.Current,(Bridge.Int.div(chord.StartTime,time.Measure)|0)!==measure)||chord.Stem==null||chord.Stem.Duration!==dur&&!dotted8_to_16||chord.Stem.isBeam)return!1}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}hasTwoStems=!1;direction=MidiSheetMusic.Stem.Up;$t1=Bridge.getEnumerator(chords);try{while($t1.moveNext())if(chord1=$t1.Current,chord1.HasTwoStems){if(hasTwoStems&&chord1.Stem.Direction!==direction)return!1;hasTwoStems=!0;direction=chord1.Stem.Direction}}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$dispose()}if(hasTwoStems||(note1=firstStem.Direction===MidiSheetMusic.Stem.Up?firstStem.Top:firstStem.Bottom,note2=lastStem.Direction===MidiSheetMusic.Stem.Up?lastStem.Top:lastStem.Bottom,direction=MidiSheetMusic.ChordSymbol.StemDirection(note1,note2,chords[System.Array.index(0,chords)].Clef)),direction===MidiSheetMusic.Stem.Up){if(Math.abs(firstStem.Top.Dist(lastStem.Top))>=11)return!1}else if(Math.abs(firstStem.Bottom.Dist(lastStem.Bottom))>=11)return!1;return!0},CreateBeam:function(chords,spacing){var $t,$t1,firstStem=chords[System.Array.index(0,chords)].Stem,lastStem=chords[System.Array.index(chords.length-1|0,chords)].Stem,newdirection=-1,chord,note1,note2,chord1,i;$t=Bridge.getEnumerator(chords);try{while($t.moveNext())if(chord=$t.Current,chord.HasTwoStems){newdirection=chord.Stem.Direction;break}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}newdirection===-1&&(note1=firstStem.Direction===MidiSheetMusic.Stem.Up?firstStem.Top:firstStem.Bottom,note2=lastStem.Direction===MidiSheetMusic.Stem.Up?lastStem.Top:lastStem.Bottom,newdirection=MidiSheetMusic.ChordSymbol.StemDirection(note1,note2,chords[System.Array.index(0,chords)].Clef));$t1=Bridge.getEnumerator(chords);try{while($t1.moveNext())chord1=$t1.Current,chord1.Stem.Direction=newdirection}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$dispose()}for(chords.length===2?MidiSheetMusic.ChordSymbol.BringStemsCloser(chords):MidiSheetMusic.ChordSymbol.LineUpStemEnds(chords),firstStem.SetPair(lastStem,spacing),i=1;i<chords.length;i=i+1|0)chords[System.Array.index(i,chords)].Stem.Receiver=!0},BringStemsCloser:function(chords){var firstStem=chords[System.Array.index(0,chords)].Stem,lastStem=chords[System.Array.index(1,chords)].Stem,distance;firstStem.Duration===MidiSheetMusic.NoteDuration.DottedEighth&&lastStem.Duration===MidiSheetMusic.NoteDuration.Sixteenth&&(firstStem.End=firstStem.Direction===MidiSheetMusic.Stem.Up?firstStem.End.Add(2):firstStem.End.Add(-2));distance=Math.abs(firstStem.End.Dist(lastStem.End));firstStem.Direction===MidiSheetMusic.Stem.Up?Bridge.referenceEquals(MidiSheetMusic.WhiteNote.Max(firstStem.End,lastStem.End),firstStem.End)?lastStem.End=lastStem.End.Add(Bridge.Int.div(distance,2)|0):firstStem.End=firstStem.End.Add(Bridge.Int.div(distance,2)|0):Bridge.referenceEquals(MidiSheetMusic.WhiteNote.Min(firstStem.End,lastStem.End),firstStem.End)?lastStem.End=lastStem.End.Add(Bridge.Int.div(-distance|0,2)|0):firstStem.End=firstStem.End.Add(Bridge.Int.div(-distance|0,2)|0)},LineUpStemEnds:function(chords){var $t,$t1,firstStem=chords[System.Array.index(0,chords)].Stem,lastStem=chords[System.Array.index(chords.length-1|0,chords)].Stem,middleStem=chords[System.Array.index(1,chords)].Stem,top,chord,bottom,chord1,i,stem;if(firstStem.Direction===MidiSheetMusic.Stem.Up){top=firstStem.End;$t=Bridge.getEnumerator(chords);try{while($t.moveNext())chord=$t.Current,top=MidiSheetMusic.WhiteNote.Max(top,chord.Stem.End)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}Bridge.referenceEquals(top,firstStem.End)&&top.Dist(lastStem.End)>=2?(firstStem.End=top,middleStem.End=top.Add(-1),lastStem.End=top.Add(-2)):Bridge.referenceEquals(top,lastStem.End)&&top.Dist(firstStem.End)>=2?(firstStem.End=top.Add(-2),middleStem.End=top.Add(-1),lastStem.End=top):(firstStem.End=top,middleStem.End=top,lastStem.End=top)}else{bottom=firstStem.End;$t1=Bridge.getEnumerator(chords);try{while($t1.moveNext())chord1=$t1.Current,bottom=MidiSheetMusic.WhiteNote.Min(bottom,chord1.Stem.End)}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$dispose()}Bridge.referenceEquals(bottom,firstStem.End)&&lastStem.End.Dist(bottom)>=2?(middleStem.End=bottom.Add(1),lastStem.End=bottom.Add(2)):Bridge.referenceEquals(bottom,lastStem.End)&&firstStem.End.Dist(bottom)>=2?(middleStem.End=bottom.Add(1),firstStem.End=bottom.Add(2)):(firstStem.End=bottom,middleStem.End=bottom,lastStem.End=bottom)}for(i=1;i<(chords.length-1|0);i=i+1|0)stem=chords[System.Array.index(i,chords)].Stem,stem.End=middleStem.End}}},fields:{clef:0,starttime:0,endtime:0,notedata:null,accidsymbols:null,width:0,stem1:null,stem2:null,hastwostems:!1,sheetmusic:null},props:{StartTime:{get:function(){return this.starttime}},EndTime:{get:function(){return this.endtime}},Clef:{get:function(){return this.clef}},HasTwoStems:{get:function(){return this.hastwostems}},Stem:{get:function(){return this.stem1==null?this.stem2:this.stem2==null?this.stem1:this.stem1.Duration<this.stem2.Duration?this.stem1:this.stem2}},Width:{get:function(){return this.width},set:function(value){this.width=value}},MinWidth:{get:function(){return this.GetMinWidth()}},AboveStaff:{get:function(){return this.GetAboveStaff()}},BelowStaff:{get:function(){return this.GetBelowStaff()}}},ctors:{ctor:function(midinotes,key,time,c,sheet){var len,i,direction;for(this.$initialize(),MidiSheetMusic.MusicSymbol.ctor.call(this),len=midinotes.Count,this.hastwostems=!1,this.clef=c,this.sheetmusic=sheet,this.starttime=midinotes.getItem(0).StartTime,this.endtime=midinotes.getItem(0).EndTime,i=0;i<midinotes.Count;i=i+1|0){if(i>1&&midinotes.getItem(i).Number<midinotes.getItem(i-1|0).Number)throw new System.ArgumentException("Chord notes not in increasing order by number");this.endtime=Math.max(this.endtime,midinotes.getItem(i).EndTime)}this.notedata=MidiSheetMusic.ChordSymbol.CreateNoteData(midinotes,key,time);this.accidsymbols=MidiSheetMusic.ChordSymbol.CreateAccidSymbols(this.notedata,this.clef);var dur1=this.notedata[System.Array.index(0,this.notedata)].duration,dur2=dur1,change=-1;for(i=0;i<this.notedata.length;i=i+1|0)if(dur2=this.notedata[System.Array.index(i,this.notedata)].duration,dur1!==dur2){change=i;break}dur1!==dur2?(this.hastwostems=!0,this.stem1=new MidiSheetMusic.Stem(this.notedata[System.Array.index(0,this.notedata)].whitenote,this.notedata[System.Array.index(change-1|0,this.notedata)].whitenote,dur1,MidiSheetMusic.Stem.Down,MidiSheetMusic.ChordSymbol.NotesOverlap(this.notedata,0,change)),this.stem2=new MidiSheetMusic.Stem(this.notedata[System.Array.index(change,this.notedata)].whitenote,this.notedata[System.Array.index(this.notedata.length-1|0,this.notedata)].whitenote,dur2,MidiSheetMusic.Stem.Up,MidiSheetMusic.ChordSymbol.NotesOverlap(this.notedata,change,this.notedata.length))):(direction=MidiSheetMusic.ChordSymbol.StemDirection(this.notedata[System.Array.index(0,this.notedata)].whitenote,this.notedata[System.Array.index(this.notedata.length-1|0,this.notedata)].whitenote,this.clef),this.stem1=new MidiSheetMusic.Stem(this.notedata[System.Array.index(0,this.notedata)].whitenote,this.notedata[System.Array.index(this.notedata.length-1|0,this.notedata)].whitenote,dur1,direction,MidiSheetMusic.ChordSymbol.NotesOverlap(this.notedata,0,this.notedata.length)),this.stem2=null);dur1===MidiSheetMusic.NoteDuration.Whole&&(this.stem1=null);dur2===MidiSheetMusic.NoteDuration.Whole&&(this.stem2=null);this.width=this.MinWidth}},methods:{GetMinWidth:function(){var result=Bridge.Int.mul(2,MidiSheetMusic.SheetMusic.NoteHeight)+(Bridge.Int.div(Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,3),4)|0)|0,i,accid,prev;if(this.accidsymbols.length>0)for(result=result+this.accidsymbols[System.Array.index(0,this.accidsymbols)].MinWidth|0,i=1;i<this.accidsymbols.length;i=i+1|0)accid=this.accidsymbols[System.Array.index(i,this.accidsymbols)],prev=this.accidsymbols[System.Array.index(i-1|0,this.accidsymbols)],accid.Note.Dist(prev.Note)<6&&(result=result+accid.MinWidth|0);return this.sheetmusic!=null&&this.sheetmusic.ShowNoteLetters!==MidiSheetMusic.MidiOptions.NoteNameNone&&(result=result+8|0),result},GetAboveStaff:function(){var $t,topnote=this.notedata[System.Array.index(this.notedata.length-1|0,this.notedata)].whitenote,dist,result,symbol;this.stem1!=null&&(topnote=MidiSheetMusic.WhiteNote.Max(topnote,this.stem1.End));this.stem2!=null&&(topnote=MidiSheetMusic.WhiteNote.Max(topnote,this.stem2.End));dist=Bridge.Int.div(Bridge.Int.mul(topnote.Dist(MidiSheetMusic.WhiteNote.Top(this.clef)),MidiSheetMusic.SheetMusic.NoteHeight),2)|0;result=0;dist>0&&(result=dist);$t=Bridge.getEnumerator(this.accidsymbols);try{while($t.moveNext())symbol=$t.Current,symbol.AboveStaff>result&&(result=symbol.AboveStaff)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return result},GetBelowStaff:function(){var $t,bottomnote=this.notedata[System.Array.index(0,this.notedata)].whitenote,dist,result,symbol;this.stem1!=null&&(bottomnote=MidiSheetMusic.WhiteNote.Min(bottomnote,this.stem1.End));this.stem2!=null&&(bottomnote=MidiSheetMusic.WhiteNote.Min(bottomnote,this.stem2.End));dist=Bridge.Int.div(Bridge.Int.mul(MidiSheetMusic.WhiteNote.Bottom(this.clef).Dist(bottomnote),MidiSheetMusic.SheetMusic.NoteHeight),2)|0;result=0;dist>0&&(result=dist);$t=Bridge.getEnumerator(this.accidsymbols);try{while($t.moveNext())symbol=$t.Current,symbol.BelowStaff>result&&(result=symbol.BelowStaff)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return result},NoteName:function(notenumber,whitenote){var fixedDoReMi,notescale,notescale1,num,notescale2,notescale3;if(this.sheetmusic.ShowNoteLetters===MidiSheetMusic.MidiOptions.NoteNameLetter)return this.Letter(notenumber,whitenote);if(this.sheetmusic.ShowNoteLetters===MidiSheetMusic.MidiOptions.NoteNameFixedDoReMi)return fixedDoReMi=System.Array.init(["La","Li","Ti","Do","Di","Re","Ri","Mi","Fa","Fi","So","Si"],System.String),notescale=MidiSheetMusic.NoteScale.FromNumber(notenumber),fixedDoReMi[System.Array.index(notescale,fixedDoReMi)];if(this.sheetmusic.ShowNoteLetters===MidiSheetMusic.MidiOptions.NoteNameMovableDoReMi){var fixedDoReMi1=System.Array.init(["La","Li","Ti","Do","Di","Re","Ri","Mi","Fa","Fi","So","Si"],System.String),mainscale=this.sheetmusic.MainKey.Notescale(),diff=MidiSheetMusic.NoteScale.C-mainscale|0;return notenumber=notenumber+diff|0,notenumber<0&&(notenumber=notenumber+12|0),notescale1=MidiSheetMusic.NoteScale.FromNumber(notenumber),fixedDoReMi1[System.Array.index(notescale1,fixedDoReMi1)]}if(this.sheetmusic.ShowNoteLetters===MidiSheetMusic.MidiOptions.NoteNameFixedNumber)return num=System.Array.init(["10","11","12","1","2","3","4","5","6","7","8","9"],System.String),notescale2=MidiSheetMusic.NoteScale.FromNumber(notenumber),num[System.Array.index(notescale2,num)];if(this.sheetmusic.ShowNoteLetters===MidiSheetMusic.MidiOptions.NoteNameMovableNumber){var num1=System.Array.init(["10","11","12","1","2","3","4","5","6","7","8","9"],System.String),mainscale1=this.sheetmusic.MainKey.Notescale(),diff1=MidiSheetMusic.NoteScale.C-mainscale1|0;return notenumber=notenumber+diff1|0,notenumber<0&&(notenumber=notenumber+12|0),notescale3=MidiSheetMusic.NoteScale.FromNumber(notenumber),num1[System.Array.index(notescale3,num1)]}return""},Letter:function(notenumber,whitenote){var notescale=MidiSheetMusic.NoteScale.FromNumber(notenumber);switch(notescale){case MidiSheetMusic.NoteScale.A:return"A";case MidiSheetMusic.NoteScale.B:return"B";case MidiSheetMusic.NoteScale.C:return"C";case MidiSheetMusic.NoteScale.D:return"D";case MidiSheetMusic.NoteScale.E:return"E";case MidiSheetMusic.NoteScale.F:return"F";case MidiSheetMusic.NoteScale.G:return"G";case MidiSheetMusic.NoteScale.Asharp:return whitenote.Letter===MidiSheetMusic.WhiteNote.A?"A#":"Bb";case MidiSheetMusic.NoteScale.Csharp:return whitenote.Letter===MidiSheetMusic.WhiteNote.C?"C#":"Db";case MidiSheetMusic.NoteScale.Dsharp:return whitenote.Letter===MidiSheetMusic.WhiteNote.D?"D#":"Eb";case MidiSheetMusic.NoteScale.Fsharp:return whitenote.Letter===MidiSheetMusic.WhiteNote.F?"F#":"Gb";case MidiSheetMusic.NoteScale.Gsharp:return whitenote.Letter===MidiSheetMusic.WhiteNote.G?"G#":"Ab";default:return""}},Draw:function(g,pen,ytop){g.TranslateTransform(this.Width-this.MinWidth|0,0);var topstaff=MidiSheetMusic.WhiteNote.Top(this.clef),xpos=this.DrawAccid(g,pen,ytop);g.TranslateTransform(xpos,0);this.DrawNotes(g,pen,ytop,topstaff);this.sheetmusic!=null&&this.sheetmusic.ShowNoteLetters!==0&&this.DrawNoteLetters(g,pen,ytop,topstaff);this.stem1!=null&&this.stem1.Draw(g,pen,ytop,topstaff);this.stem2!=null&&this.stem2.Draw(g,pen,ytop,topstaff);g.TranslateTransform(-xpos|0,0);g.TranslateTransform(-(this.Width-this.MinWidth|0)|0,0)},DrawAccid:function(g,pen,ytop){var $t,xpos=0,prev=null,symbol;$t=Bridge.getEnumerator(this.accidsymbols);try{while($t.moveNext())symbol=$t.Current,prev!=null&&symbol.Note.Dist(prev.Note)<6&&(xpos=xpos+symbol.Width|0),g.TranslateTransform(xpos,0),symbol.Draw(g,pen,ytop),g.TranslateTransform(-xpos|0,0),prev=symbol}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return prev!=null&&(xpos=xpos+prev.Width|0),xpos},DrawNotes:function(g,pen,ytop,topstaff){var $t,brush,i,bottom,i1;pen.Width=1;$t=Bridge.getEnumerator(this.notedata);try{while($t.moveNext()){var note=$t.Current,ynote=ytop+(Bridge.Int.div(Bridge.Int.mul(topstaff.Dist(note.whitenote),MidiSheetMusic.SheetMusic.NoteHeight),2)|0)|0,xnote=Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0;note.leftside||(xnote=xnote+MidiSheetMusic.SheetMusic.NoteWidth|0);g.TranslateTransform((xnote+(Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteWidth,2)|0)|0)+1|0,(ynote-MidiSheetMusic.SheetMusic.LineWidth|0)+(Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteHeight,2)|0)|0);g.RotateTransform(-45);pen.Color=this.sheetmusic!=null?this.sheetmusic.NoteColor(note.number):MidiSheetMusic.Color.Black;note.duration===MidiSheetMusic.NoteDuration.Whole||note.duration===MidiSheetMusic.NoteDuration.Half||note.duration===MidiSheetMusic.NoteDuration.DottedHalf?(g.DrawEllipse(pen,Bridge.Int.div(-MidiSheetMusic.SheetMusic.NoteWidth|0,2)|0,Bridge.Int.div(-MidiSheetMusic.SheetMusic.NoteHeight|0,2)|0,MidiSheetMusic.SheetMusic.NoteWidth,MidiSheetMusic.SheetMusic.NoteHeight-1|0),g.DrawEllipse(pen,Bridge.Int.div(-MidiSheetMusic.SheetMusic.NoteWidth|0,2)|0,(Bridge.Int.div(-MidiSheetMusic.SheetMusic.NoteHeight|0,2)|0)+1|0,MidiSheetMusic.SheetMusic.NoteWidth,MidiSheetMusic.SheetMusic.NoteHeight-2|0),g.DrawEllipse(pen,Bridge.Int.div(-MidiSheetMusic.SheetMusic.NoteWidth|0,2)|0,(Bridge.Int.div(-MidiSheetMusic.SheetMusic.NoteHeight|0,2)|0)+1|0,MidiSheetMusic.SheetMusic.NoteWidth,MidiSheetMusic.SheetMusic.NoteHeight-3|0)):(brush=MidiSheetMusic.Brushes.Black,Bridge.referenceEquals(pen.Color,MidiSheetMusic.Color.Black)||(brush=new MidiSheetMusic.SolidBrush(pen.Color)),g.FillEllipse(brush,Bridge.Int.div(-MidiSheetMusic.SheetMusic.NoteWidth|0,2)|0,Bridge.Int.div(-MidiSheetMusic.SheetMusic.NoteHeight|0,2)|0,MidiSheetMusic.SheetMusic.NoteWidth,MidiSheetMusic.SheetMusic.NoteHeight-1|0),Bridge.referenceEquals(pen.Color,MidiSheetMusic.Color.Black)||brush.Dispose());pen.Color=MidiSheetMusic.Color.Black;g.DrawEllipse(pen,Bridge.Int.div(-MidiSheetMusic.SheetMusic.NoteWidth|0,2)|0,Bridge.Int.div(-MidiSheetMusic.SheetMusic.NoteHeight|0,2)|0,MidiSheetMusic.SheetMusic.NoteWidth,MidiSheetMusic.SheetMusic.NoteHeight-1|0);g.RotateTransform(45);g.TranslateTransform(-((xnote+(Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteWidth,2)|0)|0)+1|0)|0,-((ynote-MidiSheetMusic.SheetMusic.LineWidth|0)+(Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteHeight,2)|0)|0)|0);(note.duration===MidiSheetMusic.NoteDuration.DottedHalf||note.duration===MidiSheetMusic.NoteDuration.DottedQuarter||note.duration===MidiSheetMusic.NoteDuration.DottedEighth)&&g.FillEllipse(MidiSheetMusic.Brushes.Black,(xnote+MidiSheetMusic.SheetMusic.NoteWidth|0)+(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,3)|0)|0,ynote+(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,3)|0)|0,4,4);var top=topstaff.Add(1),dist=note.whitenote.Dist(top),y=ytop-MidiSheetMusic.SheetMusic.LineWidth|0;if(dist>=2)for(i=2;i<=dist;i=i+2|0)y=y-MidiSheetMusic.SheetMusic.NoteHeight|0,g.DrawLine(pen,xnote-(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)|0,y,(xnote+MidiSheetMusic.SheetMusic.NoteWidth|0)+(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)|0,y);if(bottom=top.Add(-8),y=(ytop+Bridge.Int.mul(MidiSheetMusic.SheetMusic.LineSpace+MidiSheetMusic.SheetMusic.LineWidth|0,4)|0)-1|0,dist=bottom.Dist(note.whitenote),dist>=2)for(i1=2;i1<=dist;i1=i1+2|0)y=y+MidiSheetMusic.SheetMusic.NoteHeight|0,g.DrawLine(pen,xnote-(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)|0,y,(xnote+MidiSheetMusic.SheetMusic.NoteWidth|0)+(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)|0,y)}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}},DrawNoteLetters:function(g,pen,ytop,topstaff){var $t,overlap=MidiSheetMusic.ChordSymbol.NotesOverlap(this.notedata,0,this.notedata.length),note,ynote,xnote;pen.Width=1;$t=Bridge.getEnumerator(this.notedata);try{while($t.moveNext())(note=$t.Current,note.leftside)&&(ynote=ytop+(Bridge.Int.div(Bridge.Int.mul(topstaff.Dist(note.whitenote),MidiSheetMusic.SheetMusic.NoteHeight),2)|0)|0,xnote=MidiSheetMusic.SheetMusic.NoteWidth+(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,4)|0)|0,(note.duration===MidiSheetMusic.NoteDuration.DottedHalf||note.duration===MidiSheetMusic.NoteDuration.DottedQuarter||note.duration===MidiSheetMusic.NoteDuration.DottedEighth||overlap)&&(xnote=xnote+(Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteWidth,2)|0)|0),g.DrawString(this.NoteName(note.number,note.whitenote),MidiSheetMusic.SheetMusic.LetterFont,MidiSheetMusic.Brushes.Black,xnote,ynote-(Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteHeight,2)|0)|0))}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}},toString:function(){var $t,$t1,result=System.String.format("ChordSymbol clef={0} start={1} end={2} width={3} hastwostems={4} ",Bridge.box(this.clef,MidiSheetMusic.Clef,System.Enum.toStringFn(MidiSheetMusic.Clef)),Bridge.box(this.StartTime,System.Int32),Bridge.box(this.EndTime,System.Int32),Bridge.box(this.Width,System.Int32),Bridge.box(this.hastwostems,System.Boolean,System.Boolean.toString)),symbol,note;$t=Bridge.getEnumerator(this.accidsymbols);try{while($t.moveNext())symbol=$t.Current,result=(result||"")+((symbol.toString()||"")+" "||"")}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}$t1=Bridge.getEnumerator(this.notedata);try{while($t1.moveNext())note=$t1.Current,result=(result||"")+(System.String.format("Note whitenote={0} duration={1} leftside={2} ",note.whitenote,Bridge.box(note.duration,MidiSheetMusic.NoteDuration,System.Enum.toStringFn(MidiSheetMusic.NoteDuration)),Bridge.box(note.leftside,System.Boolean,System.Boolean.toString))||"")}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$dispose()}return this.stem1!=null&&(result=(result||"")+((this.stem1.toString()||"")+" "||"")),this.stem2!=null&&(result=(result||"")+((this.stem2.toString()||"")+" "||"")),result}}});Bridge.define("MidiSheetMusic.ClefSymbol",{inherits:[MidiSheetMusic.MusicSymbol],statics:{fields:{treble:null,bass:null},methods:{LoadImages:function(){MidiSheetMusic.ClefSymbol.treble==null&&(MidiSheetMusic.ClefSymbol.treble=new MidiSheetMusic.Bitmap(MidiSheetMusic.ClefSymbol,"Resources.Images.treble.png"));MidiSheetMusic.ClefSymbol.bass==null&&(MidiSheetMusic.ClefSymbol.bass=new MidiSheetMusic.Bitmap(MidiSheetMusic.ClefSymbol,"Resources.Images.bass.png"))}}},fields:{starttime:0,smallsize:!1,clef:0,width:0},props:{StartTime:{get:function(){return this.starttime}},MinWidth:{get:function(){return this.smallsize?Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteWidth,2):Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteWidth,3)}},Width:{get:function(){return this.width},set:function(value){this.width=value}},AboveStaff:{get:function(){return this.clef!==MidiSheetMusic.Clef.Treble||this.smallsize?0:Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,2)}},BelowStaff:{get:function(){return this.clef!==MidiSheetMusic.Clef.Treble||this.smallsize?this.clef===MidiSheetMusic.Clef.Treble&&this.smallsize?MidiSheetMusic.SheetMusic.NoteHeight:0:Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,2)}}},ctors:{ctor:function(clef,starttime,small){this.$initialize();MidiSheetMusic.MusicSymbol.ctor.call(this);this.clef=clef;this.starttime=starttime;this.smallsize=small;MidiSheetMusic.ClefSymbol.LoadImages();this.width=this.MinWidth}},methods:{Draw:function(g,pen,ytop){var y,image,height,imgwidth;g.TranslateTransform(this.Width-this.MinWidth|0,0);y=ytop;this.clef===MidiSheetMusic.Clef.Treble?(image=MidiSheetMusic.ClefSymbol.treble,this.smallsize?height=MidiSheetMusic.SheetMusic.StaffHeight+(Bridge.Int.div(MidiSheetMusic.SheetMusic.StaffHeight,4)|0)|0:(height=(Bridge.Int.div(Bridge.Int.mul(3,MidiSheetMusic.SheetMusic.StaffHeight),2)|0)+(Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteHeight,2)|0)|0,y=ytop-MidiSheetMusic.SheetMusic.NoteHeight|0)):(image=MidiSheetMusic.ClefSymbol.bass,height=this.smallsize?MidiSheetMusic.SheetMusic.StaffHeight-(Bridge.Int.div(Bridge.Int.mul(3,MidiSheetMusic.SheetMusic.NoteHeight),2)|0)|0:MidiSheetMusic.SheetMusic.StaffHeight-MidiSheetMusic.SheetMusic.NoteHeight|0);imgwidth=Bridge.Int.div(Bridge.Int.mul(image.Width,height),image.Height)|0;g.DrawImage(image,0,y,imgwidth,height);g.TranslateTransform(-(this.Width-this.MinWidth|0)|0,0)},toString:function(){return System.String.format("ClefSymbol clef={0} small={1} width={2}",Bridge.box(this.clef,MidiSheetMusic.Clef,System.Enum.toStringFn(MidiSheetMusic.Clef)),Bridge.box(this.smallsize,System.Boolean,System.Boolean.toString),Bridge.box(this.width,System.Int32))}}});Bridge.define("MidiSheetMusic.FileStream",{inherits:[MidiSheetMusic.Stream],ctors:{ctor:function(){this.$initialize();MidiSheetMusic.Stream.ctor.call(this)}}});Bridge.define("MidiSheetMusic.Piano",{inherits:[MidiSheetMusic.Control],statics:{fields:{KeysPerOctave:0,MaxOctave:0,WhiteKeyWidth:0,WhiteKeyHeight:0,BlackKeyWidth:0,BlackKeyHeight:0,margin:0,BlackBorder:0,blackKeyOffsets:null},ctors:{init:function(){this.KeysPerOctave=7;this.MaxOctave=7}}},fields:{gray1Pen:null,gray2Pen:null,gray3Pen:null,gray1Brush:null,gray2Brush:null,shadeBrush:null,shade2Brush:null,useTwoColors:!1,notes:null,maxShadeDuration:0,showNoteLetters:0,graphics:null},ctors:{ctor:function(){var screenwidth;this.$initialize();MidiSheetMusic.Control.ctor.call(this);screenwidth=1024;screenwidth>=3200&&(screenwidth=Bridge.Int.div(screenwidth,4)|0);screenwidth=Bridge.Int.div(Bridge.Int.mul(screenwidth,95),100)|0;MidiSheetMusic.Piano.WhiteKeyWidth=Bridge.Int.clip32(screenwidth/51);MidiSheetMusic.Piano.WhiteKeyWidth%2!=0&&(MidiSheetMusic.Piano.WhiteKeyWidth=MidiSheetMusic.Piano.WhiteKeyWidth-1|0);MidiSheetMusic.Piano.margin=0;MidiSheetMusic.Piano.BlackBorder=Bridge.Int.div(MidiSheetMusic.Piano.WhiteKeyWidth,2)|0;MidiSheetMusic.Piano.WhiteKeyHeight=Bridge.Int.mul(MidiSheetMusic.Piano.WhiteKeyWidth,5);MidiSheetMusic.Piano.BlackKeyWidth=Bridge.Int.div(MidiSheetMusic.Piano.WhiteKeyWidth,2)|0;MidiSheetMusic.Piano.BlackKeyHeight=Bridge.Int.div(Bridge.Int.mul(MidiSheetMusic.Piano.WhiteKeyHeight,5),9)|0;this.Width=(Bridge.Int.mul(MidiSheetMusic.Piano.margin,2)+Bridge.Int.mul(MidiSheetMusic.Piano.BlackBorder,2)|0)+Bridge.Int.mul(Bridge.Int.mul(MidiSheetMusic.Piano.WhiteKeyWidth,MidiSheetMusic.Piano.KeysPerOctave),MidiSheetMusic.Piano.MaxOctave)|0;this.Height=(Bridge.Int.mul(MidiSheetMusic.Piano.margin,2)+Bridge.Int.mul(MidiSheetMusic.Piano.BlackBorder,3)|0)+MidiSheetMusic.Piano.WhiteKeyHeight|0;MidiSheetMusic.Piano.blackKeyOffsets==null&&(MidiSheetMusic.Piano.blackKeyOffsets=System.Array.init([(MidiSheetMusic.Piano.WhiteKeyWidth-(Bridge.Int.div(MidiSheetMusic.Piano.BlackKeyWidth,2)|0)|0)-1|0,(MidiSheetMusic.Piano.WhiteKeyWidth+(Bridge.Int.div(MidiSheetMusic.Piano.BlackKeyWidth,2)|0)|0)-1|0,Bridge.Int.mul(2,MidiSheetMusic.Piano.WhiteKeyWidth)-(Bridge.Int.div(MidiSheetMusic.Piano.BlackKeyWidth,2)|0)|0,Bridge.Int.mul(2,MidiSheetMusic.Piano.WhiteKeyWidth)+(Bridge.Int.div(MidiSheetMusic.Piano.BlackKeyWidth,2)|0)|0,(Bridge.Int.mul(4,MidiSheetMusic.Piano.WhiteKeyWidth)-(Bridge.Int.div(MidiSheetMusic.Piano.BlackKeyWidth,2)|0)|0)-1|0,(Bridge.Int.mul(4,MidiSheetMusic.Piano.WhiteKeyWidth)+(Bridge.Int.div(MidiSheetMusic.Piano.BlackKeyWidth,2)|0)|0)-1|0,Bridge.Int.mul(5,MidiSheetMusic.Piano.WhiteKeyWidth)-(Bridge.Int.div(MidiSheetMusic.Piano.BlackKeyWidth,2)|0)|0,Bridge.Int.mul(5,MidiSheetMusic.Piano.WhiteKeyWidth)+(Bridge.Int.div(MidiSheetMusic.Piano.BlackKeyWidth,2)|0)|0,Bridge.Int.mul(6,MidiSheetMusic.Piano.WhiteKeyWidth)-(Bridge.Int.div(MidiSheetMusic.Piano.BlackKeyWidth,2)|0)|0,Bridge.Int.mul(6,MidiSheetMusic.Piano.WhiteKeyWidth)+(Bridge.Int.div(MidiSheetMusic.Piano.BlackKeyWidth,2)|0)|0],System.Int32));var gray1=MidiSheetMusic.Color.FromArgb(16,16,16),gray2=MidiSheetMusic.Color.FromArgb(90,90,90),gray3=MidiSheetMusic.Color.FromArgb(200,200,200),shade1=MidiSheetMusic.Color.FromArgb(210,205,220),shade2=MidiSheetMusic.Color.FromArgb(150,200,220);this.gray1Pen=new MidiSheetMusic.Pen(gray1,1);this.gray2Pen=new MidiSheetMusic.Pen(gray2,1);this.gray3Pen=new MidiSheetMusic.Pen(gray3,1);this.gray1Brush=new MidiSheetMusic.SolidBrush(gray1);this.gray2Brush=new MidiSheetMusic.SolidBrush(gray2);this.shadeBrush=new MidiSheetMusic.SolidBrush(shade1);this.shade2Brush=new MidiSheetMusic.SolidBrush(shade2);this.showNoteLetters=MidiSheetMusic.MidiOptions.NoteNameNone;this.BackColor=MidiSheetMusic.Color.LightGray}},methods:{SetMidiFile:function(midifile,options){var $t,tracks,track,tracknum,note;if(midifile==null){this.notes=null;this.useTwoColors=!1;return}for(tracks=midifile.ChangeMidiNotes(options),track=MidiSheetMusic.MidiFile.CombineToSingleTrack(tracks),this.notes=track.Notes,this.maxShadeDuration=Bridge.Int.mul(midifile.Time.Quarter,2),tracknum=0;tracknum<tracks.Count;tracknum=tracknum+1|0){$t=Bridge.getEnumerator(tracks.getItem(tracknum).Notes);try{while($t.moveNext())note=$t.Current,note.Channel=tracknum}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}}this.useTwoColors=!1;tracks.Count===2&&(this.useTwoColors=!0);this.showNoteLetters=options.showNoteLetters;this.Invalidate()},SetShadeColors:function(c1,c2){this.shadeBrush.Dispose();this.shade2Brush.Dispose();this.shadeBrush=new MidiSheetMusic.SolidBrush(c1);this.shade2Brush=new MidiSheetMusic.SolidBrush(c2)},DrawOctaveOutline:function(g){var right=Bridge.Int.mul(MidiSheetMusic.Piano.WhiteKeyWidth,MidiSheetMusic.Piano.KeysPerOctave),i,x1,x2,i1,pen1,pen2;for(g.DrawLine(this.gray1Pen,0,0,0,MidiSheetMusic.Piano.WhiteKeyHeight),g.DrawLine(this.gray1Pen,right,0,right,MidiSheetMusic.Piano.WhiteKeyHeight),g.DrawLine(this.gray1Pen,0,MidiSheetMusic.Piano.WhiteKeyHeight,right,MidiSheetMusic.Piano.WhiteKeyHeight),g.DrawLine(this.gray3Pen,right-1|0,0,right-1|0,MidiSheetMusic.Piano.WhiteKeyHeight),g.DrawLine(this.gray3Pen,1,0,1,MidiSheetMusic.Piano.WhiteKeyHeight),g.DrawLine(this.gray1Pen,Bridge.Int.mul(3,MidiSheetMusic.Piano.WhiteKeyWidth),0,Bridge.Int.mul(3,MidiSheetMusic.Piano.WhiteKeyWidth),MidiSheetMusic.Piano.WhiteKeyHeight),g.DrawLine(this.gray3Pen,Bridge.Int.mul(3,MidiSheetMusic.Piano.WhiteKeyWidth)-1|0,0,Bridge.Int.mul(3,MidiSheetMusic.Piano.WhiteKeyWidth)-1|0,MidiSheetMusic.Piano.WhiteKeyHeight),g.DrawLine(this.gray3Pen,Bridge.Int.mul(3,MidiSheetMusic.Piano.WhiteKeyWidth)+1|0,0,Bridge.Int.mul(3,MidiSheetMusic.Piano.WhiteKeyWidth)+1|0,MidiSheetMusic.Piano.WhiteKeyHeight),i=0;i<10;i=i+2|0)x1=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(i,MidiSheetMusic.Piano.blackKeyOffsets)],x2=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(i+1|0,MidiSheetMusic.Piano.blackKeyOffsets)],g.DrawLine(this.gray1Pen,x1,0,x1,MidiSheetMusic.Piano.BlackKeyHeight),g.DrawLine(this.gray1Pen,x2,0,x2,MidiSheetMusic.Piano.BlackKeyHeight),g.DrawLine(this.gray1Pen,x1,MidiSheetMusic.Piano.BlackKeyHeight,x2,MidiSheetMusic.Piano.BlackKeyHeight),g.DrawLine(this.gray2Pen,x1-1|0,0,x1-1|0,MidiSheetMusic.Piano.BlackKeyHeight+1|0),g.DrawLine(this.gray2Pen,x2+1|0,0,x2+1|0,MidiSheetMusic.Piano.BlackKeyHeight+1|0),g.DrawLine(this.gray2Pen,x1-1|0,MidiSheetMusic.Piano.BlackKeyHeight+1|0,x2+1|0,MidiSheetMusic.Piano.BlackKeyHeight+1|0),g.DrawLine(this.gray3Pen,x1-2|0,0,x1-2|0,MidiSheetMusic.Piano.BlackKeyHeight+2|0),g.DrawLine(this.gray3Pen,x2+2|0,0,x2+2|0,MidiSheetMusic.Piano.BlackKeyHeight+2|0),g.DrawLine(this.gray3Pen,x1-2|0,MidiSheetMusic.Piano.BlackKeyHeight+2|0,x2+2|0,MidiSheetMusic.Piano.BlackKeyHeight+2|0);for(i1=1;i1<MidiSheetMusic.Piano.KeysPerOctave;i1=i1+1|0)i1!==3&&(g.DrawLine(this.gray1Pen,Bridge.Int.mul(i1,MidiSheetMusic.Piano.WhiteKeyWidth),MidiSheetMusic.Piano.BlackKeyHeight,Bridge.Int.mul(i1,MidiSheetMusic.Piano.WhiteKeyWidth),MidiSheetMusic.Piano.WhiteKeyHeight),pen1=this.gray2Pen,pen2=this.gray3Pen,g.DrawLine(pen1,Bridge.Int.mul(i1,MidiSheetMusic.Piano.WhiteKeyWidth)-1|0,MidiSheetMusic.Piano.BlackKeyHeight+1|0,Bridge.Int.mul(i1,MidiSheetMusic.Piano.WhiteKeyWidth)-1|0,MidiSheetMusic.Piano.WhiteKeyHeight),g.DrawLine(pen2,Bridge.Int.mul(i1,MidiSheetMusic.Piano.WhiteKeyWidth)+1|0,MidiSheetMusic.Piano.BlackKeyHeight+1|0,Bridge.Int.mul(i1,MidiSheetMusic.Piano.WhiteKeyWidth)+1|0,MidiSheetMusic.Piano.WhiteKeyHeight))},DrawOutline:function(g){for(var octave=0;octave<MidiSheetMusic.Piano.MaxOctave;octave=octave+1|0)g.TranslateTransform(Bridge.Int.mul(Bridge.Int.mul(octave,MidiSheetMusic.Piano.WhiteKeyWidth),MidiSheetMusic.Piano.KeysPerOctave),0),this.DrawOctaveOutline(g),g.TranslateTransform(-Bridge.Int.mul(Bridge.Int.mul(octave,MidiSheetMusic.Piano.WhiteKeyWidth),MidiSheetMusic.Piano.KeysPerOctave)|0,0)},DrawBlackKeys:function(g){for(var i,x1,x2,octave=0;octave<MidiSheetMusic.Piano.MaxOctave;octave=octave+1|0){for(g.TranslateTransform(Bridge.Int.mul(Bridge.Int.mul(octave,MidiSheetMusic.Piano.WhiteKeyWidth),MidiSheetMusic.Piano.KeysPerOctave),0),i=0;i<10;i=i+2|0)x1=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(i,MidiSheetMusic.Piano.blackKeyOffsets)],x2=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(i+1|0,MidiSheetMusic.Piano.blackKeyOffsets)],g.FillRectangle(this.gray1Brush,x1,0,MidiSheetMusic.Piano.BlackKeyWidth,MidiSheetMusic.Piano.BlackKeyHeight),g.FillRectangle(this.gray2Brush,x1+1|0,MidiSheetMusic.Piano.BlackKeyHeight-(Bridge.Int.div(MidiSheetMusic.Piano.BlackKeyHeight,8)|0)|0,MidiSheetMusic.Piano.BlackKeyWidth-2|0,Bridge.Int.div(MidiSheetMusic.Piano.BlackKeyHeight,8)|0);g.TranslateTransform(-Bridge.Int.mul(Bridge.Int.mul(octave,MidiSheetMusic.Piano.WhiteKeyWidth),MidiSheetMusic.Piano.KeysPerOctave)|0,0)}},DrawBlackBorder:function(g){var PianoWidth=Bridge.Int.mul(Bridge.Int.mul(MidiSheetMusic.Piano.WhiteKeyWidth,MidiSheetMusic.Piano.KeysPerOctave),MidiSheetMusic.Piano.MaxOctave),i;for(g.FillRectangle(this.gray1Brush,MidiSheetMusic.Piano.margin,MidiSheetMusic.Piano.margin,PianoWidth+Bridge.Int.mul(MidiSheetMusic.Piano.BlackBorder,2)|0,MidiSheetMusic.Piano.BlackBorder-2|0),g.FillRectangle(this.gray1Brush,MidiSheetMusic.Piano.margin,MidiSheetMusic.Piano.margin,MidiSheetMusic.Piano.BlackBorder,MidiSheetMusic.Piano.WhiteKeyHeight+Bridge.Int.mul(MidiSheetMusic.Piano.BlackBorder,3)|0),g.FillRectangle(this.gray1Brush,MidiSheetMusic.Piano.margin,(MidiSheetMusic.Piano.margin+MidiSheetMusic.Piano.BlackBorder|0)+MidiSheetMusic.Piano.WhiteKeyHeight|0,Bridge.Int.mul(MidiSheetMusic.Piano.BlackBorder,2)+PianoWidth|0,Bridge.Int.mul(MidiSheetMusic.Piano.BlackBorder,2)),g.FillRectangle(this.gray1Brush,(MidiSheetMusic.Piano.margin+MidiSheetMusic.Piano.BlackBorder|0)+PianoWidth|0,MidiSheetMusic.Piano.margin,MidiSheetMusic.Piano.BlackBorder,MidiSheetMusic.Piano.WhiteKeyHeight+Bridge.Int.mul(MidiSheetMusic.Piano.BlackBorder,3)|0),g.DrawLine(this.gray2Pen,MidiSheetMusic.Piano.margin+MidiSheetMusic.Piano.BlackBorder|0,(MidiSheetMusic.Piano.margin+MidiSheetMusic.Piano.BlackBorder|0)-1|0,(MidiSheetMusic.Piano.margin+MidiSheetMusic.Piano.BlackBorder|0)+PianoWidth|0,(MidiSheetMusic.Piano.margin+MidiSheetMusic.Piano.BlackBorder|0)-1|0),g.TranslateTransform(MidiSheetMusic.Piano.margin+MidiSheetMusic.Piano.BlackBorder|0,MidiSheetMusic.Piano.margin+MidiSheetMusic.Piano.BlackBorder|0),i=0;i<49;i=i+1|0)g.FillRectangle(this.gray2Brush,Bridge.Int.mul(i,MidiSheetMusic.Piano.WhiteKeyWidth)+1|0,MidiSheetMusic.Piano.WhiteKeyHeight+2|0,MidiSheetMusic.Piano.WhiteKeyWidth-2|0,Bridge.Int.div(MidiSheetMusic.Piano.BlackBorder,2)|0);g.TranslateTransform(-(MidiSheetMusic.Piano.margin+MidiSheetMusic.Piano.BlackBorder|0)|0,-(MidiSheetMusic.Piano.margin+MidiSheetMusic.Piano.BlackBorder|0)|0)},DrawNoteLetters:function(g){var letters=System.Array.init(["C","D","E","F","G","A","B"],System.String),numbers=System.Array.init(["1","3","5","6","8","10","12"],System.String),names,octave,i;if(this.showNoteLetters===MidiSheetMusic.MidiOptions.NoteNameLetter)names=letters;else if(this.showNoteLetters===MidiSheetMusic.MidiOptions.NoteNameFixedNumber)names=numbers;else return;for(g.TranslateTransform(MidiSheetMusic.Piano.margin+MidiSheetMusic.Piano.BlackBorder|0,MidiSheetMusic.Piano.margin+MidiSheetMusic.Piano.BlackBorder|0),octave=0;octave<MidiSheetMusic.Piano.MaxOctave;octave=octave+1|0)for(i=0;i<MidiSheetMusic.Piano.KeysPerOctave;i=i+1|0)g.DrawString(names[System.Array.index(i,names)],MidiSheetMusic.SheetMusic.LetterFont,MidiSheetMusic.Brushes.White,Bridge.Int.mul(Bridge.Int.mul(octave,MidiSheetMusic.Piano.KeysPerOctave)+i|0,MidiSheetMusic.Piano.WhiteKeyWidth)+(Bridge.Int.div(MidiSheetMusic.Piano.WhiteKeyWidth,3)|0)|0,MidiSheetMusic.Piano.WhiteKeyHeight+(Bridge.Int.div(Bridge.Int.mul(MidiSheetMusic.Piano.BlackBorder,3),4)|0)|0);g.TranslateTransform(-(MidiSheetMusic.Piano.margin+MidiSheetMusic.Piano.BlackBorder|0)|0,-(MidiSheetMusic.Piano.margin+MidiSheetMusic.Piano.BlackBorder|0)|0)},OnPaint:function(e){var g=e.Graphics();g.SmoothingMode=MidiSheetMusic.SmoothingMode.None;g.TranslateTransform(MidiSheetMusic.Piano.margin+MidiSheetMusic.Piano.BlackBorder|0,MidiSheetMusic.Piano.margin+MidiSheetMusic.Piano.BlackBorder|0);g.FillRectangle(MidiSheetMusic.Brushes.White,0,0,Bridge.Int.mul(Bridge.Int.mul(MidiSheetMusic.Piano.WhiteKeyWidth,MidiSheetMusic.Piano.KeysPerOctave),MidiSheetMusic.Piano.MaxOctave),MidiSheetMusic.Piano.WhiteKeyHeight);this.DrawBlackKeys(g);this.DrawOutline(g);g.TranslateTransform(-(MidiSheetMusic.Piano.margin+MidiSheetMusic.Piano.BlackBorder|0)|0,-(MidiSheetMusic.Piano.margin+MidiSheetMusic.Piano.BlackBorder|0)|0);this.DrawBlackBorder(g);this.showNoteLetters!==MidiSheetMusic.MidiOptions.NoteNameNone&&this.DrawNoteLetters(g);g.SmoothingMode=MidiSheetMusic.SmoothingMode.AntiAlias},ShadeOneNote:function(g,notenumber,brush){var octave=Bridge.Int.div(notenumber,12)|0,notescale=notenumber%12,x1,x2,x3,bottomHalfHeight;if(octave=octave-2|0,!(octave<0)&&!(octave>=MidiSheetMusic.Piano.MaxOctave)){g.TranslateTransform(Bridge.Int.mul(Bridge.Int.mul(octave,MidiSheetMusic.Piano.WhiteKeyWidth),MidiSheetMusic.Piano.KeysPerOctave),0);bottomHalfHeight=MidiSheetMusic.Piano.WhiteKeyHeight-(MidiSheetMusic.Piano.BlackKeyHeight+3|0)|0;switch(notescale){case 0:x1=2;x2=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(0,MidiSheetMusic.Piano.blackKeyOffsets)]-2|0;g.FillRectangle(brush,x1,0,x2-x1|0,MidiSheetMusic.Piano.BlackKeyHeight+3|0);g.FillRectangle(brush,x1,MidiSheetMusic.Piano.BlackKeyHeight+3|0,MidiSheetMusic.Piano.WhiteKeyWidth-3|0,bottomHalfHeight);break;case 1:x1=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(0,MidiSheetMusic.Piano.blackKeyOffsets)];x2=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(1,MidiSheetMusic.Piano.blackKeyOffsets)];g.FillRectangle(brush,x1,0,x2-x1|0,MidiSheetMusic.Piano.BlackKeyHeight);Bridge.referenceEquals(brush,this.gray1Brush)&&g.FillRectangle(this.gray2Brush,x1+1|0,MidiSheetMusic.Piano.BlackKeyHeight-(Bridge.Int.div(MidiSheetMusic.Piano.BlackKeyHeight,8)|0)|0,MidiSheetMusic.Piano.BlackKeyWidth-2|0,Bridge.Int.div(MidiSheetMusic.Piano.BlackKeyHeight,8)|0);break;case 2:x1=MidiSheetMusic.Piano.WhiteKeyWidth+2|0;x2=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(1,MidiSheetMusic.Piano.blackKeyOffsets)]+3|0;x3=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(2,MidiSheetMusic.Piano.blackKeyOffsets)]-2|0;g.FillRectangle(brush,x2,0,x3-x2|0,MidiSheetMusic.Piano.BlackKeyHeight+3|0);g.FillRectangle(brush,x1,MidiSheetMusic.Piano.BlackKeyHeight+3|0,MidiSheetMusic.Piano.WhiteKeyWidth-3|0,bottomHalfHeight);break;case 3:x1=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(2,MidiSheetMusic.Piano.blackKeyOffsets)];x2=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(3,MidiSheetMusic.Piano.blackKeyOffsets)];g.FillRectangle(brush,x1,0,MidiSheetMusic.Piano.BlackKeyWidth,MidiSheetMusic.Piano.BlackKeyHeight);Bridge.referenceEquals(brush,this.gray1Brush)&&g.FillRectangle(this.gray2Brush,x1+1|0,MidiSheetMusic.Piano.BlackKeyHeight-(Bridge.Int.div(MidiSheetMusic.Piano.BlackKeyHeight,8)|0)|0,MidiSheetMusic.Piano.BlackKeyWidth-2|0,Bridge.Int.div(MidiSheetMusic.Piano.BlackKeyHeight,8)|0);break;case 4:x1=Bridge.Int.mul(MidiSheetMusic.Piano.WhiteKeyWidth,2)+2|0;x2=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(3,MidiSheetMusic.Piano.blackKeyOffsets)]+3|0;x3=Bridge.Int.mul(MidiSheetMusic.Piano.WhiteKeyWidth,3)-1|0;g.FillRectangle(brush,x2,0,x3-x2|0,MidiSheetMusic.Piano.BlackKeyHeight+3|0);g.FillRectangle(brush,x1,MidiSheetMusic.Piano.BlackKeyHeight+3|0,MidiSheetMusic.Piano.WhiteKeyWidth-3|0,bottomHalfHeight);break;case 5:x1=Bridge.Int.mul(MidiSheetMusic.Piano.WhiteKeyWidth,3)+2|0;x2=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(4,MidiSheetMusic.Piano.blackKeyOffsets)]-2|0;x3=Bridge.Int.mul(MidiSheetMusic.Piano.WhiteKeyWidth,4)-2|0;g.FillRectangle(brush,x1,0,x2-x1|0,MidiSheetMusic.Piano.BlackKeyHeight+3|0);g.FillRectangle(brush,x1,MidiSheetMusic.Piano.BlackKeyHeight+3|0,MidiSheetMusic.Piano.WhiteKeyWidth-3|0,bottomHalfHeight);break;case 6:x1=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(4,MidiSheetMusic.Piano.blackKeyOffsets)];x2=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(5,MidiSheetMusic.Piano.blackKeyOffsets)];g.FillRectangle(brush,x1,0,MidiSheetMusic.Piano.BlackKeyWidth,MidiSheetMusic.Piano.BlackKeyHeight);Bridge.referenceEquals(brush,this.gray1Brush)&&g.FillRectangle(this.gray2Brush,x1+1|0,MidiSheetMusic.Piano.BlackKeyHeight-(Bridge.Int.div(MidiSheetMusic.Piano.BlackKeyHeight,8)|0)|0,MidiSheetMusic.Piano.BlackKeyWidth-2|0,Bridge.Int.div(MidiSheetMusic.Piano.BlackKeyHeight,8)|0);break;case 7:x1=Bridge.Int.mul(MidiSheetMusic.Piano.WhiteKeyWidth,4)+2|0;x2=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(5,MidiSheetMusic.Piano.blackKeyOffsets)]+3|0;x3=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(6,MidiSheetMusic.Piano.blackKeyOffsets)]-2|0;g.FillRectangle(brush,x2,0,x3-x2|0,MidiSheetMusic.Piano.BlackKeyHeight+3|0);g.FillRectangle(brush,x1,MidiSheetMusic.Piano.BlackKeyHeight+3|0,MidiSheetMusic.Piano.WhiteKeyWidth-3|0,bottomHalfHeight);break;case 8:x1=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(6,MidiSheetMusic.Piano.blackKeyOffsets)];x2=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(7,MidiSheetMusic.Piano.blackKeyOffsets)];g.FillRectangle(brush,x1,0,MidiSheetMusic.Piano.BlackKeyWidth,MidiSheetMusic.Piano.BlackKeyHeight);Bridge.referenceEquals(brush,this.gray1Brush)&&g.FillRectangle(this.gray2Brush,x1+1|0,MidiSheetMusic.Piano.BlackKeyHeight-(Bridge.Int.div(MidiSheetMusic.Piano.BlackKeyHeight,8)|0)|0,MidiSheetMusic.Piano.BlackKeyWidth-2|0,Bridge.Int.div(MidiSheetMusic.Piano.BlackKeyHeight,8)|0);break;case 9:x1=Bridge.Int.mul(MidiSheetMusic.Piano.WhiteKeyWidth,5)+2|0;x2=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(7,MidiSheetMusic.Piano.blackKeyOffsets)]+3|0;x3=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(8,MidiSheetMusic.Piano.blackKeyOffsets)]-2|0;g.FillRectangle(brush,x2,0,x3-x2|0,MidiSheetMusic.Piano.BlackKeyHeight+3|0);g.FillRectangle(brush,x1,MidiSheetMusic.Piano.BlackKeyHeight+3|0,MidiSheetMusic.Piano.WhiteKeyWidth-3|0,bottomHalfHeight);break;case 10:x1=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(8,MidiSheetMusic.Piano.blackKeyOffsets)];x2=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(9,MidiSheetMusic.Piano.blackKeyOffsets)];g.FillRectangle(brush,x1,0,MidiSheetMusic.Piano.BlackKeyWidth,MidiSheetMusic.Piano.BlackKeyHeight);Bridge.referenceEquals(brush,this.gray1Brush)&&g.FillRectangle(this.gray2Brush,x1+1|0,MidiSheetMusic.Piano.BlackKeyHeight-(Bridge.Int.div(MidiSheetMusic.Piano.BlackKeyHeight,8)|0)|0,MidiSheetMusic.Piano.BlackKeyWidth-2|0,Bridge.Int.div(MidiSheetMusic.Piano.BlackKeyHeight,8)|0);break;case 11:x1=Bridge.Int.mul(MidiSheetMusic.Piano.WhiteKeyWidth,6)+2|0;x2=MidiSheetMusic.Piano.blackKeyOffsets[System.Array.index(9,MidiSheetMusic.Piano.blackKeyOffsets)]+3|0;x3=Bridge.Int.mul(MidiSheetMusic.Piano.WhiteKeyWidth,MidiSheetMusic.Piano.KeysPerOctave)-1|0;g.FillRectangle(brush,x2,0,x3-x2|0,MidiSheetMusic.Piano.BlackKeyHeight+3|0);g.FillRectangle(brush,x1,MidiSheetMusic.Piano.BlackKeyHeight+3|0,MidiSheetMusic.Piano.WhiteKeyWidth-3|0,bottomHalfHeight)}g.TranslateTransform(-Bridge.Int.mul(Bridge.Int.mul(octave,MidiSheetMusic.Piano.WhiteKeyWidth),MidiSheetMusic.Piano.KeysPerOctave)|0,0)}},FindClosestStartTime:function(pulseTime){for(var left=0,right=this.notes.Count-1|0,i;(right-left|0)>1;)if(i=Bridge.Int.div(right+left|0,2)|0,this.notes.getItem(left).StartTime===pulseTime)break;else this.notes.getItem(i).StartTime<=pulseTime?left=i:right=i;while(left>=1&&this.notes.getItem(left-1|0).StartTime===this.notes.getItem(left).StartTime)left=left-1|0;return left},NextStartTimeSameTrack:function(i){for(var start=this.notes.getItem(i).StartTime,end=this.notes.getItem(i).EndTime,track=this.notes.getItem(i).Channel;i<this.notes.Count;){if(this.notes.getItem(i).Channel!==track){i=i+1|0;continue}if(this.notes.getItem(i).StartTime>start)return this.notes.getItem(i).StartTime;end=Math.max(end,this.notes.getItem(i).EndTime);i=i+1|0}return end},NextStartTime:function(i){for(var start=this.notes.getItem(i).StartTime,end=this.notes.getItem(i).EndTime;i<this.notes.Count;){if(this.notes.getItem(i).StartTime>start)return this.notes.getItem(i).StartTime;end=Math.max(end,this.notes.getItem(i).EndTime);i=i+1|0}return end},ShadeNotes:function(currentPulseTime,prevPulseTime){var lastShadedIndex,i,num;if(this.notes!=null&&this.notes.Count!==0){for(this.graphics==null&&(this.graphics=this.CreateGraphics("shadeNotes_piano")),this.graphics.SmoothingMode=MidiSheetMusic.SmoothingMode.None,this.graphics.TranslateTransform(MidiSheetMusic.Piano.margin+MidiSheetMusic.Piano.BlackBorder|0,MidiSheetMusic.Piano.margin+MidiSheetMusic.Piano.BlackBorder|0),lastShadedIndex=this.FindClosestStartTime(prevPulseTime-Bridge.Int.mul(this.maxShadeDuration,2)|0),i=lastShadedIndex;i<this.notes.Count;i=i+1|0){var start=this.notes.getItem(i).StartTime,end=this.notes.getItem(i).EndTime,notenumber=this.notes.getItem(i).Number,nextStart=this.NextStartTime(i),nextStartTrack=this.NextStartTimeSameTrack(i);if(end=Math.max(end,nextStartTrack),end=Math.min(end,(start+this.maxShadeDuration|0)-1|0),start>prevPulseTime&&start>currentPulseTime)break;if(start<=currentPulseTime&&currentPulseTime<nextStart&&currentPulseTime<end&&start<=prevPulseTime&&prevPulseTime<nextStart&&prevPulseTime<end)break;start<=currentPulseTime&&currentPulseTime<end?this.useTwoColors?this.notes.getItem(i).Channel===1?this.ShadeOneNote(this.graphics,notenumber,this.shade2Brush):this.ShadeOneNote(this.graphics,notenumber,this.shadeBrush):this.ShadeOneNote(this.graphics,notenumber,this.shadeBrush):start<=prevPulseTime&&prevPulseTime<end&&(num=notenumber%12,num===1||num===3||num===6||num===8||num===10?this.ShadeOneNote(this.graphics,notenumber,this.gray1Brush):this.ShadeOneNote(this.graphics,notenumber,MidiSheetMusic.Brushes.White))}this.graphics.TranslateTransform(-(MidiSheetMusic.Piano.margin+MidiSheetMusic.Piano.BlackBorder|0)|0,-(MidiSheetMusic.Piano.margin+MidiSheetMusic.Piano.BlackBorder|0)|0);this.graphics.SmoothingMode=MidiSheetMusic.SmoothingMode.AntiAlias}}}});Bridge.define("MidiSheetMusic.RestSymbol",{inherits:[MidiSheetMusic.MusicSymbol],fields:{starttime:0,duration:0,width:0},props:{StartTime:{get:function(){return this.starttime}},Width:{get:function(){return this.width},set:function(value){this.width=value}},MinWidth:{get:function(){return Bridge.Int.mul(2,MidiSheetMusic.SheetMusic.NoteHeight)+(Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteHeight,2)|0)|0}},AboveStaff:{get:function(){return 0}},BelowStaff:{get:function(){return 0}}},ctors:{ctor:function(start,dur){this.$initialize();MidiSheetMusic.MusicSymbol.ctor.call(this);this.starttime=start;this.duration=dur;this.width=this.MinWidth}},methods:{Draw:function(g,pen,ytop){g.TranslateTransform(this.Width-this.MinWidth|0,0);g.TranslateTransform(Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteHeight,2)|0,0);this.duration===MidiSheetMusic.NoteDuration.Whole?this.DrawWhole(g,pen,ytop):this.duration===MidiSheetMusic.NoteDuration.Half?this.DrawHalf(g,pen,ytop):this.duration===MidiSheetMusic.NoteDuration.Quarter?this.DrawQuarter(g,pen,ytop):this.duration===MidiSheetMusic.NoteDuration.Eighth&&this.DrawEighth(g,pen,ytop);g.TranslateTransform(Bridge.Int.div(-MidiSheetMusic.SheetMusic.NoteHeight|0,2)|0,0);g.TranslateTransform(-(this.Width-this.MinWidth|0)|0,0)},DrawWhole:function(g,pen,ytop){var y=ytop+MidiSheetMusic.SheetMusic.NoteHeight|0;g.FillRectangle(MidiSheetMusic.Brushes.Black,0,y,MidiSheetMusic.SheetMusic.NoteWidth,Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteHeight,2)|0)},DrawHalf:function(g,pen,ytop){var y=(ytop+MidiSheetMusic.SheetMusic.NoteHeight|0)+(Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteHeight,2)|0)|0;g.FillRectangle(MidiSheetMusic.Brushes.Black,0,y,MidiSheetMusic.SheetMusic.NoteWidth,Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteHeight,2)|0)},DrawQuarter:function(g,pen,ytop){pen.EndCap=MidiSheetMusic.LineCap.Flat;var y=ytop+(Bridge.Int.div(MidiSheetMusic.SheetMusic.NoteHeight,2)|0)|0,x=2,xend=x+(Bridge.Int.div(Bridge.Int.mul(2,MidiSheetMusic.SheetMusic.NoteHeight),3)|0)|0;pen.Width=1;g.DrawLine(pen,x,y,xend-1|0,(y+MidiSheetMusic.SheetMusic.NoteHeight|0)-1|0);pen.Width=Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,2)|0;y=(ytop+MidiSheetMusic.SheetMusic.NoteHeight|0)+1|0;g.DrawLine(pen,xend-2|0,y,x,y+MidiSheetMusic.SheetMusic.NoteHeight|0);pen.Width=1;y=(ytop+Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,2)|0)-1|0;g.DrawLine(pen,0,y,xend+2|0,y+MidiSheetMusic.SheetMusic.NoteHeight|0);pen.Width=Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,2)|0;MidiSheetMusic.SheetMusic.NoteHeight===6?g.DrawLine(pen,xend,(y+1|0)+(Bridge.Int.div(Bridge.Int.mul(3,MidiSheetMusic.SheetMusic.NoteHeight),4)|0)|0,Bridge.Int.div(x,2)|0,(y+1|0)+(Bridge.Int.div(Bridge.Int.mul(3,MidiSheetMusic.SheetMusic.NoteHeight),4)|0)|0):g.DrawLine(pen,xend,y+(Bridge.Int.div(Bridge.Int.mul(3,MidiSheetMusic.SheetMusic.NoteHeight),4)|0)|0,Bridge.Int.div(x,2)|0,y+(Bridge.Int.div(Bridge.Int.mul(3,MidiSheetMusic.SheetMusic.NoteHeight),4)|0)|0);pen.Width=1;g.DrawLine(pen,0,(y+(Bridge.Int.div(Bridge.Int.mul(2,MidiSheetMusic.SheetMusic.NoteHeight),3)|0)|0)+1|0,xend-1|0,y+(Bridge.Int.div(Bridge.Int.mul(3,MidiSheetMusic.SheetMusic.NoteHeight),2)|0)|0)},DrawEighth:function(g,pen,ytop){var y=(ytop+MidiSheetMusic.SheetMusic.NoteHeight|0)-1|0;g.FillEllipse(MidiSheetMusic.Brushes.Black,0,y+1|0,MidiSheetMusic.SheetMusic.LineSpace-1|0,MidiSheetMusic.SheetMusic.LineSpace-1|0);pen.Width=1;g.DrawLine(pen,Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace-2|0,2)|0,(y+MidiSheetMusic.SheetMusic.LineSpace|0)-1|0,Bridge.Int.div(Bridge.Int.mul(3,MidiSheetMusic.SheetMusic.LineSpace),2)|0,y+(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,2)|0)|0);g.DrawLine(pen,Bridge.Int.div(Bridge.Int.mul(3,MidiSheetMusic.SheetMusic.LineSpace),2)|0,y+(Bridge.Int.div(MidiSheetMusic.SheetMusic.LineSpace,2)|0)|0,Bridge.Int.div(Bridge.Int.mul(3,MidiSheetMusic.SheetMusic.LineSpace),4)|0,y+Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,2)|0)},toString:function(){return System.String.format("RestSymbol starttime={0} duration={1} width={2}",Bridge.box(this.starttime,System.Int32),Bridge.box(this.duration,MidiSheetMusic.NoteDuration,System.Enum.toStringFn(MidiSheetMusic.NoteDuration)),Bridge.box(this.width,System.Int32))}}});Bridge.define("MidiSheetMusic.SheetMusic",{inherits:[MidiSheetMusic.Control],statics:{fields:{LineWidth:0,LeftMargin:0,TitleHeight:0,LineSpace:0,StaffHeight:0,NoteHeight:0,NoteWidth:0,PageWidth:0,PageHeight:0,LetterFont:null},ctors:{init:function(){this.LineWidth=1;this.LeftMargin=4;this.TitleHeight=14;this.PageWidth=800;this.PageHeight=1050},ctor:function(){MidiSheetMusic.SheetMusic.SetNoteSize(!1)}},methods:{IsChord:function(symbol){return Bridge.is(symbol,MidiSheetMusic.ChordSymbol)},FindConsecutiveChords:function(symbols,time,startIndex,chordIndexes,horizDistance){for(var i=startIndex,numChords=chordIndexes.length,c,foundChords,chordIndex,remaining;;){for(horizDistance.v=0;i<(symbols.Count-numChords|0);){if(Bridge.is(symbols.getItem(i),MidiSheetMusic.ChordSymbol)&&(c=Bridge.cast(symbols.getItem(i),MidiSheetMusic.ChordSymbol),c.Stem!=null))break;i=i+1|0}if(i>=(symbols.Count-numChords|0))return chordIndexes[System.Array.index(0,chordIndexes)]=-1,!1;for(chordIndexes[System.Array.index(0,chordIndexes)]=i,foundChords=!0,chordIndex=1;chordIndex<numChords;chordIndex=chordIndex+1|0){for(i=i+1|0,remaining=(numChords-1|0)-chordIndex|0;i<(symbols.Count-remaining|0)&&Bridge.is(symbols.getItem(i),MidiSheetMusic.BlankSymbol);)horizDistance.v=horizDistance.v+symbols.getItem(i).Width|0,i=i+1|0;if(i>=(symbols.Count-remaining|0))return!1;if(!Bridge.is(symbols.getItem(i),MidiSheetMusic.ChordSymbol)){foundChords=!1;break}chordIndexes[System.Array.index(chordIndex,chordIndexes)]=i;horizDistance.v=horizDistance.v+symbols.getItem(i).Width|0}if(foundChords)return!0}},CreateBeamedChords:function(allsymbols,time,numChords,startBeat){var $t,chordIndexes=System.Array.init(numChords,0,System.Int32),chords=System.Array.init(numChords,null,MidiSheetMusic.ChordSymbol),symbols,startIndex,horizDistance,found,i;$t=Bridge.getEnumerator(allsymbols);try{while($t.moveNext())for(symbols=$t.Current,startIndex=0;;){if(horizDistance={v:0},found=MidiSheetMusic.SheetMusic.FindConsecutiveChords(symbols,time,startIndex,chordIndexes,horizDistance),!found)break;for(i=0;i<numChords;i=i+1|0)chords[System.Array.index(i,chords)]=Bridge.cast(symbols.getItem(chordIndexes[System.Array.index(i,chordIndexes)]),MidiSheetMusic.ChordSymbol);MidiSheetMusic.ChordSymbol.CanCreateBeam(chords,time,startBeat)?(MidiSheetMusic.ChordSymbol.CreateBeam(chords,horizDistance.v),startIndex=chordIndexes[System.Array.index(numChords-1|0,chordIndexes)]+1|0):startIndex=chordIndexes[System.Array.index(0,chordIndexes)]+1|0}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}},CreateAllBeamedChords:function(allsymbols,time){(time.Numerator===3&&time.Denominator===4||time.Numerator===6&&time.Denominator===8||time.Numerator===6&&time.Denominator===4)&&MidiSheetMusic.SheetMusic.CreateBeamedChords(allsymbols,time,6,!0);MidiSheetMusic.SheetMusic.CreateBeamedChords(allsymbols,time,3,!0);MidiSheetMusic.SheetMusic.CreateBeamedChords(allsymbols,time,4,!0);MidiSheetMusic.SheetMusic.CreateBeamedChords(allsymbols,time,2,!0);MidiSheetMusic.SheetMusic.CreateBeamedChords(allsymbols,time,2,!1)},KeySignatureWidth:function(key){var $t,clefsym=new MidiSheetMusic.ClefSymbol(MidiSheetMusic.Clef.Treble,0,!1),result=clefsym.MinWidth,keys=key.GetSymbols(MidiSheetMusic.Clef.Treble),symbol;$t=Bridge.getEnumerator(keys);try{while($t.moveNext())symbol=$t.Current,result=result+symbol.MinWidth|0}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return(result+MidiSheetMusic.SheetMusic.LeftMargin|0)+5|0},GetLyrics:function(tracks){for(var track,$t,hasLyrics=!1,result=System.Array.init(tracks.Count,null,System.Collections.Generic.List$1(MidiSheetMusic.LyricSymbol)),tracknum=0;tracknum<tracks.Count;tracknum=tracknum+1|0)if(track=tracks.getItem(tracknum),track.Lyrics!=null){hasLyrics=!0;result[System.Array.index(tracknum,result)]=new(System.Collections.Generic.List$1(MidiSheetMusic.LyricSymbol).ctor);$t=Bridge.getEnumerator(track.Lyrics);try{while($t.moveNext()){var ev=$t.Current,text=System.Text.Encoding.UTF8.GetString$1(ev.Value,0,ev.Value.length),sym=new MidiSheetMusic.LyricSymbol(ev.StartTime,text);result[System.Array.index(tracknum,result)].add(sym)}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}}return hasLyrics?result:null},AddLyricsToStaffs:function(staffs,tracklyrics){var $t,staff,lyrics;$t=Bridge.getEnumerator(staffs);try{while($t.moveNext())staff=$t.Current,lyrics=tracklyrics[System.Array.index(staff.Track,tracklyrics)],staff.AddLyrics(lyrics)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}},SetNoteSize:function(largenotes){MidiSheetMusic.SheetMusic.LineSpace=largenotes?7:5;MidiSheetMusic.SheetMusic.StaffHeight=Bridge.Int.mul(MidiSheetMusic.SheetMusic.LineSpace,4)+5|0;MidiSheetMusic.SheetMusic.NoteHeight=MidiSheetMusic.SheetMusic.LineSpace+MidiSheetMusic.SheetMusic.LineWidth|0;MidiSheetMusic.SheetMusic.NoteWidth=Bridge.Int.div(Bridge.Int.mul(3,MidiSheetMusic.SheetMusic.LineSpace),2)|0;MidiSheetMusic.SheetMusic.LetterFont=new MidiSheetMusic.Font("Arial",8,MidiSheetMusic.FontStyle.Regular)}}},fields:{staffs:null,mainkey:null,numtracks:0,zoom:0,scrollVert:!1,filename:null,showNoteLetters:0,NoteColors:null,shadeBrush:null,shade2Brush:null,deselectedShadeBrush:null,pen:null,SelectionStartPulse:0,SelectionEndPulse:0},props:{ShadeBrush:{get:function(){return this.shadeBrush}},Shade2Brush:{get:function(){return this.shade2Brush}},ShowNoteLetters:{get:function(){return this.showNoteLetters}},MainKey:{get:function(){return this.mainkey}}},ctors:{init:function(){this.deselectedShadeBrush=new MidiSheetMusic.SolidBrush(MidiSheetMusic.Color.LightGray)},ctor:function(file,options){this.$initialize();MidiSheetMusic.Control.ctor.call(this);this.init(file,options)},$ctor1:function(data,title,options){this.$initialize();MidiSheetMusic.Control.ctor.call(this);var file=new MidiSheetMusic.MidiFile(data,title);this.init(file,options)}},methods:{init:function(file,options){var $t,tracks,time,lastStart,symbols,tracknum,lyrics,widths,staff;for(options==null&&(options=new MidiSheetMusic.MidiOptions.$ctor1(file)),this.zoom=1,this.filename=file.FileName,this.SetColors(options.colors,options.shadeColor,options.shade2Color),this.pen=new MidiSheetMusic.Pen(MidiSheetMusic.Color.Black,1),tracks=file.ChangeMidiNotes(options),MidiSheetMusic.SheetMusic.SetNoteSize(options.largeNoteSize),this.scrollVert=options.scrollVert,this.showNoteLetters=options.showNoteLetters,time=file.Time,options.time!=null&&(time=options.time),this.mainkey=options.key===-1?this.GetKeySignature(tracks):new MidiSheetMusic.KeySignature.ctor(options.key),this.numtracks=tracks.Count,lastStart=file.EndTime()+options.shifttime|0,symbols=System.Array.init(this.numtracks,null,System.Collections.Generic.List$1(MidiSheetMusic.MusicSymbol)),tracknum=0;tracknum<this.numtracks;tracknum=tracknum+1|0){var track=tracks.getItem(tracknum),clefs=new MidiSheetMusic.ClefMeasures(track.Notes,time.Measure),chords=this.CreateChords(track.Notes,this.mainkey,time,clefs);symbols[System.Array.index(tracknum,symbols)]=this.CreateSymbols(chords,clefs,time,lastStart)}lyrics=null;options.showLyrics&&(lyrics=MidiSheetMusic.SheetMusic.GetLyrics(tracks));widths=new MidiSheetMusic.SymbolWidths(symbols,lyrics);this.AlignSymbols(symbols,widths,options);this.staffs=this.CreateStaffs(symbols,this.mainkey,options,time.Measure);MidiSheetMusic.SheetMusic.CreateAllBeamedChords(symbols,time);lyrics!=null&&MidiSheetMusic.SheetMusic.AddLyricsToStaffs(this.staffs,lyrics);$t=Bridge.getEnumerator(this.staffs);try{while($t.moveNext())staff=$t.Current,staff.CalculateHeight()}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}this.BackColor=MidiSheetMusic.Color.White;this.SetZoom(1)},GetKeySignature:function(tracks){var $t,$t1,notenums=new(System.Collections.Generic.List$1(System.Int32).ctor),track,note;$t=Bridge.getEnumerator(tracks);try{while($t.moveNext()){track=$t.Current;$t1=Bridge.getEnumerator(track.Notes);try{while($t1.moveNext())note=$t1.Current,notenums.add(note.Number)}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$dispose()}}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return MidiSheetMusic.KeySignature.Guess(notenums)},CreateChords:function(midinotes,key,time,clefs){for(var i=0,chords=new(System.Collections.Generic.List$1(MidiSheetMusic.ChordSymbol).ctor),notegroup=new(System.Collections.Generic.List$1(MidiSheetMusic.MidiNote).$ctor2)(12),len=midinotes.Count,starttime,clef,chord;i<len;){for(starttime=midinotes.getItem(i).StartTime,clef=clefs.GetClef(starttime),notegroup.clear(),notegroup.add(midinotes.getItem(i)),i=i+1|0;i<len&&midinotes.getItem(i).StartTime===starttime;)notegroup.add(midinotes.getItem(i)),i=i+1|0;chord=new MidiSheetMusic.ChordSymbol(notegroup,key,time,clef,this);chords.add(chord)}return chords},CreateSymbols:function(chords,clefs,time,lastStart){var symbols=new(System.Collections.Generic.List$1(MidiSheetMusic.MusicSymbol).ctor);return symbols=this.AddBars(chords,time,lastStart),symbols=this.AddRests(symbols,time),this.AddClefChanges(symbols,clefs,time)},AddBars:function(chords,time,lastStart){var symbols=new(System.Collections.Generic.List$1(MidiSheetMusic.MusicSymbol).ctor),timesig=new MidiSheetMusic.TimeSigSymbol(time.Numerator,time.Denominator),measuretime,i;for(symbols.add(timesig),measuretime=0,i=0;i<chords.Count;)measuretime<=chords.getItem(i).StartTime?(symbols.add(new MidiSheetMusic.BarSymbol(measuretime)),measuretime=measuretime+time.Measure|0):(symbols.add(chords.getItem(i)),i=i+1|0);while(measuretime<lastStart)symbols.add(new MidiSheetMusic.BarSymbol(measuretime)),measuretime=measuretime+time.Measure|0;return symbols.add(new MidiSheetMusic.BarSymbol(measuretime)),symbols},AddRests:function(symbols,time){var $t,$t1,prevtime=0,result=new(System.Collections.Generic.List$1(MidiSheetMusic.MusicSymbol).$ctor2)(symbols.Count),r,chord;$t=Bridge.getEnumerator(symbols);try{while($t.moveNext()){var symbol=$t.Current,starttime=symbol.StartTime,rests=this.GetRests(time,prevtime,starttime);if(rests!=null){$t1=Bridge.getEnumerator(rests);try{while($t1.moveNext())r=$t1.Current,result.add(r)}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$dispose()}}result.add(symbol);Bridge.is(symbol,MidiSheetMusic.ChordSymbol)?(chord=Bridge.cast(symbol,MidiSheetMusic.ChordSymbol),prevtime=Math.max(chord.EndTime,prevtime)):prevtime=Math.max(starttime,prevtime)}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return result},GetRests:function(time,start,end){var r1,r2,dur;if((end-start|0)<0)return null;dur=time.GetNoteDuration(end-start|0);switch(dur){case MidiSheetMusic.NoteDuration.Whole:case MidiSheetMusic.NoteDuration.Half:case MidiSheetMusic.NoteDuration.Quarter:case MidiSheetMusic.NoteDuration.Eighth:return r1=new MidiSheetMusic.RestSymbol(start,dur),System.Array.init([r1],MidiSheetMusic.RestSymbol);case MidiSheetMusic.NoteDuration.DottedHalf:return r1=new MidiSheetMusic.RestSymbol(start,MidiSheetMusic.NoteDuration.Half),r2=new MidiSheetMusic.RestSymbol(start+Bridge.Int.mul(time.Quarter,2)|0,MidiSheetMusic.NoteDuration.Quarter),System.Array.init([r1,r2],MidiSheetMusic.RestSymbol);case MidiSheetMusic.NoteDuration.DottedQuarter:return r1=new MidiSheetMusic.RestSymbol(start,MidiSheetMusic.NoteDuration.Quarter),r2=new MidiSheetMusic.RestSymbol(start+time.Quarter|0,MidiSheetMusic.NoteDuration.Eighth),System.Array.init([r1,r2],MidiSheetMusic.RestSymbol);case MidiSheetMusic.NoteDuration.DottedEighth:return r1=new MidiSheetMusic.RestSymbol(start,MidiSheetMusic.NoteDuration.Eighth),r2=new MidiSheetMusic.RestSymbol(start+(Bridge.Int.div(time.Quarter,2)|0)|0,MidiSheetMusic.NoteDuration.Sixteenth),System.Array.init([r1,r2],MidiSheetMusic.RestSymbol);default:return null}},AddClefChanges:function(symbols,clefs){var $t,result=new(System.Collections.Generic.List$1(MidiSheetMusic.MusicSymbol).$ctor2)(symbols.Count),prevclef=clefs.GetClef(0),symbol,clef;$t=Bridge.getEnumerator(symbols);try{while($t.moveNext())symbol=$t.Current,Bridge.is(symbol,MidiSheetMusic.BarSymbol)&&(clef=clefs.GetClef(symbol.StartTime),clef!==prevclef&&result.add(new MidiSheetMusic.ClefSymbol(clef,symbol.StartTime-1|0,!0)),prevclef=clef),result.add(symbol)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return result},AlignSymbols:function(allsymbols,widths,options){var $t,$t1,track,symbols,sym,track1,start,start1,extra;if(options.showMeasures)for(track=0;track<allsymbols.length;track=track+1|0){symbols=allsymbols[System.Array.index(track,allsymbols)];$t=Bridge.getEnumerator(symbols);try{while($t.moveNext())sym=$t.Current,Bridge.is(sym,MidiSheetMusic.BarSymbol)&&(sym.Width=sym.Width+MidiSheetMusic.SheetMusic.NoteWidth|0)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}}for(track1=0;track1<allsymbols.length;track1=track1+1|0){var symbols1=allsymbols[System.Array.index(track1,allsymbols)],result=new(System.Collections.Generic.List$1(MidiSheetMusic.MusicSymbol).ctor),i=0;$t1=Bridge.getEnumerator(widths.StartTimes);try{while($t1.moveNext()){for(start=$t1.Current;i<symbols1.Count&&Bridge.is(symbols1.getItem(i),MidiSheetMusic.BarSymbol)&&symbols1.getItem(i).StartTime<=start;)result.add(symbols1.getItem(i)),i=i+1|0;if(i<symbols1.Count&&symbols1.getItem(i).StartTime===start)while(i<symbols1.Count&&symbols1.getItem(i).StartTime===start)result.add(symbols1.getItem(i)),i=i+1|0;else result.add(new MidiSheetMusic.BlankSymbol(start,0))}}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$dispose()}for(i=0;i<result.Count;){if(Bridge.is(result.getItem(i),MidiSheetMusic.BarSymbol)){i=i+1|0;continue}for(start1=result.getItem(i).StartTime,extra=widths.GetExtraWidth(track1,start1),result.getItem(i).Width=result.getItem(i).Width+extra|0;i<result.Count&&result.getItem(i).StartTime===start1;)i=i+1|0}allsymbols[System.Array.index(track1,allsymbols)]=result}},CreateStaffsForTrack:function(symbols,measurelen,key,options,track,totaltracks){for(var keysigWidth=MidiSheetMusic.SheetMusic.KeySignatureWidth(key),startindex=0,thestaffs=new(System.Collections.Generic.List$1(MidiSheetMusic.Staff).$ctor2)(Bridge.Int.div(symbols.Count,50)|0),endindex,width,maxwidth,endmeasure,range,staff;startindex<symbols.Count;){for(endindex=startindex,width=keysigWidth,maxwidth=this.scrollVert?MidiSheetMusic.SheetMusic.PageWidth:2e6;endindex<symbols.Count&&(width+symbols.getItem(endindex).Width|0)<maxwidth;)width=width+symbols.getItem(endindex).Width|0,endindex=endindex+1|0;if(endindex=endindex-1|0,endindex!==(symbols.Count-1|0)&&(Bridge.Int.div(symbols.getItem(startindex).StartTime,measurelen)|0)!=(Bridge.Int.div(symbols.getItem(endindex).StartTime,measurelen)|0))for(endmeasure=Bridge.Int.div(symbols.getItem(endindex+1|0).StartTime,measurelen)|0;(Bridge.Int.div(symbols.getItem(endindex).StartTime,measurelen)|0)===endmeasure;)endindex=endindex-1|0;range=(endindex+1|0)-startindex|0;this.scrollVert&&(width=MidiSheetMusic.SheetMusic.PageWidth);staff=new MidiSheetMusic.Staff(symbols.getRange(startindex,range),key,options,track,totaltracks);thestaffs.add(staff);startindex=endindex+1|0}return thestaffs},CreateStaffs:function(allsymbols,key,options,measurelen){for(var symbols,list,i,maxstaffs,i1,result,i2,list1,$t,$t1,trackstaffs=System.Array.init(allsymbols.length,null,System.Collections.Generic.List$1(MidiSheetMusic.Staff)),totaltracks=trackstaffs.length,track=0;track<totaltracks;track=track+1|0)symbols=allsymbols[System.Array.index(track,allsymbols)],trackstaffs[System.Array.index(track,trackstaffs)]=this.CreateStaffsForTrack(symbols,measurelen,key,options,track,totaltracks);$t=Bridge.getEnumerator(trackstaffs);try{while($t.moveNext())for(list=$t.Current,i=0;i<(list.Count-1|0);i=i+1|0)list.getItem(i).EndTime=list.getItem(i+1|0).StartTime}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}for(maxstaffs=0,i1=0;i1<trackstaffs.length;i1=i1+1|0)maxstaffs<trackstaffs[System.Array.index(i1,trackstaffs)].Count&&(maxstaffs=trackstaffs[System.Array.index(i1,trackstaffs)].Count);for(result=new(System.Collections.Generic.List$1(MidiSheetMusic.Staff).$ctor2)(Bridge.Int.mul(maxstaffs,trackstaffs.length)),i2=0;i2<maxstaffs;i2=i2+1|0){$t1=Bridge.getEnumerator(trackstaffs);try{while($t1.moveNext())list1=$t1.Current,i2<list1.Count&&result.add(list1.getItem(i2))}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$dispose()}}return result},SetZoom:function(value){var $t,width,height,staff;this.zoom=value;width=0;height=0;$t=Bridge.getEnumerator(this.staffs);try{while($t.moveNext())staff=$t.Current,width=Math.max(width,staff.Width*this.zoom),height+=staff.Height*this.zoom}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}this.Width=Bridge.Int.clip32(width+2);this.Height=Bridge.Int.clip32(height)+MidiSheetMusic.SheetMusic.LeftMargin|0;this.Invalidate()},SetColors:function(newcolors,newshade,newshade2){var i,i1,i2;if(this.NoteColors==null)for(this.NoteColors=System.Array.init(12,null,MidiSheetMusic.Color),i=0;i<12;i=i+1|0)this.NoteColors[System.Array.index(i,this.NoteColors)]=MidiSheetMusic.Color.Black;if(newcolors!=null)for(i1=0;i1<12;i1=i1+1|0)this.NoteColors[System.Array.index(i1,this.NoteColors)]=newcolors[System.Array.index(i1,newcolors)];else for(i2=0;i2<12;i2=i2+1|0)this.NoteColors[System.Array.index(i2,this.NoteColors)]=MidiSheetMusic.Color.Black;this.shadeBrush!=null&&(this.shadeBrush.Dispose(),this.shade2Brush.Dispose());this.shadeBrush=new MidiSheetMusic.SolidBrush(newshade);this.shade2Brush=new MidiSheetMusic.SolidBrush(newshade2)},NoteColor:function(number){return this.NoteColors[System.Array.index(MidiSheetMusic.NoteScale.FromNumber(number),this.NoteColors)]},OnPaint:function(e){var $t,clip=new MidiSheetMusic.Rectangle(Bridge.Int.clip32(e.ClipRectangle.X/this.zoom),Bridge.Int.clip32(e.ClipRectangle.Y/this.zoom),Bridge.Int.clip32(e.ClipRectangle.Width/this.zoom),Bridge.Int.clip32(e.ClipRectangle.Height/this.zoom)),g=e.Graphics(),ypos,staff;g.ScaleTransform(this.zoom,this.zoom);g.SmoothingMode=MidiSheetMusic.SmoothingMode.AntiAlias;ypos=0;$t=Bridge.getEnumerator(this.staffs);try{while($t.moveNext())staff=$t.Current,(ypos+staff.Height|0)<clip.Y||ypos>(clip.Y+clip.Height|0)||(g.TranslateTransform(0,ypos),staff.Draw(g,clip,this.pen,this.SelectionStartPulse,this.SelectionEndPulse,this.deselectedShadeBrush),g.TranslateTransform(0,-ypos|0)),ypos=ypos+staff.Height|0}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}g.ScaleTransform(1/this.zoom,1/this.zoom)},DrawTitle:function(g){var leftmargin=20,topmargin=20,title=MidiSheetMusic.Path.GetFileName(this.filename),font;title=System.String.replaceAll(System.String.replaceAll(title,".mid",""),"_"," ");font=new MidiSheetMusic.Font("Arial",10,MidiSheetMusic.FontStyle.Bold);g.TranslateTransform(leftmargin,topmargin);g.DrawString(title,font,MidiSheetMusic.Brushes.Black,0,0);g.TranslateTransform(-leftmargin|0,-topmargin|0);font.Dispose()},GetTotalPages:function(){var $t,num=1,currheight=MidiSheetMusic.SheetMusic.TitleHeight,i,heights,staff;if(this.numtracks===2&&this.staffs.Count%2==0)for(i=0;i<this.staffs.Count;i=i+2|0)heights=this.staffs.getItem(i).Height+this.staffs.getItem(i+1|0).Height|0,(currheight+heights|0)>MidiSheetMusic.SheetMusic.PageHeight?(num=num+1|0,currheight=heights):currheight=currheight+heights|0;else{$t=Bridge.getEnumerator(this.staffs);try{while($t.moveNext())staff=$t.Current,(currheight+staff.Height|0)>MidiSheetMusic.SheetMusic.PageHeight?(num=num+1|0,currheight=staff.Height):currheight=currheight+staff.Height|0}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}}return num},ShadeNotes:function(currentPulseTime,prevPulseTime,scrollGradually){var $t,g=this.CreateGraphics("shadeNotes"),staff;g.SmoothingMode=MidiSheetMusic.SmoothingMode.AntiAlias;g.ScaleTransform(this.zoom,this.zoom);var ypos=0,x_shade={v:0},y_shade=0,shadedYPos=-1;$t=Bridge.getEnumerator(this.staffs);try{while($t.moveNext())staff=$t.Current,g.TranslateTransform(0,ypos),staff.ShadeNotes(g,this.shadeBrush,this.pen,currentPulseTime,prevPulseTime,x_shade)&&(shadedYPos=shadedYPos===-1?ypos:shadedYPos),g.TranslateTransform(0,-ypos|0),ypos=ypos+staff.Height|0,currentPulseTime>=staff.EndTime&&(y_shade=y_shade+staff.Height|0)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return g.ScaleTransform(1/this.zoom,1/this.zoom),g.Dispose(),x_shade.v=Bridge.Int.clip32(x_shade.v*this.zoom),y_shade=y_shade-MidiSheetMusic.SheetMusic.NoteHeight|0,y_shade=Bridge.Int.clip32(y_shade*this.zoom),currentPulseTime>=0&&this.ScrollToShadedNotes(x_shade.v,y_shade,scrollGradually),shadedYPos===-1?-1:Bridge.Int.clip32(shadedYPos*this.zoom)},ScrollToShadedNotes:function(x_shade,y_shade,scrollGradually){var scrollview=this.Parent,scrollPos=scrollview.AutoScrollPosition,newPos,scrollDist;if(scrollPos.X=-scrollPos.X|0,scrollPos.Y=-scrollPos.Y|0,newPos=scrollPos,this.scrollVert)scrollDist=y_shade-scrollPos.Y|0,scrollGradually&&(scrollDist>this.zoom*MidiSheetMusic.SheetMusic.StaffHeight*8?scrollDist=Bridge.Int.div(scrollDist,2)|0:scrollDist>Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,3)*this.zoom&&(scrollDist=Bridge.Int.clip32(Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,3)*this.zoom))),newPos=new MidiSheetMusic.Point(scrollPos.X,scrollPos.Y+scrollDist|0);else{var x_view=scrollPos.X+(Bridge.Int.div(Bridge.Int.mul(40,scrollview.Width),100)|0)|0,xmax=scrollPos.X+(Bridge.Int.div(Bridge.Int.mul(65,scrollview.Width),100)|0)|0,scrollDist1=x_shade-x_view|0;scrollGradually&&(x_shade>xmax?scrollDist1=Bridge.Int.div(x_shade-x_view|0,3)|0:x_shade>x_view&&(scrollDist1=Bridge.Int.div(x_shade-x_view|0,6)|0));newPos=new MidiSheetMusic.Point(scrollPos.X+scrollDist1|0,scrollPos.Y);newPos.X<0&&(newPos.X=0)}scrollview.AutoScrollPosition=newPos},PulseTimeForPoint:function(point){var $t,scaledPoint=new MidiSheetMusic.Point(Bridge.Int.clip32(point.X/this.zoom),Bridge.Int.clip32(point.Y/this.zoom)),y=0,staff;$t=Bridge.getEnumerator(this.staffs);try{while($t.moveNext()){if(staff=$t.Current,scaledPoint.Y>=y&&scaledPoint.Y<=(y+staff.Height|0))return staff.PulseTimeForPoint(scaledPoint);y=y+staff.Height|0}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return-1},toString:function(){var $t,result="SheetMusic staffs="+this.staffs.Count+"\n",staff;$t=Bridge.getEnumerator(this.staffs);try{while($t.moveNext())staff=$t.Current,result=(result||"")+(staff.toString()||"")}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}return(result||"")+"End SheetMusic\n"}}});Bridge.define("MidiSheetMusic.SolidBrush",{inherits:[MidiSheetMusic.Brush],ctors:{ctor:function(color){this.$initialize();MidiSheetMusic.Brush.ctor.call(this,color)}}});Bridge.define("MidiSheetMusic.TimeSigSymbol",{inherits:[MidiSheetMusic.MusicSymbol],statics:{fields:{images:null},methods:{LoadImages:function(){if(MidiSheetMusic.TimeSigSymbol.images==null){MidiSheetMusic.TimeSigSymbol.images=System.Array.init(13,null,MidiSheetMusic.Image);for(var i=0;i<13;i=i+1|0)MidiSheetMusic.TimeSigSymbol.images[System.Array.index(i,MidiSheetMusic.TimeSigSymbol.images)]=null;MidiSheetMusic.TimeSigSymbol.images[System.Array.index(2,MidiSheetMusic.TimeSigSymbol.images)]=new MidiSheetMusic.Bitmap(MidiSheetMusic.TimeSigSymbol,"Resources.Images.two.png");MidiSheetMusic.TimeSigSymbol.images[System.Array.index(3,MidiSheetMusic.TimeSigSymbol.images)]=new MidiSheetMusic.Bitmap(MidiSheetMusic.TimeSigSymbol,"Resources.Images.three.png");MidiSheetMusic.TimeSigSymbol.images[System.Array.index(4,MidiSheetMusic.TimeSigSymbol.images)]=new MidiSheetMusic.Bitmap(MidiSheetMusic.TimeSigSymbol,"Resources.Images.four.png");MidiSheetMusic.TimeSigSymbol.images[System.Array.index(6,MidiSheetMusic.TimeSigSymbol.images)]=new MidiSheetMusic.Bitmap(MidiSheetMusic.TimeSigSymbol,"Resources.Images.six.png");MidiSheetMusic.TimeSigSymbol.images[System.Array.index(8,MidiSheetMusic.TimeSigSymbol.images)]=new MidiSheetMusic.Bitmap(MidiSheetMusic.TimeSigSymbol,"Resources.Images.eight.png");MidiSheetMusic.TimeSigSymbol.images[System.Array.index(9,MidiSheetMusic.TimeSigSymbol.images)]=new MidiSheetMusic.Bitmap(MidiSheetMusic.TimeSigSymbol,"Resources.Images.nine.png");MidiSheetMusic.TimeSigSymbol.images[System.Array.index(12,MidiSheetMusic.TimeSigSymbol.images)]=new MidiSheetMusic.Bitmap(MidiSheetMusic.TimeSigSymbol,"Resources.Images.twelve.png")}}}},fields:{numerator:0,denominator:0,width:0,candraw:!1},props:{StartTime:{get:function(){return-1}},MinWidth:{get:function(){return this.candraw?Bridge.Int.div(Bridge.Int.mul(Bridge.Int.mul(MidiSheetMusic.TimeSigSymbol.images[System.Array.index(2,MidiSheetMusic.TimeSigSymbol.images)].Width,MidiSheetMusic.SheetMusic.NoteHeight),2),MidiSheetMusic.TimeSigSymbol.images[System.Array.index(2,MidiSheetMusic.TimeSigSymbol.images)].Height)|0:0}},Width:{get:function(){return this.width},set:function(value){this.width=value}},AboveStaff:{get:function(){return 0}},BelowStaff:{get:function(){return 0}}},ctors:{ctor:function(numer,denom){this.$initialize();MidiSheetMusic.MusicSymbol.ctor.call(this);this.numerator=numer;this.denominator=denom;MidiSheetMusic.TimeSigSymbol.LoadImages();this.candraw=numer>=0&&numer<MidiSheetMusic.TimeSigSymbol.images.length&&MidiSheetMusic.TimeSigSymbol.images[System.Array.index(numer,MidiSheetMusic.TimeSigSymbol.images)]!=null&&denom>=0&&denom<MidiSheetMusic.TimeSigSymbol.images.length&&MidiSheetMusic.TimeSigSymbol.images[System.Array.index(numer,MidiSheetMusic.TimeSigSymbol.images)]!=null?!0:!1;this.width=this.MinWidth}},methods:{Draw:function(g,pen,ytop){if(this.candraw){g.TranslateTransform(this.Width-this.MinWidth|0,0);var numer=MidiSheetMusic.TimeSigSymbol.images[System.Array.index(this.numerator,MidiSheetMusic.TimeSigSymbol.images)],denom=MidiSheetMusic.TimeSigSymbol.images[System.Array.index(this.denominator,MidiSheetMusic.TimeSigSymbol.images)],imgheight=Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,2),imgwidth=Bridge.Int.div(Bridge.Int.mul(numer.Width,imgheight),numer.Height)|0;g.DrawImage(numer,0,ytop,imgwidth,imgheight);g.DrawImage(denom,0,ytop+Bridge.Int.mul(MidiSheetMusic.SheetMusic.NoteHeight,2)|0,imgwidth,imgheight);g.TranslateTransform(-(this.Width-this.MinWidth|0)|0,0)}},toString:function(){return System.String.format("TimeSigSymbol numerator={0} denominator={1}",Bridge.box(this.numerator,System.Int32),Bridge.box(this.denominator,System.Int32))}}})});
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAiZmlsZSI6ICJNaWRpU2hlZXRNdXNpY0JyaWRnZS5taW4uanMiLAogICJzb3VyY2VSb290IjogIiIsCiAgInNvdXJjZXMiOiBbXSwKICAibmFtZXMiOiBbXSwKICAibWFwcGluZ3MiOiAiIiwKICAic291cmNlc0NvbnRlbnQiOiBbXQp9Cg==
